!function(e){function t(r){if(n[r])return n[r].exports;var a=n[r]={exports:{},id:r,loaded:!1};return e[r].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function r(e,t){function n(e){e.stopPropagation(),e.preventDefault();var n=e.dataTransfer.files;if(n.length>0){var r=new FileReader;r.onload=function(e){var r=new Uint8Array(e.target.result);t(r,n[0].name)},r.readAsArrayBuffer(n[0])}return!1}function r(e){return e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy",!1}e.addEventListener("dragover",r,!1),e.addEventListener("drop",n,!1)}var a=n(1),i=n(20);window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame}(),window.addEventListener("load",function(){var e=document.getElementById("nesroot"),t=new i["default"](e);window.File&&window.FileReader&&window.FileList&&window.Blob&&r(e,function(n,r){var i=a.App.create(t,e,r);i.loadRom(n)})})},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(2),s=n(16),o=n(17),u=n(18),c=function(){function e(t,n,a){var c=this;r(this,e),this.wndMgr=t,this.root=n,this.destroying=!1,this.nes=i.Nes.create(),window.nes=this.nes,this.nes.setVblankCallback(function(e){c.onVblank(e)}),this.nes.setBreakPointCallback(function(){c.onBreakPoint()}),this.audioManager=new s.AudioManager,this.audioManager.setMasterVolume(0),this.screenWnd=new u.ScreenWnd(this.wndMgr,this.nes),this.wndMgr.add(this.screenWnd),this.screenWnd.setPos(0,0),this.screenWnd.setTitle(a),this.screenWnd.setCallback(function(e){switch(e){case"close":c.cleanUp()}}),this.paletWnd=new u.PaletWnd(this.wndMgr,this.nes),this.wndMgr.add(this.paletWnd),this.paletWnd.setPos(520,0),this.nameTableWnd=new u.NameTableWnd(this.wndMgr,this.nes),this.wndMgr.add(this.nameTableWnd),this.nameTableWnd.setPos(520,40),this.patternTableWnd=new u.PatternTableWnd(this.wndMgr,this.nes),this.wndMgr.add(this.patternTableWnd),this.patternTableWnd.setPos(520,300),this.traceWnd=new u.TraceWnd(this.wndMgr,this.nes),this.wndMgr.add(this.traceWnd),this.traceWnd.setPos(0,500),this.registerWnd=new u.RegisterWnd(this.wndMgr,this.nes),this.wndMgr.add(this.registerWnd),this.registerWnd.setPos(410,500),this.ctrlWnd=new u.ControlWnd(this.wndMgr,this.nes,this.screenWnd,this.audioManager),this.ctrlWnd.setCallback(function(e){switch(e){case"step":c.dumpCpu(),c.render();break;case"paused":c.dumpCpu();break;case"reset":c.traceWnd.reset(),c.dumpCpu()}}),this.wndMgr.add(this.ctrlWnd),this.ctrlWnd.setPos(520,500),this.nes.cpu.pause(!0),this.nes.reset(),this.dumpCpu(),this.padKeyHandler=new o.PadKeyHandler,this.setUpKeyEvent(this.screenWnd.getRootNode(),this.padKeyHandler),this.startLoopAnimation()}return a(e,[{key:"loadRom",value:function(e){return this.nes.setRomData(e)?(this.nes.reset(),this.nes.cpu.pause(!1),this.traceWnd.reset(),this.dumpCpu(),this.updateButtonState(),this.root.focus(),!0):(alert("Illegal ROM format"),!1)}},{key:"cleanUp",value:function(){this.destroying=!0,this.audioManager.destroy(),this.paletWnd.close(),this.nameTableWnd.close(),this.patternTableWnd.close(),this.registerWnd.close(),this.traceWnd.close(),this.ctrlWnd.close(),this.paletWnd=null,this.nameTableWnd=null,this.patternTableWnd=null,this.registerWnd=null,this.traceWnd=null,this.ctrlWnd=null,this.wndMgr=null}},{key:"onVblank",value:function(e){1>e&&this.render();for(var t=0;t<s.AudioManager.CHANNEL;++t)this.audioManager.setChannelFrequency(t,this.nes.apu.getFrequency(t)),this.audioManager.setChannelVolume(t,this.nes.apu.getVolume(t))}},{key:"onBreakPoint",value:function(){this.updateButtonState(),this.dumpCpu()}},{key:"startLoopAnimation",value:function(){var e=this,t=window.performance.now(),n=function r(){if(!e.destroying){var n=window.performance.now(),a=n-t;t=n,e.loop(a),requestAnimationFrame(r)}};requestAnimationFrame(n)}},{key:"loop",value:function(e){var t=50;if(!this.nes.cpu.isPaused()){this.nes.setPadStatus(0,this.padKeyHandler.getStatus(0)),this.nes.setPadStatus(1,this.padKeyHandler.getStatus(1));var n=Math.min(e,t),r=1789773*n/1e3|0;this.nes.runCycles(r)}}},{key:"render",value:function(){this.wndMgr.update()}},{key:"updateButtonState",value:function(){var e=this.nes.cpu.isPaused();this.ctrlWnd.updateState(e)}},{key:"dumpCpu",value:function(){this.registerWnd.updateStatus(),this.traceWnd.updateStatus()}},{key:"setUpKeyEvent",value:function(e,t){e.setAttribute("tabindex","1"),e.style.outline="none",e.addEventListener("keydown",function(e){e.ctrlKey||e.altKey||e.metaKey||(e.preventDefault(),t.onKeyDown(e.keyCode))}),e.addEventListener("keyup",function(e){e.preventDefault(),t.onKeyUp(e.keyCode)})}}],[{key:"create",value:function(t,n,r){return new e(t,n,r)}}]),e}();t.App=c},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e){return e*(3/341)|0}function i(e){return 78===e[0]&&69===e[1]&&83===e[2]&&26===e[3]}function s(e){return e[6]>>4&15|240&e[7]}function o(e){var t=16,n=16384*e[4],r=e.slice(t,t+n);return new Uint8Array(r)}function u(e){var t=16+16384*e[4],n=8192*e[5],r=e.slice(t,t+n);return new Uint8Array(r)}var c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=n(3),h=n(4),p=n(5),d=n(9),f=n(7),v=n(10),y=2048,E=241,T=242,A=261,g=262,O=341*g/3|0,m=function(){function e(){r(this,e),this.cpu=new p.Cpu6502,this.ram=new Uint8Array(y),this.ppu=new d.Ppu,this.apu=new l.Apu,this.mapperNo=0,this.cycleCount=0,this.vblankCallback=function(e){},this.breakPointCallback=function(){},this.irqHline=-1,this.romData=new Uint8Array(0)}return c(e,[{key:"setVblankCallback",value:function(e){this.vblankCallback=e}},{key:"setBreakPointCallback",value:function(e){this.breakPointCallback=e}},{key:"setRomData",value:function(e){return i(e)?(this.mapperNo=s(e),this.romData=o(e),this.ppu.setChrData(u(e)),this.ppu.setMirrorMode(1&e[6]),this.cpu.deleteAllBreakPoints(),this.setMemoryMap(this.mapperNo),!0):!1}},{key:"reset",value:function(){this.ram.fill(255),this.cpu.reset(),this.ppu.reset(),this.apu.reset(),this.cycleCount=0,this.irqHline=-1}},{key:"setPadStatus",value:function(e,t){this.apu.setPadStatus(e,t)}},{key:"runCycles",value:function(e){try{for(var t=e;t>0;){var n=this.step(t);if(t-=n,this.cpu.isPaused())return this.breakPointCallback(),0}return-e}catch(r){throw this.cpu.pause(!0),r}}},{key:"step",value:function(e){var t=this.cpu.step();return this.cycleCount=this.tryHblankEvent(this.cycleCount,t,e),t}},{key:"setIrqHline",value:function(e){this.irqHline=e}},{key:"render",value:function(e,t){this.ppu.renderBg(t),this.ppu.renderSprite(t),e.putImageData(t,0,0)}},{key:"renderNameTable",value:function(e){var t=e.getContext("2d"),n=t.getImageData(0,0,e.width,e.height);this.ppu.doRenderBg(n,0,0,0,0,0),this.ppu.doRenderBg(n,0,0,256,0,0===this.ppu.mirrorMode?2048:1024),t.putImageData(n,0,0)}},{key:"renderPatternTable",value:function(e,t){var n=e.getContext("2d"),r=n.getImageData(0,0,e.width,e.height);this.ppu.renderPattern(r,t),n.putImageData(r,0,0)}},{key:"getPalet",value:function(e){var t=this.ppu.vram,n=16128;return 63&t[n+(31&e)]}},{key:"setMemoryMap",value:function(e){var t=this,n=16404,r=this.cpu;r.resetMemoryMap(),r.setReadMemory(8192,16383,function(e){var n=7&e;return t.ppu.read(n)}),r.setWriteMemory(8192,16383,function(e,n){var r=7&e;t.ppu.write(r,n)}),r.setReadMemory(16384,24575,function(e){return t.apu.read(e)}),r.setWriteMemory(16384,24575,function(e,r){switch(e){case n:r>=0&&31>=r?t.ppu.copyWithDma(t.ram,r<<8):console.error("OAMDMA not implemented except for RAM: "+f.Util.hex(r,2));break;default:t.apu.write(e,r)}}),r.setReadMemory(0,8191,function(e){return t.ram[e&y-1]}),r.setWriteMemory(0,8191,function(e,n){t.ram[e&y-1]=n}),this.setMemoryMapForMapper(e)}},{key:"setMemoryMapForMapper",value:function(e){console.log("Mapper "+f.Util.hex(e,2)),e in v.kMapperTable?v.kMapperTable[e](this.romData,this.cpu,this.ppu,this):(console.error("  not supported"),v.kMapperTable[0](this.romData,this.cpu,this.ppu,this))}},{key:"tryHblankEvent",value:function(e,t,n){var r=e+t,i=a(e),s=a(r);if(s>i){switch(this.ppu.setHcount(s),s){case E:this.apu.isIrqEnabled()&&this.cpu.requestIrq(),this.vblankCallback(n/O),this.ppu.setVBlank();break;case T:this.interruptVBlank();break;case A:this.ppu.clearVBlank();break;case g:r-=341*g/3|0,this.ppu.hcount=0}s===this.irqHline&&this.cpu.requestIrq()}return r}},{key:"interruptVBlank",value:function(){this.ppu.interruptEnable()&&this.interruptNmi()}},{key:"interruptNmi",value:function(){this.cpu.nmi()}}],[{key:"create",value:function(){return new e}},{key:"getPaletColorString",value:function(e){var t=h.kColors[3*e],n=h.kColors[3*e+1],r=h.kColors[3*e+2];return"rgb("+t+","+n+","+r+")"}}]),e}();t.Nes=m},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();!function(e){e[e.A=1]="A",e[e.B=2]="B",e[e.SELECT=4]="SELECT",e[e.START=8]="START",e[e.U=16]="U",e[e.D=32]="D",e[e.L=64]="L",e[e.R=128]="R"}(t.PadBit||(t.PadBit={}));var a=(t.PadBit,16384),i=16406,s=16407,o=64,u=function(){function e(){n(this,e),this.padStatus=new Array(2),this.padTmp=new Array(2),this.regs=new Uint8Array(32)}return r(e,[{key:"reset",value:function(){this.regs.fill(0),this.regs[s-a]=o}},{key:"read",value:function(e){switch(e){case 16405:return 192;case 16406:case 16407:return this.shiftPad(e-16406);default:return 0}}},{key:"write",value:function(e,t){switch(16416>e&&(this.regs[e-16384]=t),e){case i:0===(1&t)&&this.latchPad()}}},{key:"getFrequency",value:function(e){switch(e){case 0:case 1:var t=this.regs[4*e+2]+((7&this.regs[4*e+3])<<8);return 111875/(t+1)|0;case 2:var n=this.regs[4*e+2]+((7&this.regs[4*e+3])<<8);return 223750/(n+1)|0}}},{key:"getVolume",value:function(e){if(0===(this.regs[21]&1<<e))return 0;switch(e){case 0:case 1:var t=this.regs[4*e];return(15&t)/15;case 2:return 1}}},{key:"setPadStatus",value:function(e,t){this.padStatus[e]=t}},{key:"isIrqEnabled",value:function(){return 0===(this.regs[s-a]&o)}},{key:"latchPad",value:function(){this.padTmp[0]=this.padStatus[0],this.padTmp[1]=this.padStatus[1]}},{key:"shiftPad",value:function(e){var t=this.padTmp[e];return this.padTmp[e]=t>>1,1&t}}]),e}();t.Apu=u},function(e,t){"use strict";var n;!function(e){e.WIDTH=256,e.HEIGHT=240}(n=t.Const||(t.Const={})),t.kColors=[124,124,124,0,0,252,0,0,188,68,40,188,148,0,132,168,0,32,168,16,0,136,20,0,80,48,0,0,120,0,0,104,0,0,88,0,0,64,88,0,0,0,0,0,0,0,0,0,188,188,188,0,120,248,0,88,248,104,68,252,216,0,204,228,0,88,248,56,0,228,92,16,172,124,0,0,184,0,0,168,0,0,168,68,0,136,136,0,0,0,0,0,0,0,0,0,248,248,248,60,188,252,104,136,252,152,120,248,248,120,248,248,88,152,248,120,88,252,160,68,248,184,0,184,248,24,88,216,84,88,248,152,0,232,216,120,120,120,0,0,0,0,0,0,252,252,252,164,228,252,184,184,248,216,184,248,248,184,248,248,164,192,240,208,176,252,224,168,248,216,120,216,248,120,184,248,184,184,248,216,0,252,252,248,216,248,0,0,0,0,0,0],t.kStaggered=function(){for(var e=8,t=1<<e,n=new Uint16Array(t),r=0;t>r;++r){for(var a=0,i=0;e>i;++i)a<<=2,0!==(r&1<<e-1-i)&&(a|=1);n[r]=a}return n}(),t.kFlipBits=function(){for(var e=8,t=1<<e,n=new Uint8Array(t),r=0;t>r;++r){for(var a=0,i=0;e>i;++i)a<<=1,0!==(r&1<<i)&&(a|=1);n[r]=a}return n}()},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t,n){return t?e|n:e&~n}function i(e){return e+1&255}function s(e){return e-1&255}function o(e){return 128>e?e:e-256}var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=n(6),l=n(7),h=n(8),p=!1,d=l.Util.hex,f=0,v=1,y=2,E=4,T=5,A=6,g=7,O=1<<f,m=1<<v,C=1<<y,k=1<<E,b=1<<T,P=1<<A,R=1<<g,I=65530,L=65532,w=65534,B=8192,S=200,D=function(){var e={opType:c.OpType.UNKNOWN,addressing:c.Addressing.UNKNOWN,bytes:1,cycle:0},t=new Uint8Array(3),n=new Array(3);return function(r,a){for(var i=r.read8Raw(a),s=M.getInst(i)||e,o=0;o<s.bytes;++o){var u=r.read8Raw(r.pc+o);t[o]=u,n[o]=l.Util.hex(u,2)}for(var c=s.bytes;3>c;++c)n[c]="  ";var p=l.Util.hex(r.pc,4),d=n.join(" "),f=h.disassemble(s,t,1,r.pc);return p+": "+d+"   "+f}}(),M=function(){function e(){r(this,e),this.readerFuncTable=new Array(65536/B),this.writerFuncTable=new Array(65536/B),this.a=this.x=this.y=this.s=0,this.breakPoints={},this.watchRead={},this.watchWrite={},this.pausing=!1,this.stepLogs=[]}return u(e,[{key:"resetMemoryMap",value:function(){this.readerFuncTable.fill(null),this.writerFuncTable.fill(null)}},{key:"setReadMemory",value:function(e,t,n){for(var r=e/B|0,a=t/B|0,i=r;a>=i;++i)this.readerFuncTable[i]=n}},{key:"setWriteMemory",value:function(e,t,n){for(var r=e/B|0,a=t/B|0,i=r;a>=i;++i)this.writerFuncTable[i]=n}},{key:"reset",value:function(){this.p=C|k|b,this.s=this.s-3&255,this.pc=this.read16(L),this.readErrorReported=this.writeErrorReported=!1,this.stepLogs.length=0}},{key:"deleteAllBreakPoints",value:function(){this.breakPoints={},this.watchRead={},this.watchWrite={}}},{key:"pause",value:function(e){this.pausing=e}},{key:"isPaused",value:function(){return this.pausing}},{key:"requestIrq",value:function(){return 0!==(this.p&C)?!1:(p&&this.addStepLog("IRQ occurred"),this.push16(this.pc),this.push(this.p),this.pc=this.read16(w),this.p|=C,!0)}},{key:"setCarry",value:function(e){this.p=a(this.p,e,O)}},{key:"setZero",value:function(e){this.p=a(this.p,e,m)}},{key:"setOverFlow",value:function(e){this.p=a(this.p,e,P)}},{key:"setNegative",value:function(e){this.p=a(this.p,e,R)}},{key:"step",value:function(){if(this.pausing)return 0;var t=this.pc;p&&this.addStepLog(D(this,t));var n=this.read8(t++),r=e.getInst(n);return null==r?(console.error("Unhandled OPCODE, "+d(this.pc-1,4)+": "+d(n,2)),this.pausing=!0,0):(this.pc+=r.bytes,N[r.opType](this,t,r.addressing),this.breakPoints[this.pc]&&(this.pausing=!0,console.warn("paused because PC matched break point: "+l.Util.hex(this.pc,4))),r.cycle)}},{key:"setFlag",value:function(e){this.setZero(0===e),this.setNegative(0!==(128&e))}},{key:"read8",value:function(e){var t=this.read8Raw(e);return this.watchRead[e]&&(this.pausing=!0,console.warn("Break because watched point read: adr="+l.Util.hex(e,4)+", value="+l.Util.hex(t,2))),t}},{key:"read8Raw",value:function(e){var t=e/B|0,n=this.readerFuncTable[t];return n?n(e):(this.readErrorReported||(console.error("Illegal read at "+d(e,4)+", pc="+d(this.pc,4)),this.pausing=!0,this.readErrorReported=!0),0)}},{key:"read16",value:function(e){var t=this.read8(e),n=this.read8(e+1);return n<<8|t}},{key:"read16Indirect",value:function(e){var t=this.read8(e),n=this.read8((65280&e)+(e+1&255));return n<<8|t}},{key:"write8",value:function(e,t){var n=e/B|0,r=this.writerFuncTable[n];return r?(this.watchWrite[e]&&(this.pausing=!0,console.warn("Break because watched point write: adr="+l.Util.hex(e,4)+", value="+l.Util.hex(t,2))),this.writerFuncTable[n](e,t)):void(this.writeErrorReported||(console.error("Illegal write at "+d(e,4)+", pc="+d(this.pc,4)+", "+d(t,2)),this.pausing=!0,this.writeErrorReported=!0))}},{key:"push",value:function(e){this.write8(256+this.s,e),this.s=s(this.s)}},{key:"push16",value:function(e){var t=this.s;this.write8(256+t,e>>8),t=s(t),this.write8(256+t,255&e),this.s=s(t)}},{key:"pop",value:function(e){return this.s=i(this.s),this.read8(256+this.s)}},{key:"pop16",value:function(e){var t=this.s;t=i(t);var n=this.read8(256+t);t=i(t);var r=this.read8(256+t);return this.s=t,r<<8|n}},{key:"nmi",value:function(){var e=this.read16(I);this.breakPoints.nmi&&(this.pausing=!0,console.warn("paused because NMI: "+l.Util.hex(this.pc,4)+", "+l.Util.hex(e,4))),p&&this.addStepLog("NMI occurred"),this.push16(this.pc),this.push(this.p),this.pc=e,this.p=(this.p|C)&~k}},{key:"dump",value:function(e,t){for(var n=[],r=0;t>r;++r)n.push(this.read8(r+e));for(var a=0;t>a;a+=16){var i=n.splice(0,16).map(function(e){return l.Util.hex(e,2)}).join(" ");console.log(l.Util.hex(e+a,4)+": "+i)}}},{key:"addStepLog",value:function(e){if(this.stepLogs.length<S)this.stepLogs.push(e);else{for(var t=1;S>t;++t)this.stepLogs[t-1]=this.stepLogs[t];this.stepLogs[S-1]=e}}}],[{key:"getInst",value:function(e){return c.kInstTable[e]}}]),e}();t.Cpu6502=M;var N=function(){function e(e,t){r[e]=t}function t(e,t,n){var r=void 0;switch(n){case c.Addressing.ACCUMULATOR:return e.a;case c.Addressing.IMMEDIATE:r=t;break;case c.Addressing.ZEROPAGE:r=e.read8(t);break;case c.Addressing.ZEROPAGE_X:r=e.read8(t)+e.x&255;break;case c.Addressing.ZEROPAGE_Y:r=e.read8(t)+e.y&255;break;case c.Addressing.ABSOLUTE:r=e.read16(t);break;case c.Addressing.ABSOLUTE_X:r=e.read16(t)+e.x&65535;break;case c.Addressing.ABSOLUTE_Y:r=e.read16(t)+e.y&65535;break;case c.Addressing.INDIRECT_X:var a=e.read8(t);r=e.read16Indirect(a+e.x&255);break;case c.Addressing.INDIRECT_Y:var i=e.read8(t);r=e.read16Indirect(i)+e.y&65535;break;default:return console.error("Illegal addressing: "+n),void(e.pausing=!0)}return e.read8(r)}function n(e,t,n,r){var a=void 0;switch(n){case c.Addressing.ACCUMULATOR:return void(e.a=r);case c.Addressing.ZEROPAGE:a=e.read8(t);break;case c.Addressing.ZEROPAGE_X:a=e.read8(t)+e.x&255;break;case c.Addressing.ZEROPAGE_Y:a=e.read8(t)+e.y&255;break;case c.Addressing.ABSOLUTE:a=e.read16(t);break;case c.Addressing.ABSOLUTE_X:a=e.read16(t)+e.x&65535;break;case c.Addressing.ABSOLUTE_Y:a=e.read16(t)+e.y&65535;break;case c.Addressing.INDIRECT_X:var i=e.read8(t);a=e.read16Indirect(i+e.x&255);break;case c.Addressing.INDIRECT_Y:var s=e.read8(t);a=e.read16Indirect(s)+e.y&65535;break;default:return console.error("Illegal store: "+n),void(e.pausing=!0)}e.write8(a,r)}var r=[];return e(c.OpType.LDA,function(e,n,r){e.a=t(e,n,r),e.setFlag(e.a)}),e(c.OpType.STA,function(e,t,r){n(e,t,r,e.a)}),e(c.OpType.LDX,function(e,n,r){e.x=t(e,n,r),e.setFlag(e.x)}),e(c.OpType.STX,function(e,t,r){n(e,t,r,e.x)}),e(c.OpType.LDY,function(e,n,r){e.y=t(e,n,r),e.setFlag(e.y)}),e(c.OpType.STY,function(e,t,r){n(e,t,r,e.y)}),e(c.OpType.TAX,function(e,t,n){e.x=e.a,e.setFlag(e.x)}),e(c.OpType.TAY,function(e,t,n){e.y=e.a,e.setFlag(e.y)}),e(c.OpType.TXA,function(e,t,n){e.a=e.x,e.setFlag(e.x)}),e(c.OpType.TYA,function(e,t,n){e.a=e.y,e.setFlag(e.a)}),e(c.OpType.TXS,function(e,t,n){e.s=e.x}),e(c.OpType.TSX,function(e,t,n){e.x=e.s,e.setFlag(e.x)}),e(c.OpType.ADC,function(e,n,r){var a=0!==(e.p&O)?1:0,i=t(e,n,r),s=e.a+i+a,o=0!==((e.a^s)&(i^s)&128);e.a=255&s,e.setFlag(e.a),e.setCarry(s>=256),e.setOverFlow(o)}),e(c.OpType.SBC,function(e,n,r){var a=0!==(e.p&O)?1:0,i=255-t(e,n,r),s=e.a+i+a,o=0!==((e.a^s)&(i^s)&128);e.a=255&s,e.setFlag(e.a),e.setCarry(s>=256),e.setOverFlow(o)}),e(c.OpType.INX,function(e,t,n){e.x=i(e.x),e.setFlag(e.x)}),e(c.OpType.INY,function(e,t,n){e.y=i(e.y),e.setFlag(e.y)}),e(c.OpType.INC,function(e,r,a){var s=i(t(e,r,a));n(e,r,a,s),e.setFlag(s)}),e(c.OpType.DEX,function(e,t,n){e.x=s(e.x),e.setFlag(e.x)}),e(c.OpType.DEY,function(e,t,n){e.y=s(e.y),e.setFlag(e.y)}),e(c.OpType.DEC,function(e,r,a){var i=s(t(e,r,a));n(e,r,a,i),e.setFlag(i)}),e(c.OpType.AND,function(e,n,r){var a=t(e,n,r);e.a&=a,e.setFlag(e.a)}),e(c.OpType.ORA,function(e,n,r){var a=t(e,n,r);e.a|=a,e.setFlag(e.a)}),e(c.OpType.EOR,function(e,n,r){var a=t(e,n,r);e.a^=a,e.setFlag(e.a)}),e(c.OpType.ROL,function(e,r,a){var i=t(e,r,a),s=0!==(e.p&O)?1:0,o=0!==(128&i),u=255&(i<<1|s);n(e,r,a,u),e.setFlag(u),e.setCarry(o)}),e(c.OpType.ROR,function(e,r,a){var i=t(e,r,a),s=0!==(e.p&O)?128:0,o=0!==(1&i),u=i>>1|s;n(e,r,a,u),e.setFlag(u),e.setCarry(o)}),e(c.OpType.ASL,function(e,r,a){var i=t(e,r,a),s=0!==(128&i),o=i<<1&255;n(e,r,a,o),e.setFlag(o),e.setCarry(s)}),e(c.OpType.LSR,function(e,r,a){var i=t(e,r,a),s=0!==(1&i),o=i>>1&255;n(e,r,a,o),e.setFlag(o),e.setCarry(s)}),e(c.OpType.BIT,function(e,n,r){var a=t(e,n,r),i=e.a&a;e.setZero(0===i);var s=R|P;e.p=e.p&~s|a&s}),e(c.OpType.CMP,function(e,n,r){var a=t(e,n,r),i=e.a-a;e.setFlag(i),e.setCarry(i>=0)}),e(c.OpType.CPX,function(e,n,r){var a=t(e,n,r),i=e.x-a;e.setFlag(i),e.setCarry(i>=0)}),e(c.OpType.CPY,function(e,n,r){var a=t(e,n,r),i=e.y-a;e.setFlag(i),e.setCarry(i>=0)}),e(c.OpType.JMP,function(e,t,n){var r=e.read16(t);n!==c.Addressing.ABSOLUTE&&(r=e.read16Indirect(r)),e.pc=r}),e(c.OpType.JSR,function(e,t,n){var r=e.read16(t);e.push16(t+1),e.pc=r}),e(c.OpType.RTS,function(e,t,n){e.pc=e.pop16()+1}),e(c.OpType.RTI,function(e,t,n){e.p=e.pop(),e.pc=e.pop16()}),e(c.OpType.BCC,function(e,t,n){var r=o(e.read8(t));0===(e.p&O)&&(e.pc+=r)}),e(c.OpType.BCS,function(e,t,n){var r=o(e.read8(t));0!==(e.p&O)&&(e.pc+=r)}),e(c.OpType.BPL,function(e,t,n){var r=o(e.read8(t));0===(e.p&R)&&(e.pc+=r)}),e(c.OpType.BMI,function(e,t,n){var r=o(e.read8(t));0!==(e.p&R)&&(e.pc+=r)}),e(c.OpType.BNE,function(e,t,n){var r=o(e.read8(t));0===(e.p&m)&&(e.pc+=r)}),e(c.OpType.BEQ,function(e,t,n){var r=o(e.read8(t));0!==(e.p&m)&&(e.pc+=r)}),e(c.OpType.BVC,function(e,t,n){var r=o(e.read8(t));0===(e.p&P)&&(e.pc+=r)}),e(c.OpType.BVS,function(e,t,n){var r=o(e.read8(t));0!==(e.p&P)&&(e.pc+=r)}),e(c.OpType.PHA,function(e,t,n){e.push(e.a)}),e(c.OpType.PHP,function(e,t,n){e.push(e.p|k)}),e(c.OpType.PLA,function(e,t,n){e.a=e.pop(),e.setFlag(e.a)}),e(c.OpType.PLP,function(e,t,n){e.p=e.pop()|b}),e(c.OpType.CLC,function(e,t,n){e.p&=~O}),e(c.OpType.SEC,function(e,t,n){e.p|=O}),e(c.OpType.SEI,function(e,t,n){e.p|=C}),e(c.OpType.CLI,function(e,t,n){e.p&=~C}),e(c.OpType.CLV,function(e,t,n){e.p&=~P}),e(c.OpType.SED,function(e,t,n){}),e(c.OpType.CLD,function(e,t,n){}),e(c.OpType.BRK,function(e,t,n){p&&e.addStepLog("BRK occurred"),e.p|=k,e.pc+=1,e.push16(e.pc),e.push(e.p),e.pc=e.read16(w),e.p|=C}),e(c.OpType.NOP,function(e,t,n){}),r}()},function(e,t){"use strict";!function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.IMPLIED=1]="IMPLIED",e[e.ACCUMULATOR=2]="ACCUMULATOR",e[e.IMMEDIATE=3]="IMMEDIATE",e[e.IMMEDIATE16=4]="IMMEDIATE16",e[e.ZEROPAGE=5]="ZEROPAGE",e[e.ZEROPAGE_X=6]="ZEROPAGE_X",e[e.ZEROPAGE_Y=7]="ZEROPAGE_Y",e[e.ABSOLUTE=8]="ABSOLUTE",e[e.ABSOLUTE_X=9]="ABSOLUTE_X",e[e.ABSOLUTE_Y=10]="ABSOLUTE_Y",e[e.INDIRECT=11]="INDIRECT",e[e.INDIRECT_X=12]="INDIRECT_X",e[e.INDIRECT_Y=13]="INDIRECT_Y",e[e.RELATIVE=14]="RELATIVE"}(t.Addressing||(t.Addressing={}));var n=t.Addressing;!function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.LDA=1]="LDA",e[e.STA=2]="STA",e[e.LDX=3]="LDX",e[e.STX=4]="STX",e[e.LDY=5]="LDY",e[e.STY=6]="STY",e[e.TAX=7]="TAX",e[e.TAY=8]="TAY",e[e.TXA=9]="TXA",e[e.TYA=10]="TYA",e[e.TXS=11]="TXS",e[e.TSX=12]="TSX",e[e.ADC=13]="ADC",e[e.SBC=14]="SBC",e[e.INX=15]="INX",e[e.INY=16]="INY",e[e.INC=17]="INC",e[e.DEX=18]="DEX",e[e.DEY=19]="DEY",e[e.DEC=20]="DEC",e[e.AND=21]="AND",e[e.ORA=22]="ORA",e[e.EOR=23]="EOR",e[e.ROL=24]="ROL",e[e.ROR=25]="ROR",e[e.ASL=26]="ASL",e[e.LSR=27]="LSR",e[e.BIT=28]="BIT",e[e.CMP=29]="CMP",e[e.CPX=30]="CPX",e[e.CPY=31]="CPY",e[e.JMP=32]="JMP",e[e.JSR=33]="JSR",e[e.RTS=34]="RTS",e[e.RTI=35]="RTI",e[e.BCC=36]="BCC",e[e.BCS=37]="BCS",e[e.BPL=38]="BPL",e[e.BMI=39]="BMI",e[e.BNE=40]="BNE",e[e.BEQ=41]="BEQ",e[e.BVC=42]="BVC",e[e.BVS=43]="BVS",e[e.PHA=44]="PHA",e[e.PHP=45]="PHP",e[e.PLA=46]="PLA",e[e.PLP=47]="PLP",e[e.CLC=48]="CLC",e[e.SEC=49]="SEC",e[e.SEI=50]="SEI",e[e.CLI=51]="CLI",e[e.CLV=52]="CLV",e[e.SED=53]="SED",e[e.CLD=54]="CLD",e[e.BRK=55]="BRK",e[e.NOP=56]="NOP"}(t.OpType||(t.OpType={}));var r=t.OpType;t.kInstTable=function(){function e(e,n,r,a,i){t[n]={opType:e,addressing:r,bytes:a,cycle:i}}var t=[];return e(r.LDA,169,n.IMMEDIATE,2,2),e(r.LDA,165,n.ZEROPAGE,2,3),e(r.LDA,181,n.ZEROPAGE_X,2,4),e(r.LDA,173,n.ABSOLUTE,3,4),e(r.LDA,189,n.ABSOLUTE_X,3,4),e(r.LDA,185,n.ABSOLUTE_Y,3,4),e(r.LDA,161,n.INDIRECT_X,2,6),e(r.LDA,177,n.INDIRECT_Y,2,5),e(r.STA,133,n.ZEROPAGE,2,3),e(r.STA,149,n.ZEROPAGE_X,2,4),e(r.STA,141,n.ABSOLUTE,3,4),e(r.STA,157,n.ABSOLUTE_X,3,5),e(r.STA,153,n.ABSOLUTE_Y,3,5),e(r.STA,149,n.ZEROPAGE_X,2,4),e(r.STA,129,n.INDIRECT_X,2,6),e(r.STA,145,n.INDIRECT_Y,2,6),e(r.LDX,162,n.IMMEDIATE,2,2),e(r.LDX,166,n.ZEROPAGE,2,3),e(r.LDX,182,n.ZEROPAGE_Y,2,4),e(r.LDX,174,n.ABSOLUTE,3,4),e(r.LDX,190,n.ABSOLUTE_Y,3,4),e(r.STX,134,n.ZEROPAGE,2,3),e(r.STX,150,n.ZEROPAGE_Y,2,4),e(r.STX,142,n.ABSOLUTE,3,4),e(r.LDY,160,n.IMMEDIATE,2,2),e(r.LDY,164,n.ZEROPAGE,2,3),e(r.LDY,180,n.ZEROPAGE_X,2,4),e(r.LDY,172,n.ABSOLUTE,3,4),e(r.LDY,188,n.ABSOLUTE_X,3,4),e(r.STY,132,n.ZEROPAGE,2,3),e(r.STY,148,n.ZEROPAGE_X,2,4),e(r.STY,140,n.ABSOLUTE,3,4),e(r.TAX,170,n.IMPLIED,1,2),e(r.TAY,168,n.IMPLIED,1,2),e(r.TXA,138,n.IMPLIED,1,2),e(r.TYA,152,n.IMPLIED,1,2),e(r.TXS,154,n.IMPLIED,1,2),e(r.TSX,186,n.IMPLIED,1,2),e(r.ADC,105,n.IMMEDIATE,2,2),e(r.ADC,101,n.ZEROPAGE,2,3),e(r.ADC,117,n.ZEROPAGE_X,2,4),e(r.ADC,109,n.ABSOLUTE,3,4),e(r.ADC,125,n.ABSOLUTE_X,3,4),e(r.ADC,121,n.ABSOLUTE_Y,3,4),e(r.ADC,97,n.INDIRECT_X,2,6),e(r.ADC,113,n.INDIRECT_Y,2,5),e(r.SBC,233,n.IMMEDIATE,2,2),e(r.SBC,229,n.ZEROPAGE,2,3),e(r.SBC,245,n.ZEROPAGE_X,2,4),e(r.SBC,237,n.ABSOLUTE,3,4),e(r.SBC,253,n.ABSOLUTE_X,3,4),e(r.SBC,249,n.ABSOLUTE_Y,3,4),e(r.SBC,225,n.INDIRECT_X,2,6),e(r.SBC,241,n.INDIRECT_Y,2,5),e(r.CMP,201,n.IMMEDIATE,2,2),e(r.CMP,197,n.ZEROPAGE,2,3),e(r.CMP,213,n.ZEROPAGE_X,2,4),e(r.CMP,205,n.ABSOLUTE,3,4),e(r.CMP,221,n.ABSOLUTE_X,3,4),e(r.CMP,217,n.ABSOLUTE_Y,3,4),e(r.CMP,193,n.INDIRECT_X,2,6),e(r.CMP,209,n.INDIRECT_Y,2,5),e(r.CPX,224,n.IMMEDIATE,2,2),e(r.CPX,228,n.ZEROPAGE,2,3),e(r.CPX,236,n.ABSOLUTE,3,4),e(r.CPY,192,n.IMMEDIATE,2,2),e(r.CPY,196,n.ZEROPAGE,2,3),e(r.CPY,204,n.ABSOLUTE,3,4),e(r.INX,232,n.IMPLIED,1,2),e(r.INY,200,n.IMPLIED,1,2),e(r.INC,230,n.ZEROPAGE,2,5),e(r.INC,246,n.ZEROPAGE_X,2,6),e(r.INC,238,n.ABSOLUTE,3,6),e(r.INC,254,n.ABSOLUTE_X,3,7),e(r.DEX,202,n.IMPLIED,1,2),e(r.DEY,136,n.IMPLIED,1,2),e(r.DEC,198,n.ZEROPAGE,2,5),e(r.DEC,214,n.ZEROPAGE_X,2,6),e(r.DEC,206,n.ABSOLUTE,3,6),e(r.DEC,222,n.ABSOLUTE_X,3,7),e(r.AND,41,n.IMMEDIATE,2,2),e(r.AND,37,n.ZEROPAGE,2,3),e(r.AND,53,n.ZEROPAGE_X,2,4),e(r.AND,45,n.ABSOLUTE,3,4),e(r.AND,61,n.ABSOLUTE_X,3,4),e(r.AND,57,n.ABSOLUTE_Y,3,4),e(r.AND,33,n.INDIRECT_X,2,6),e(r.AND,49,n.INDIRECT_Y,2,5),e(r.ORA,9,n.IMMEDIATE,2,2),e(r.ORA,5,n.ZEROPAGE,2,3),e(r.ORA,21,n.ZEROPAGE_X,2,4),e(r.ORA,13,n.ABSOLUTE,3,4),e(r.ORA,29,n.ABSOLUTE_X,3,4),e(r.ORA,25,n.ABSOLUTE_Y,3,4),e(r.ORA,1,n.INDIRECT_X,2,6),e(r.ORA,17,n.INDIRECT_Y,2,5),e(r.EOR,73,n.IMMEDIATE,2,2),e(r.EOR,69,n.ZEROPAGE,2,3),e(r.EOR,85,n.ZEROPAGE_X,2,4),e(r.EOR,77,n.ABSOLUTE,3,4),e(r.EOR,93,n.ABSOLUTE_X,3,4),e(r.EOR,89,n.ABSOLUTE_Y,3,4),e(r.EOR,65,n.INDIRECT_X,2,6),e(r.EOR,81,n.INDIRECT_Y,2,5),e(r.ROL,42,n.ACCUMULATOR,1,2),e(r.ROL,38,n.ZEROPAGE,2,5),e(r.ROL,54,n.ZEROPAGE_X,2,6),e(r.ROL,46,n.ABSOLUTE,3,6),e(r.ROL,62,n.ABSOLUTE_X,3,7),e(r.ROR,106,n.ACCUMULATOR,1,2),e(r.ROR,102,n.ZEROPAGE,2,5),e(r.ROR,118,n.ZEROPAGE_X,2,6),e(r.ROR,110,n.ABSOLUTE,3,6),e(r.ROR,126,n.ABSOLUTE_X,3,7),e(r.ASL,10,n.ACCUMULATOR,1,2),e(r.ASL,6,n.ZEROPAGE,2,5),e(r.ASL,22,n.ZEROPAGE_X,2,6),e(r.ASL,14,n.ABSOLUTE,3,6),e(r.ASL,30,n.ABSOLUTE_X,3,7),e(r.LSR,74,n.ACCUMULATOR,1,2),e(r.LSR,70,n.ZEROPAGE,2,5),e(r.LSR,86,n.ZEROPAGE_X,2,6),e(r.LSR,78,n.ABSOLUTE,3,6),e(r.LSR,94,n.ABSOLUTE_X,3,7),e(r.BIT,36,n.ZEROPAGE,2,3),e(r.BIT,44,n.ABSOLUTE,3,4),e(r.JMP,76,n.ABSOLUTE,3,3),e(r.JMP,108,n.INDIRECT,3,5),e(r.JSR,32,n.ABSOLUTE,3,6),e(r.RTS,96,n.IMPLIED,1,6),e(r.RTI,64,n.IMPLIED,1,6),e(r.BCC,144,n.RELATIVE,2,2),e(r.BCS,176,n.RELATIVE,2,2),e(r.BPL,16,n.RELATIVE,2,2),e(r.BMI,48,n.RELATIVE,2,2),e(r.BNE,208,n.RELATIVE,2,2),e(r.BEQ,240,n.RELATIVE,2,2),e(r.BVC,80,n.RELATIVE,2,2),e(r.BVS,112,n.RELATIVE,2,2),e(r.PHA,72,n.IMPLIED,1,3),e(r.PHP,8,n.IMPLIED,1,3),e(r.PLA,104,n.IMPLIED,1,4),e(r.PLP,40,n.IMPLIED,1,4),e(r.CLC,24,n.IMPLIED,1,2),e(r.SEC,56,n.IMPLIED,1,2),e(r.SEI,120,n.IMPLIED,1,2),e(r.CLI,88,n.IMPLIED,1,2),e(r.CLV,184,n.IMPLIED,1,2),e(r.SED,248,n.IMPLIED,1,2),e(r.CLD,216,n.IMPLIED,1,2),e(r.BRK,0,n.IMPLIED,1,7),e(r.NOP,234,n.IMPLIED,1,2),t}()},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a="0123456789abcdef";"fill"in Uint8Array.prototype||(Uint8Array.prototype.fill=function(e){for(var t=arguments.length<=1||void 0===arguments[1]?0:arguments[1],n=arguments.length<=2||void 0===arguments[2]?this.length:arguments[2],r=t;n>r;++r)this[r]=e;return this}),Uint8Array.prototype.slice||(Uint8Array.prototype.slice=function(e,t){void 0==t&&(t=this.length);for(var n=new Uint8Array(t-e),r=0;r<n.length;++r)n[r]=this[r+e];return n});var i=function(){function e(){n(this,e)}return r(e,null,[{key:"hex",value:function(e,t){t=t||2;for(var n=new Array(t),r=0;t>r;++r)n[t-r-1]=a[15&e],e>>=4;return n.join("")}}]),e}();t.Util=i},function(e,t,n){"use strict";function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t,n,r){var a="";switch(e.addressing){case s.Addressing.IMPLIED:case s.Addressing.ACCUMULATOR:break;case s.Addressing.IMMEDIATE:a=" #$"+o.Util.hex(t[n],2);break;case s.Addressing.IMMEDIATE16:a=" #$"+o.Util.hex(t[n]|t[n+1]<<8,4);break;case s.Addressing.ZEROPAGE:a=" $"+o.Util.hex(t[n],2);break;case s.Addressing.ZEROPAGE_X:a=" $"+o.Util.hex(t[n],2)+", X";break;case s.Addressing.ZEROPAGE_Y:a=" $"+o.Util.hex(t[n],2)+", Y";break;case s.Addressing.ABSOLUTE:a=" $"+o.Util.hex(t[n]|t[n+1]<<8,4);break;case s.Addressing.ABSOLUTE_X:a=" $"+o.Util.hex(t[n]|t[n+1]<<8,4)+", X";break;case s.Addressing.ABSOLUTE_Y:a=" $"+o.Util.hex(t[n]|t[n+1]<<8,4)+", Y";break;case s.Addressing.INDIRECT:a=" ($"+o.Util.hex(t[n]|t[n+1]<<8,4)+")";break;case s.Addressing.INDIRECT_X:a=" ($"+o.Util.hex(t[n],2)+", X)";break;case s.Addressing.INDIRECT_Y:a=" ($"+o.Util.hex(t[n],2)+"), Y";break;case s.Addressing.RELATIVE:var i=t[n];a=128>i?" +"+i+"  ; $"+o.Util.hex(r+e.bytes+i,4):" "+(i-256)+"  ; $"+o.Util.hex(r+e.bytes+i-256,4);break;default:console.error("Unhandled addressing: "+e.addressing)}return""+u[e.opType]+a}var i,s=n(6),o=n(7),u=(i={},r(i,s.OpType.LDA,"LDA"),r(i,s.OpType.STA,"STA"),r(i,s.OpType.LDX,"LDX"),r(i,s.OpType.STX,"STX"),r(i,s.OpType.LDY,"LDY"),r(i,s.OpType.STY,"STY"),r(i,s.OpType.TAX,"TAX"),r(i,s.OpType.TAY,"TAY"),r(i,s.OpType.TXA,"TXA"),r(i,s.OpType.TYA,"TYA"),r(i,s.OpType.TXS,"TXS"),r(i,s.OpType.TSX,"TSX"),r(i,s.OpType.ADC,"ADC"),r(i,s.OpType.SBC,"SBC"),r(i,s.OpType.INX,"INX"),r(i,s.OpType.INY,"INY"),r(i,s.OpType.INC,"INC"),r(i,s.OpType.DEX,"DEX"),r(i,s.OpType.DEY,"DEY"),r(i,s.OpType.DEC,"DEC"),r(i,s.OpType.AND,"AND"),r(i,s.OpType.ORA,"ORA"),r(i,s.OpType.EOR,"EOR"),r(i,s.OpType.ROL,"ROL"),r(i,s.OpType.ROR,"ROR"),r(i,s.OpType.ASL,"ASL"),r(i,s.OpType.LSR,"LSR"),r(i,s.OpType.BIT,"BIT"),r(i,s.OpType.CMP,"CMP"),r(i,s.OpType.CPX,"CPX"),r(i,s.OpType.CPY,"CPY"),r(i,s.OpType.JMP,"JMP"),r(i,s.OpType.JSR,"JSR"),r(i,s.OpType.RTS,"RTS"),r(i,s.OpType.RTI,"RTI"),r(i,s.OpType.BCC,"BCC"),r(i,s.OpType.BCS,"BCS"),r(i,s.OpType.BPL,"BPL"),r(i,s.OpType.BMI,"BMI"),r(i,s.OpType.BNE,"BNE"),r(i,s.OpType.BEQ,"BEQ"),r(i,s.OpType.BVC,"BVC"),r(i,s.OpType.BVS,"BVS"),r(i,s.OpType.PHA,"PHA"),r(i,s.OpType.PHP,"PHP"),r(i,s.OpType.PLA,"PLA"),r(i,s.OpType.PLP,"PLP"),r(i,s.OpType.CLC,"CLC"),r(i,s.OpType.SEC,"SEC"),r(i,s.OpType.SEI,"SEI"),r(i,s.OpType.CLI,"CLI"),
r(i,s.OpType.CLV,"CLV"),r(i,s.OpType.SED,"SED"),r(i,s.OpType.CLD,"CLD"),r(i,s.OpType.BRK,"BRK"),r(i,s.OpType.NOP,"NOP"),i);t.disassemble=a},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e){return e.concat()}function i(e,t,n,r){var a=8192+e;return 0===r?a^(n/30&1)<<11:a^(32&t)<<5}function s(e){return 16144===(65523&e)&&(e&=65519),e}function o(e,t){var n=0!==(t&A)?32:1;return e+n&p-1}var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=n(4),l=n(7),h=8,p=16384,d=256,f=0,v=128,y=32,E=16,T=8,A=4,g=3,O=1,m=8,C=16,k=2,b=128,P=64,R=3,I=5,L=6,w=7,B=64,S=128,D=function(){function e(){r(this,e),this.regs=new Uint8Array(h),this.vram=new Uint8Array(p),this.oam=new Uint8Array(d),this.mirrorMode=0,this.hevents={count:0,events:[]},this.hevents2={count:0,events:[]},this.chrBankOffset=new Array(8);for(var t=0;8>t;++t)this.chrBankOffset[t]=t<<10}return u(e,[{key:"reset",value:function(){this.regs.fill(0),this.vram.fill(0),this.oam.fill(0),this.hcount=0,this.scrollX=this.scrollY=0,this.ppuAddr=0,this.latch=0,this.bufferedValue=0,this.hevents={count:0,events:[]},this.hevents2={count:0,events:[]};for(var e=0;8>e;++e)this.chrBankOffset[e]=e<<10}},{key:"setChrData",value:function(e){e&&e.length>0?this.chrData=e:this.chrData=this.vram}},{key:"setChrBank",value:function(e){for(var t=0;8>t;++t)this.setChrBankOffset(t,(e<<3)+t)}},{key:"setChrBankOffset",value:function(e,t){var n=this.chrData.length;this.chrBankOffset[e]=t<<10&n-1,this.addHevent({scrollX:this.scrollX,scrollY:this.scrollY,ppuCtrl:this.regs[f],ppuMask:this.regs[O],chrBankOffset:a(this.chrBankOffset)})}},{key:"setMirrorMode",value:function(e){this.mirrorMode=e}},{key:"read",value:function(e){var t=this.regs[e];switch(e){case k:this.regs[k]&=~b,this.latch=0;break;case w:t=this.bufferedValue;var n=s(this.ppuAddr);this.bufferedValue=this.readPpuDirect(n),this.ppuAddr=o(this.ppuAddr,this.regs[f])}return t}},{key:"write",value:function(e,t){switch(this.regs[e]=t,e){case f:this.addHevent({scrollX:this.scrollX,scrollY:this.scrollY,ppuCtrl:this.regs[f],ppuMask:this.regs[O],chrBankOffset:a(this.chrBankOffset)});break;case I:0===this.latch?this.scrollX=t:(this.scrollY=t,this.addHevent({scrollX:this.scrollX,scrollY:this.scrollY,ppuCtrl:this.regs[f],ppuMask:this.regs[O],chrBankOffset:a(this.chrBankOffset)})),this.latch=1-this.latch;break;case L:0===this.latch?this.ppuAddr=t:this.ppuAddr=(this.ppuAddr<<8|t)&p-1,this.latch=1-this.latch;break;case w:var n=s(this.ppuAddr);this.vram[n]=t,this.ppuAddr=o(this.ppuAddr,this.regs[f])}}},{key:"copyWithDma",value:function(e,t){for(var n=this.oam,r=this.regs[R],a=0;256>a;++a)n[r]=e[t+a],r=r+1&255}},{key:"setVBlank",value:function(){this.regs[k]=(this.regs[k]|b)&~P;var e=this.hevents;this.hevents=this.hevents2,this.hevents2=e,this.hevents.count=0,this.addHevent({scrollX:this.scrollX,scrollY:this.scrollY,ppuCtrl:this.regs[f],ppuMask:this.regs[O],chrBankOffset:a(this.chrBankOffset)})}},{key:"clearVBlank",value:function(){this.regs[k]&=~b}},{key:"interruptEnable",value:function(){return 0!==(this.regs[f]&v)}},{key:"getBgPatternTableAddress",value:function(){return(this.regs[f]&E)<<8}},{key:"getSpritePatternTableAddress",value:function(){return 0===(this.regs[f]&y)?(this.regs[f]&T)<<9:0}},{key:"isSprite8x16",value:function(){return 0!==(this.regs[f]&y)}},{key:"renderBg",value:function(e){return 0===(this.regs[O]&m)?this.clearBg(e):void this.doRenderBgLine(e)}},{key:"doRenderBg",value:function(e,t,n,r,a,s){var o=this,u=function(e,t){var n=e+t,r=n>>10&7,a=o.chrBankOffset[r],i=1023&n,s=a+i;return c.kStaggered[o.chrData[s+8]]<<1|c.kStaggered[o.chrData[s]]},l=8,h=e.width,p=this.getBgPatternTableAddress(),d=this.vram,f=16128,v=e.data,y=63&d[f],E=c.kColors[3*y+0],T=c.kColors[3*y+1],A=c.kColors[3*y+2];n>=240&&(n-=256);for(var g=0;g<c.Const.HEIGHT/l+1;++g)for(var O=(g+(n>>3)+60)%60,m=O%30,C=0;C<c.Const.WIDTH/l+1;++C)for(var k=C+(t>>3)&63,b=31&k,P=i(s,k,O,this.mirrorMode),R=d[P+b+(m<<5)],I=16*R+p,L=(2&b)+((2&m)<<1),w=(b>>2)+(m<<1&248),B=P+960,S=(d[B+w]>>L&3)<<2,D=0;l>D;++D){var M=g*l+D-(7&n);if(!(0>M)){if(M>=c.Const.HEIGHT)break;for(var N=u(I,D),U=0;l>U;++U){var x=C*l+U-(7&t);if(!(0>x)){if(x>=c.Const.WIDTH)break;var X=N>>2*(l-1-U)&3,W=E,_=T,Y=A;if(0!==X){var H=S+X,G=63&d[f+H],F=3*G;W=c.kColors[F],_=c.kColors[F+1],Y=c.kColors[F+2]}var Z=4*((M+a)*h+(x+r));v[Z+0]=W,v[Z+1]=_,v[Z+2]=Y}}}}}},{key:"doRenderBgLine",value:function(e){for(var t=this.hevents.count,n=0;t>n;++n){var r=this.hevents.events[n],a=r.hcount,i=t-1>n?this.hevents.events[n+1].hcount:248;if(!(a>=i)){var s=(r.ppuCtrl&g)<<10,o=(r.ppuCtrl&E)<<8;this.doRenderBg2(e,r.scrollX,r.scrollY,s,a,i,r.chrBankOffset,o)}}}},{key:"doRenderBg2",value:function(e,t,n,r,a,s,o,u){var l=this,h=function(e,t,n){var r=e+t,a=r>>10&7,i=n[a],s=1023&r,o=i+s;return c.kStaggered[l.chrData[o+8]]<<1|c.kStaggered[l.chrData[o]]},p=8,d=e.width,f=this.vram,v=16128,y=e.data,E=63&f[v],T=c.kColors[3*E+0],A=c.kColors[3*E+1],g=c.kColors[3*E+2];n>=240&&(n-=256);for(var O=a/8|0,m=(s+7)/8|0,C=O;m>C;++C)for(var k=(C+(n>>3)+60)%60,b=k%30,P=0;P<c.Const.WIDTH/p+1;++P)for(var R=P+(t>>3)&63,I=31&R,L=i(r,R,k,this.mirrorMode),w=f[L+I+(b<<5)],B=16*w+u,S=(2&I)+((2&b)<<1),D=(I>>2)+(b<<1&248),M=L+960,N=(f[M+D]>>S&3)<<2,U=0;p>U;++U){var x=C*p+U-(7&n);if(!(0>x)){if(x>=c.Const.HEIGHT)break;for(var X=h(B,U,o),W=0;p>W;++W){var _=P*p+W-(7&t);if(!(0>_)){if(_>=c.Const.WIDTH)break;var Y=X>>2*(p-1-W)&3,H=T,G=A,F=g;if(0!==Y){var Z=N+Y,V=63&f[v+Z],j=3*V;H=c.kColors[j],G=c.kColors[j+1],F=c.kColors[j+2]}var K=4*(x*d+_);y[K+0]=H,y[K+1]=G,y[K+2]=F}}}}}},{key:"clearBg",value:function(e){for(var t=4*e.width,n=e.data,r=0;r<e.height;++r)for(var a=r*t,i=0;i<e.width;++i)n[a++]=0,n[a++]=0,n[a++]=0,n[a++]=255}},{key:"setHcount",value:function(e){this.hcount=e;var t=this.oam[0]+8;if(0===(this.regs[k]&P)&&e>=t&&t+16>e){var n=this.getNonEmptySprite0Line();n>=0&&e===t+n&&this.setSprite0Hit()}}},{key:"renderSprite",value:function(e){var t=this;if(0!==(this.regs[O]&C))for(var n=function(e,n,r){var a=e+(7&n)+2*(8&n),i=a>>10&7,s=t.chrBankOffset[i],o=1023&a,u=s+o,l=t.chrData[u+8],h=t.chrData[u];return r&&(l=c.kFlipBits[l],h=c.kFlipBits[h]),c.kStaggered[l]<<1|c.kStaggered[h]},r=8,a=e.width,i=3,s=this.oam,o=this.vram,u=this.getSpritePatternTableAddress(),l=16144,h=e.data,p=this.isSprite8x16(),d=p?16:8,f=64;--f>=0;)for(var v=s[4*f]+1,y=s[4*f+1],E=s[4*f+2],T=0!==(E&S),A=0!==(E&B),g=s[4*f+3],m=p?16*(254&y)+((1&y)<<12):16*y+u,k=(E&i)<<2,b=0;d>b&&!(v+b>=c.Const.HEIGHT);++b)for(var P=T?d-1-b:b,R=n(m,P,A),I=0;r>I&&!(g+I>=c.Const.WIDTH);++I){var L=R>>2*(r-1-I)&3;if(0!==L){var w=k+L,D=63&o[l+w],M=3*D,N=4*((v+b)*a+(g+I));h[N+0]=c.kColors[M],h[N+1]=c.kColors[M+1],h[N+2]=c.kColors[M+2]}}}},{key:"dumpVram",value:function(e,t){for(var n=[],r=0;t>r;++r)n.push(this.vram[s(e+r)]);for(var a=0;t>a;a+=16){var i=n.splice(0,16).map(function(e){return l.Util.hex(e,2)}).join(" ");console.log(l.Util.hex(e+a,4)+": "+i)}}},{key:"renderPattern",value:function(e,t){for(var n=8,r=e.width,a=e.data,i=0;2>i;++i)for(var s=0;16>s;++s)for(var o=0;16>o;++o)for(var u=16*(o+16*s+256*i),l=0;n>l;++l)for(var h=s*n+l,p=u+l,d=c.kStaggered[this.readPpuDirect(p+8)]<<1|c.kStaggered[this.readPpuDirect(p)],f=0;n>f;++f){var v=o*n+f+i*(16*n),y=d>>2*(n-1-f)&3,E=3*y,T=4*(h*r+v);a[T+0]=t[E+0],a[T+1]=t[E+1],a[T+2]=t[E+2]}}},{key:"setSprite0Hit",value:function(){this.regs[k]|=P}},{key:"getNonEmptySprite0Line",value:function(){for(var e=this,t=function(t,n){var r=t+(7&n)+2*(8&n),a=r>>10&7,i=e.chrBankOffset[a],s=1023&r,o=i+s,u=e.chrData[o+8],l=e.chrData[o];return c.kStaggered[u]<<1|c.kStaggered[l]},n=this.oam,r=this.getSpritePatternTableAddress(),a=this.isSprite8x16(),i=a?16:8,s=0,o=n[4*s+1],u=n[4*s+2],l=0!==(u&S),h=a?16*(254&o)+((1&o)<<12):16*o+r,p=0;i>p;++p){var d=l?i-1-p:p,f=t(h,d);if(0!==f)return p}return-1}},{key:"addHevent",value:function(e){var t=this.hcount;t>=240&&(t=0);var n=this.hevents,r=n.count;(0>=r||n.events[r-1].hcount!==t)&&++r>=n.events.length&&n.events.push({});var a=n.events[r-1];a.hcount=t;var i=!0,s=!1,o=void 0;try{for(var u,c=Object.keys(e)[Symbol.iterator]();!(i=(u=c.next()).done);i=!0){var l=u.value;a[l]=e[l]}}catch(h){s=!0,o=h}finally{try{!i&&c["return"]&&c["return"]()}finally{if(s)throw o}}n.count=r}},{key:"readPpuDirect",value:function(e){if(e>=8192)return this.vram[e];var t=this.chrBankOffset[e>>10&7];return this.chrData[(1023&e)+t]}}]),e}();t.Ppu=D},function(e,t,n){"use strict";var r=n(11),a=n(12),i=n(13),s=n(14),o=n(15);t.kMapperTable={0:r.mapper00,1:a.mapper01,2:i.mapper02,3:s.mapper03,4:o.mapper04}},function(e,t){"use strict";function n(e,t,n){t.setReadMemory(32768,49151,function(t){return e[t&e.length-1]}),t.setReadMemory(49152,65535,function(t){return e[t&e.length-1]})}t.mapper00=n},function(e,t,n){"use strict";function r(e,t,n){var r=16384,i=e.length,s=i/r,o=0;t.setReadMemory(32768,49151,function(t){return e[(t&r-1)+o]}),t.setReadMemory(49152,65535,function(t){return e[(t&r-1)+i-r]}),t.setWriteMemory(32768,65535,function(e,t){console.log("MMC1: Write "+a.Util.hex(e,4)+" <= "+a.Util.hex(t,2)),o=(t&s-1)*r})}var a=n(7);t.mapper01=r},function(e,t){"use strict";function n(e,t,n){var r=16384,a=e.length,i=a/r,s=0;t.setReadMemory(32768,49151,function(t){return e[(t&r-1)+s]}),t.setReadMemory(49152,65535,function(t){return e[(t&r-1)+a-r]}),t.setWriteMemory(32768,65535,function(e,t){s=(t&i-1)*r})}t.mapper02=n},function(e,t){"use strict";function n(e,t,n){t.setReadMemory(32768,49151,function(t){return e[t&e.length-1]}),t.setReadMemory(49152,65535,function(t){return e[t&e.length-1]}),t.setWriteMemory(32768,65535,function(e,t){n.setChrBank(t)})}t.mapper03=n},function(e,t,n){"use strict";function r(e,t,n,r){var i=(e.length>>13)-1,s=0,o=1,u=2,c=i<<13,l=new Uint8Array(8),h=function(e){0===(64&e)?(s=(l[6]&i)<<13,o=(l[7]&i)<<13,u=(254&i)<<13):(u=(l[6]&i)<<13,o=(l[7]&i)<<13,s=(254&i)<<13)},p=function(e){0===(128&e)?(n.setChrBankOffset(0,254&l[0]),n.setChrBankOffset(1,1|l[0]),n.setChrBankOffset(2,254&l[1]),n.setChrBankOffset(3,1|l[1]),n.setChrBankOffset(4,l[2]),n.setChrBankOffset(5,l[3]),n.setChrBankOffset(6,l[4]),n.setChrBankOffset(7,l[5])):(n.setChrBankOffset(4,254&l[0]),n.setChrBankOffset(5,1|l[0]),n.setChrBankOffset(6,254&l[1]),n.setChrBankOffset(7,1|l[1]),n.setChrBankOffset(0,l[2]),n.setChrBankOffset(1,l[3]),n.setChrBankOffset(2,l[4]),n.setChrBankOffset(3,l[5]))};t.setReadMemory(32768,40959,function(t){return e[(8191&t)+s]}),t.setReadMemory(40960,49151,function(t){return e[(8191&t)+o]}),t.setReadMemory(49152,57343,function(t){return e[(8191&t)+u]}),t.setReadMemory(57344,65535,function(t){return e[(8191&t)+c]});var d=new Uint8Array(8192);t.setReadMemory(24576,32767,function(e){return d[8191&e]}),t.setWriteMemory(24576,32767,function(e,t){d[8191&e]=t});var f=0;t.setWriteMemory(32768,40959,function(e,t){if(0===(1&e))f=t,h(f),p(f);else{var n=7&f;l[n]=t,6>n?p(f):h(f)}}),t.setWriteMemory(40960,49151,function(e,t){0===(1&e)?n.setMirrorMode(1&t):console.log("RAM write protect: "+a.Util.hex(t,2))});var v=-1,y=!1;t.setWriteMemory(49152,57343,function(e,t){0===(1&e)&&(v=t,y&&r.setIrqHline(v))}),t.setWriteMemory(57344,65535,function(e,t){0===(1&e)?y&&(y=!1,r.setIrqHline(-1)):y||(y=!0,r.setIrqHline(v))}),h(f),n.setMirrorMode(1)}var a=n(7);t.mapper04=r},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=["square","square","triangle"],i=function(){function e(){n(this,e)}return r(e,[{key:"destroy",value:function(){null!=this.gainNode&&(this.gainNode.disconnect(),this.gainNode=null),null!=this.oscillator&&(this.oscillator.disconnect(),this.oscillator=null)}},{key:"create",value:function(e,t){return this.gainNode=e.createGain(),this.gainNode.gain.value=0,this.oscillator=e.createOscillator(),this.oscillator.type=t,this.oscillator.connect(this.gainNode),this.gainNode.connect(e.destination),this}},{key:"start",value:function(){return this.oscillator.start(),this}},{key:"setFrequency",value:function(e){this.oscillator.frequency.setValueAtTime(e,0)}},{key:"setVolume",value:function(e){this.gainNode.gain.value=e}}]),e}(),s=function(){function e(){var t=this;n(this,e),this.context=new(window.AudioContext||window.webkitAudioContext),this.masterVolume=1,this.channels=a.map(function(e){var n=new i;return n.create(t.context,e).start(),n})}return r(e,[{key:"destroy",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,a=this.channels[Symbol.iterator]();!(e=(r=a.next()).done);e=!0){var i=r.value;i.destroy()}}catch(s){t=!0,n=s}finally{try{!e&&a["return"]&&a["return"]()}finally{if(t)throw n}}this.context.close(),this.context=null}},{key:"setChannelFrequency",value:function(e,t){this.channels[e].setFrequency(t)}},{key:"setChannelVolume",value:function(e,t){this.channels[e].setVolume(t*this.masterVolume)}},{key:"setMasterVolume",value:function(e){if(this.masterVolume=e,0>=e){var t=!0,n=!1,r=void 0;try{for(var a,i=this.channels[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var s=a.value;s.setVolume(0)}}catch(o){n=!0,r=o}finally{try{!t&&i["return"]&&i["return"]()}finally{if(n)throw r}}}}}]),e}();s.CHANNEL=3,t.AudioManager=s},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a,i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(3);!function(e){e[e.SPACE=32]="SPACE",e[e.RETURN=13]="RETURN",e[e.LEFT=37]="LEFT",e[e.UP=38]="UP",e[e.RIGHT=39]="RIGHT",e[e.DOWN=40]="DOWN",e[e.Z=90]="Z",e[e.X=88]="X",e[e.I=73]="I",e[e.J=74]="J",e[e.K=75]="K",e[e.L=76]="L",e[e.Q=81]="Q",e[e.W=87]="W",e[e.O=79]="O",e[e.P=80]="P"}(a||(a={}));var o=function(){var e={};return e[a.LEFT]={no:0,bit:s.PadBit.L},e[a.RIGHT]={no:0,bit:s.PadBit.R},e[a.UP]={no:0,bit:s.PadBit.U},e[a.DOWN]={no:0,bit:s.PadBit.D},e[a.Z]={no:0,bit:s.PadBit.B},e[a.X]={no:0,bit:s.PadBit.A},e[a.SPACE]={no:0,bit:s.PadBit.SELECT},e[a.RETURN]={no:0,bit:s.PadBit.START},e[a.J]={no:1,bit:s.PadBit.L},e[a.L]={no:1,bit:s.PadBit.R},e[a.I]={no:1,bit:s.PadBit.U},e[a.K]={no:1,bit:s.PadBit.D},e[a.Q]={no:1,bit:s.PadBit.B},e[a.W]={no:1,bit:s.PadBit.A},e[a.O]={no:1,bit:s.PadBit.SELECT},e[a.P]={no:1,bit:s.PadBit.START},e}(),u=function(){function e(){r(this,e),this.controller=[0,0]}return i(e,[{key:"onKeyDown",value:function(e){var t=o[e];t&&(this.controller[t.no]|=t.bit)}},{key:"onKeyUp",value:function(e){var t=o[e];t&&(this.controller[t.no]&=~t.bit)}},{key:"getStatus",value:function(e){return this.controller[e]}}]),e}();t.PadKeyHandler=u},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e){var t=e.getContext("2d");t.strokeStyle="",t.fillStyle="rgb(64,64,64)",t.fillRect(0,0,e.width,e.height)}var o=function(){function e(e,t){var n=[],r=!0,a=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(u){a=!0,i=u}finally{try{!r&&o["return"]&&o["return"]()}finally{if(a)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=n(19),l=n(2),h=n(5),p=n(6),d=n(8),f=n(7),v=function(e){function t(e,n){r(this,t);var i=document.createElement("canvas");i.width=256,i.height=240,i.style.width="100%",i.style.height="100%",i.className="pixelated",s(i);var o=a(this,Object.getPrototypeOf(t).call(this,e,512,480,"NES",i));return o.nes=n,o.canvas=i,o.context=o.canvas.getContext("2d"),o.imageData=o.context.getImageData(0,0,o.canvas.width,o.canvas.height),o.addResizeBox(),o}return i(t,e),u(t,[{key:"update",value:function(){this.nes.render(this.context,this.imageData)}},{key:"capture",value:function(){return this.canvas.toDataURL()}}]),t}(c["default"]);t.ScreenWnd=v;var y=function(e){function t(e,n){r(this,t);var i=t.createDom(),s=o(i,2),u=s[0],c=s[1],l=a(this,Object.getPrototypeOf(t).call(this,e,128,16,"Palette",u));return l.nes=n,l.boxes=c,l.palet=new Uint8Array(t.W*t.H),l.tmp=new Uint8Array(t.W*t.H),l}return i(t,e),u(t,[{key:"update",value:function(){var e=this.tmp;t.getPalet(this.nes,e);for(var n=t.W*t.H,r=0;n>r;++r){var a=e[r];a!==this.palet[r]&&(this.palet[r]=a,this.boxes[r].style.backgroundColor=l.Nes.getPaletColorString(a))}}}],[{key:"createDom",value:function(){var e=t.UNIT,n=t.W,r=t.H,a=document.createElement("div");a.className="clearfix",a.style.width=e*n+"px",a.style.height=e*r+"px";for(var i=new Array(n*r),s=0;r>s;++s)for(var o=0;n>o;++o){var u=document.createElement("div");u.className="pull-left",u.style.width=e-1+"px",u.style.height=e-1+"px",u.style.borderRight=u.style.borderBottom="1px solid black",i[o+s*n]=u,a.appendChild(u)}return[a,i]}},{key:"getPalet",value:function(e,n){for(var r=t.W*t.H,a=0;r>a;++a)n[a]=e.getPalet(a)}}]),t}(c["default"]);y.UNIT=8,y.W=16,y.H=2,t.PaletWnd=y;var E=function(e){function t(e,n){r(this,t);var i=document.createElement("canvas");i.width=512,i.height=240,i.style.width="512px",i.style.height="240px",i.className="pixelated",s(i);var o=a(this,Object.getPrototypeOf(t).call(this,e,512,240,"NameTable",i));return o.nes=n,o.canvas=i,o}return i(t,e),u(t,[{key:"update",value:function(){this.nes.renderNameTable(this.canvas)}}]),t}(c["default"]);t.NameTableWnd=E;var T=[0,0,0,255,0,0,0,255,0,0,0,255],A=function(e){function t(e,n){r(this,t);var i=t.createCanvas(),s=a(this,Object.getPrototypeOf(t).call(this,e,256,128,"PatternTable",i));return s.nes=n,s.canvas=i,s}return i(t,e),u(t,[{key:"update",value:function(){this.nes.renderPatternTable(this.canvas,T)}}],[{key:"createCanvas",value:function(){var e=document.createElement("canvas");return e.width=256,e.height=128,e.style.width="256px",e.style.height="128px",e.className="pixelated",s(e),e}}]),t}(c["default"]);t.PatternTableWnd=A;var g=function(e){function t(e,n){r(this,t);var i=document.createElement("div");i.className="fixed-font";var s=a(this,Object.getPrototypeOf(t).call(this,e,100,160,"Regs",i));return s.nes=n,s.createContent(i),s}return i(t,e),u(t,[{key:"updateStatus",value:function(){var e=this.nes.cpu;this.valueElems[0].value=f.Util.hex(e.pc,4),this.valueElems[1].value=f.Util.hex(e.a,2),this.valueElems[2].value=f.Util.hex(e.x,2),this.valueElems[3].value=f.Util.hex(e.y,2),this.valueElems[4].value=f.Util.hex(e.s,2),this.valueElems[5].value=f.Util.hex(e.p,2),this.valueElems[6].value=String(this.nes.cycleCount)}},{key:"createContent",value:function(e){var t=[{name:"PC"},{name:"A"},{name:"X"},{name:"Y"},{name:"S"},{name:"P"},{name:"cycle"}],n=document.createElement("table");n.style.fontSize="10px",n.style.width="100%",this.valueElems=[];for(var r=0;r<t.length;++r){var a=document.createElement("tr");n.appendChild(a);var i=document.createElement("td");i.innerText=t[r].name,a.appendChild(i);var s=document.createElement("td");a.appendChild(s);var o=document.createElement("input");o.className="fixed-font",o.type="text",o.style.width="100%",s.appendChild(o),this.valueElems.push(o)}e.appendChild(n)}}]),t}(c["default"]);t.RegisterWnd=g;var O=3,m=100,C={opType:p.OpType.UNKNOWN,addressing:p.Addressing.UNKNOWN,bytes:1,cycle:0},k=function(e){function t(e,n){r(this,t);var i=document.createElement("div"),s=a(this,Object.getPrototypeOf(t).call(this,e,400,160,"Trace",i));return s.nes=n,s.createContent(i),s.mem=new Uint8Array(O),s.bins=new Array(O),s.reset(),s}return i(t,e),u(t,[{key:"reset",value:function(){this.lines=[]}},{key:"updateStatus",value:function(){for(var e=this.nes.cpu,t=e.read8Raw(e.pc),n=h.Cpu6502.getInst(t)||C,r=0;r<n.bytes;++r){var a=e.read8Raw(e.pc+r);this.mem[r]=a,this.bins[r]=f.Util.hex(a,2)}for(var i=n.bytes;O>i;++i)this.bins[i]="  ";var s=f.Util.hex(e.pc,4),o=this.bins.join(" "),u=d.disassemble(n,this.mem,1,e.pc);this.putConsole(s+": "+o+"   "+u)}},{key:"createContent",value:function(e){var t=document.createElement("textarea");t.className="fixed-font",t.style.fontSize="14px",t.style.width="100%",t.style.height="160px",t.style.resize="none",t.style.margin="0",t.style.padding="2px",t.style.border="none",t.style.boxSizing="border-box",e.appendChild(t),this.textarea=t}},{key:"putConsole",value:function(e){this.lines.push(e),this.lines.length>m&&this.lines.shift(),this.textarea.value=this.lines.join("\n"),this.textarea.scrollTop=this.textarea.scrollHeight}}]),t}(c["default"]);t.TraceWnd=k;var b=function(e){function t(e,n,i,s){r(this,t);var o=document.createElement("div"),u=a(this,Object.getPrototypeOf(t).call(this,e,384,32,"Control",o));return u.nes=n,u.screenWnd=i,u.audioManager=s,u.createElement(o),u.updateState(!0),u}return i(t,e),u(t,[{key:"updateState",value:function(e){this.stepBtn.disabled=!e,this.runBtn.disabled=!e,this.pauseBtn.disabled=e}},{key:"createElement",value:function(e){var t=this;e.style.width="384px",e.style.height="32px",this.stepBtn=document.createElement("button"),this.stepBtn.innerText="Step",this.stepBtn.addEventListener("click",function(){var e=t.nes.cpu.isPaused();t.nes.cpu.pause(!1),t.nes.step(),e&&t.nes.cpu.pause(!0),t.callback("step")}),e.appendChild(this.stepBtn),this.runBtn=document.createElement("button"),this.runBtn.innerText="Run",this.runBtn.addEventListener("click",function(){t.nes.cpu.pause(!1),t.updateState(!1)}),e.appendChild(this.runBtn),this.pauseBtn=document.createElement("button"),this.pauseBtn.innerText="Pause",this.pauseBtn.addEventListener("click",function(){t.nes.cpu.pause(!0),t.updateState(!0),t.callback("paused")}),e.appendChild(this.pauseBtn);var n=document.createElement("button");n.innerText="Reset",n.addEventListener("click",function(){t.nes.reset(),t.callback("reset")}),e.appendChild(n);var r=document.createElement("button");r.innerText="Capture",r.addEventListener("click",function(){var e=document.createElement("img"),n=String(Date.now());e.src=t.screenWnd.capture(),e.className="pixelated",e.style.width=e.style.height="100%",e.title=e.alt=n;var r=new c["default"](t.wndMgr,256,240,n,e);r.addResizeBox(),t.wndMgr.add(r)}),e.appendChild(r);var a=document.createElement("label"),i=document.createElement("input");i.type="checkbox",i.checked=!0,i.addEventListener("click",function(){var e=i.checked?0:1;t.audioManager.setMasterVolume(e)}),a.appendChild(i),a.appendChild(document.createTextNode("mute")),e.appendChild(a)}}]),t}(c["default"]);t.ControlWnd=b},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){var n=[],r=!0,a=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(u){a=!0,i=u}finally{try{!r&&o["return"]&&o["return"]()}finally{if(a)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(t,r,a,i,s){n(this,e),this.wndMgr=t,this.callback=function(){},this.root=this.createRoot(),this.root.className="wnd",this.root.style.position="absolute",this.root.style.width=r+"px",this.root.style.height=a+e.HEADER_HEIGHT+"px",this.createTitleBar(i);var o=document.createElement("div");o.className="content-holder",o.appendChild(s),this.root.appendChild(o)}return a(e,[{key:"setPos",value:function(e,t){this.root.style.left=e+"px",this.root.style.top=t+"px"}},{key:"setTitle",value:function(e){this.titleElem.innerText=e}},{key:"setCallback",value:function(e){this.callback=e}},{key:"getRootNode",value:function(){return this.root}},{key:"close",value:function(){this.callback("close")!==!1&&(this.wndMgr.remove(this),this.root=null)}},{key:"update",value:function(){}},{key:"addResizeBox",value:function(){var t=this;this.root.classList.add("resizable");var n=8,a=[{styleParams:{right:"-1px",bottom:"-1px",cursor:"nwse-resize"},horz:"right",vert:"bottom"},{styleParams:{left:"-1px",bottom:"-1px",cursor:"nesw-resize"},horz:"left",vert:"bottom"},{styleParams:{right:"-1px",top:"-1px",cursor:"nesw-resize"},horz:"right",vert:"top"},{styleParams:{left:"-1px",top:"-1px",cursor:"nwse-resize"},horz:"left",vert:"top"}],i=64,s=24+e.HEADER_HEIGHT;a.forEach(function(a){var o=document.createElement("div");o.style.position="absolute",Object.keys(a.styleParams).forEach(function(e){o.style[e]=a.styleParams[e]}),o.style.width=o.style.height=n+"px",o.style.zIndex="100";var u=void 0,c=void 0,l=function(n){var o=t.getMousePosIn(n,t.root.parentNode),l=r(o,2),h=l[0],p=l[1],d=t.root.getBoundingClientRect(),f=t.root.parentNode.getBoundingClientRect(),v={left:d.left-f.left,top:d.top-f.top,right:d.right-f.left,bottom:d.bottom-f.top};v[a.horz]=h+u,v[a.vert]=p+c;var y=v.right-v.left-2,E=v.bottom-v.top-2;i>y&&(v[a.horz]-=(i-y)*("left"===a.horz?1:-1)),s>E&&(v[a.vert]-=(s-E)*("top"===a.vert?1:-1)),t.root.style.width=v.right-v.left-2+"px",t.root.style.height=v.bottom-v.top-2+"px",t.root.style.left=v.left+"px",t.root.style.top=v.top+"px",t.callback("resize",y,E-e.HEADER_HEIGHT)},h=function p(e){t.root.parentNode.removeEventListener("mousemove",l),t.root.parentNode.removeEventListener("mouseup",p)};o.addEventListener("mousedown",function(e){e.stopPropagation(),e.preventDefault();var i=t.getMousePosIn(e,o),s=r(i,2),p=s[0],d=s[1];u="left"===a.horz?-p:n-p,c="top"===a.vert?-d:n-d,t.root.parentNode.addEventListener("mousemove",l),t.root.parentNode.addEventListener("mouseup",h),t.wndMgr.moveToTop(t)}),t.root.appendChild(o)})}},{key:"createRoot",value:function(){var e=this,t=document.createElement("div");return t.addEventListener("mousedown",function(t){return t.stopPropagation(),e.wndMgr.moveToTop(e),!1}),t}},{key:"createTitleBar",value:function(e){var t=this;this.titleBar=document.createElement("div"),this.titleBar.className="title-bar clearfix",this.addTitleButton(this.titleBar,"close",function(){t.close()}),this.titleElem=this.addTitle(this.titleBar,e);var n=void 0,a=void 0,i=function(e){var i=t.getMousePosIn(e,t.root.parentNode),s=r(i,2),o=s[0],u=s[1];t.root.style.left=o+n+"px",t.root.style.top=u+a+"px"},s=function o(e){t.root.parentNode.removeEventListener("mousemove",i),t.root.parentNode.removeEventListener("mouseup",o)};this.titleBar.addEventListener("mousedown",function(e){if(n=a=null,0===e.button){e.preventDefault();var o=t.getMousePosIn(e,t.root),u=r(o,2),c=u[0],l=u[1];return n=-c,a=-l,t.root.parentNode.addEventListener("mousemove",i),t.root.parentNode.addEventListener("mouseup",s),!0}}),this.root.appendChild(this.titleBar)}},{key:"addTitleButton",value:function(e,t,n){var r=document.createElement("div");return r.className=t+" btn",r.addEventListener("click",n),r.addEventListener("mousedown",function(e){e.preventDefault(),e.stopPropagation()}),e.appendChild(r),r}},{key:"addTitle",value:function(e,t){var n=document.createElement("div");return n.className="title",n.appendChild(document.createTextNode(t)),e.appendChild(n),n}},{key:"getMousePosIn",value:function(e,t){var n=t.getBoundingClientRect(),r=document.body.scrollLeft,a=document.body.scrollTop;return[e.pageX-n.left-r,e.pageY-n.top-a]}}]),e}();i.HEADER_HEIGHT=12,Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=i},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t,n){e.getRootNode().style.zIndex=String(i+(n-1-t))}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=100,s=function(){function e(t){n(this,e),this.root=t,this.windows=[]}return a(e,[{key:"add",value:function(e){this.windows.unshift(e),this.root.appendChild(e.getRootNode()),r(e,0,this.windows.length)}},{key:"remove",value:function(e){this.removeWnd(e);var t=e.getRootNode();null!=t&&t.parentNode.removeChild(t)}},{key:"moveToTop",value:function(e){var t=this.windows.length;if(!(t>0&&this.windows[0]===e))for(var n=e,a=0;t>a;++a){var i=this.windows[a];if(this.windows[a]=n,r(n,a,t),i===e)break;n=i}}},{key:"update",value:function(){this.windows.forEach(function(e){e.update()})}},{key:"removeWnd",value:function(e){var t=this.windows.indexOf(e);if(!(0>t)){this.windows.splice(t,1);for(var n=(this.windows.length,0);t>n;++n)r(this.windows[n],n,this.windows.length)}}}]),e}();Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=s}]);