!function(e){function t(n){if(r[n])return r[n].exports;var i=r[n]={exports:{},id:n,loaded:!1};return e[n].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}({0:function(e,t,r){"use strict";function n(e){var t=e.lastIndexOf(".");return t>=0?e.slice(t+1):""}function i(e,t){var r=new FileReader;r.onload=function(r){var n=new Uint8Array(r.target.result);t(n,e.name)},r.readAsArrayBuffer(e)}function a(e,t){var r=new FileReader;r.onload=function(e){var r=new Uint8Array(e.target.result),i=new JSZip;i.loadAsync(r).then(function(e){Object.keys(e.files).forEach(function(e){"nes"===n(e).toLowerCase()&&i.file(e).async("uint8array").then(function(r){t(r,e)})["catch"](function(e){console.error(e)})})})["catch"](function(e){console.error(e)})},r.readAsArrayBuffer(e)}function s(e,t){function r(e){e.stopPropagation(),e.preventDefault();var r=e.dataTransfer.files;if(r.length>0)for(var s=0;s<r.length;++s){var o=r[s];switch(n(o.name).toLowerCase()){case"nes":i(o,function(r,n){t(r,n,e.pageX,e.pageY)});break;case"zip":a(o,function(r,n){t(r,n,e.pageX,e.pageY)})}}return!1}function s(e){return e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy",!1}e.addEventListener("dragover",s,!1),e.addEventListener("drop",r,!1)}var o=r(431),u=r(459),c=r(465);r(437),window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame}(),window.addEventListener("load",function(){o.App.setUp();var e=document.getElementById("nesroot"),t=new c["default"](e);window.File&&window.FileReader&&window.FileList&&window.Blob&&s(e,function(e,r,n,i){var a={title:r,centerX:n,centerY:i},s=o.App.create(t,a);s.loadRom(e)});var r=document.getElementById("gamepad");u.GamepadManager.isSupported()?r.addEventListener("click",function(){var e=new u.GamepadWnd(t);t.add(e)}):r.style.display="none"})},431:function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t,r){return t>e?t:(t>r&&(r=t),e>r?r:e)}var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=r(432),o=r(457),u=r(458),c=r(459),l=r(463),h=r(464),f=r(461),p=1789773,d=1e3/15,v=function(){function e(t,r){var a=this;n(this,e),this.wndMgr=t,this.destroying=!1,this.nes=s.Nes.create(),window.nes=this.nes,this.nes.setVblankCallback(function(e){a.onVblank(e)}),this.nes.setBreakPointCallback(function(){a.onBreakPoint()}),this.audioManager=new u.AudioManager,this.stream=new o.AppEvent.Stream,this.subscription=this.stream.subscribe(function(e){switch(e){case o.AppEvent.Type.DESTROY:a.cleanUp();break;case o.AppEvent.Type.RENDER:break;case o.AppEvent.Type.RUN:a.nes.cpu.pause(!1);break;case o.AppEvent.Type.PAUSE:a.nes.cpu.pause(!0);break;case o.AppEvent.Type.STEP:a.nes.step();break;case o.AppEvent.Type.RESET:a.nes.reset()}}),this.screenWnd=new h.ScreenWnd(this.wndMgr,this,this.nes,this.stream),this.wndMgr.add(this.screenWnd),r.title&&this.screenWnd.setTitle(r.title);var c=this.screenWnd.getWindowSize(),f=i((r.centerX||0)-c.width/2,0,window.innerWidth-c.width-1),p=i((r.centerY||0)-c.height/2,0,window.innerHeight-c.height-1);this.screenWnd.setPos(f,p),this.padKeyHandler=new l.PadKeyHandler,this.setUpKeyEvent(this.screenWnd.getCanvas(),this.padKeyHandler),this.startLoopAnimation()}return a(e,[{key:"loadRom",value:function(e){return this.nes.setRomData(e)?(this.nes.reset(),this.nes.cpu.pause(!1),this.screenWnd.setFocus(),this.stream.triggerLoadRom(),window.$DEBUG&&(this.createPaletWnd(),this.createNameTableWnd(),this.createPatternTableWnd(),this.createTraceWnd(),this.createRegisterWnd(),this.createControlWnd()),!0):(alert("Illegal ROM format"),!1)}},{key:"createPaletWnd",value:function(){var e=this;if(this.hasPaletWnd)return!1;var t=new h.PaletWnd(this.wndMgr,this.nes,this.stream);return this.wndMgr.add(t),t.setPos(520,0),t.setCallback(function(t){"close"===t&&(e.hasPaletWnd=!1)}),this.hasPaletWnd=!0}},{key:"createNameTableWnd",value:function(){var e=this;if(this.hasNameTableWnd)return!1;var t=new h.NameTableWnd(this.wndMgr,this.nes,this.stream);return this.wndMgr.add(t),t.setPos(520,40),t.setCallback(function(t){"close"===t&&(e.hasNameTableWnd=!1)}),this.hasNameTableWnd=!0}},{key:"createPatternTableWnd",value:function(){var e=this;if(this.hasPatternTableWnd)return!1;var t=new h.PatternTableWnd(this.wndMgr,this.nes,this.stream);return this.wndMgr.add(t),t.setPos(520,300),t.setCallback(function(t){"close"===t&&(e.hasPatternTableWnd=!1)}),this.hasPatternTableWnd=!0}},{key:"createTraceWnd",value:function(){var e=this;if(this.hasTraceWnd)return!1;var t=new h.TraceWnd(this.wndMgr,this.nes,this.stream);return this.wndMgr.add(t),t.setPos(0,500),t.setCallback(function(t){"close"===t&&(e.hasTraceWnd=!1)}),this.hasTraceWnd=!0}},{key:"createRegisterWnd",value:function(){var e=this;if(null!=this.hasRegisterWnd)return!1;var t=new h.RegisterWnd(this.wndMgr,this.nes,this.stream);return this.wndMgr.add(t),t.setPos(410,500),t.setCallback(function(t){"close"===t&&(e.hasRegisterWnd=null)}),this.hasRegisterWnd=!0}},{key:"createControlWnd",value:function(){var e=this;if(null!=this.hasCtrlWnd)return!1;var t=new h.ControlWnd(this.wndMgr,this.stream);return this.wndMgr.add(t),t.setPos(520,500),t.setCallback(function(t){"close"===t&&(e.hasCtrlWnd=null)}),this.hasCtrlWnd=!0}},{key:"cleanUp",value:function(){this.destroying=!0,this.audioManager.destroy(),this.subscription.unsubscribe(),this.wndMgr=null}},{key:"onVblank",value:function(e){1>e&&this.render();for(var t=0;t<u.AudioManager.CHANNEL;++t)this.audioManager.setChannelFrequency(t,this.nes.apu.getFrequency(t)),this.audioManager.setChannelVolume(t,this.nes.apu.getVolume(t))}},{key:"onBreakPoint",value:function(){this.stream.triggerBreakPoint()}},{key:"startLoopAnimation",value:function(){var e=this,t=window.performance.now(),r=function n(){if(!e.destroying){e.stream.triggerStartCalc();var r=window.performance.now(),i=r-t;t=r,e.loop(i),e.stream.triggerEndCalc(),requestAnimationFrame(n)}};requestAnimationFrame(r)}},{key:"loop",value:function(e){if(!this.nes.cpu.isPaused()){for(var t=this.screenWnd.isTop(),r=0;2>r;++r){var n=this.padKeyHandler.getStatus(r);t&&(n|=c.GamepadManager.getState(r)),this.nes.setPadStatus(r,n)}var i=Math.min(e,d),a=p*i/1e3|0;this.nes.runCycles(a)}}},{key:"render",value:function(){this.stream.triggerRender()}},{key:"setUpKeyEvent",value:function(e,t){e.setAttribute("tabindex","1"),e.style.outline="none",e.addEventListener("keydown",function(e){e.ctrlKey||e.altKey||e.metaKey||(e.preventDefault(),t.onKeyDown(e.keyCode))}),e.addEventListener("keyup",function(e){e.preventDefault(),t.onKeyUp(e.keyCode)})}}],[{key:"setUp",value:function(){f["default"].setKeyPrefix("nesemu:"),c.GamepadManager.setUp()}},{key:"create",value:function(t,r){return new e(t,r)}}]),e}();t.App=v},432:function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e){return e*(3/341)|0}function a(e){return 78===e[0]&&69===e[1]&&83===e[2]&&26===e[3]}function s(e){return e[6]>>4&15|240&e[7]}function o(e){var t=16,r=16384*e[4],n=e.slice(t,t+r);return new Uint8Array(n)}function u(e){var t=16+16384*e[4],r=8192*e[5],n=e.slice(t,t+r);return new Uint8Array(n)}var c=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),l=r(433),h=r(434),f=r(435),p=r(440),d=r(438),v=r(441),y=2048,E=241,m=242,g=261,b=262,k=341*b/3|0,T=function(){function e(){n(this,e),this.cpu=new f.Cpu,this.ram=new Uint8Array(y),this.ppu=new p.Ppu,this.apu=new l.Apu,this.mapperNo=0,this.cycleCount=0,this.vblankCallback=function(e){},this.breakPointCallback=function(){},this.irqHlineEnable=!1,this.irqHlineValue=this.irqHlineCounter=-1,this.romData=new Uint8Array(0)}return c(e,[{key:"setVblankCallback",value:function(e){this.vblankCallback=e}},{key:"setBreakPointCallback",value:function(e){this.breakPointCallback=e}},{key:"setRomData",value:function(e){return a(e)?(this.mapperNo=s(e),this.romData=o(e),this.ppu.setChrData(u(e)),this.ppu.setMirrorMode(0===(1&e[6])?p.MirrorMode.HORZ:p.MirrorMode.VERT),this.cpu.deleteAllBreakPoints(),this.setMemoryMap(this.mapperNo),!0):!1}},{key:"reset",value:function(){this.ram.fill(255),this.cpu.reset(),this.ppu.reset(),this.apu.reset(),this.cycleCount=0,this.irqHlineEnable=!1,this.irqHlineValue=this.irqHlineCounter=-1}},{key:"setPadStatus",value:function(e,t){this.apu.setPadStatus(e,t)}},{key:"runCycles",value:function(e){try{for(var t=e;t>0;){var r=this.step(t);if(t-=r,this.cpu.isPaused())return this.breakPointCallback(),0}return-e}catch(n){throw this.cpu.pause(!0),n}}},{key:"step",value:function(e){var t=this.cpu.step();return this.cycleCount=this.tryHblankEvent(this.cycleCount,t,e),t}},{key:"enableIrqHline",value:function(e){this.irqHlineEnable=e}},{key:"setIrqHlineValue",value:function(e){this.irqHlineValue=e}},{key:"resetIrqHlineCounter",value:function(){this.irqHlineCounter=0}},{key:"render",value:function(e,t){this.ppu.renderBg(t),this.ppu.renderSprite(t),e.putImageData(t,0,0)}},{key:"renderNameTable",value:function(e){var t=e.getContext("2d"),r=t.getImageData(0,0,e.width,e.height);this.ppu.doRenderBg(r,0,0,0,0,0),this.ppu.doRenderBg(r,0,0,256,0,1024),t.putImageData(r,0,0)}},{key:"renderPatternTable",value:function(e,t){var r=e.getContext("2d"),n=r.getImageData(0,0,e.width,e.height);this.ppu.renderPattern(n,t),r.putImageData(n,0,0)}},{key:"getPalet",value:function(e){var t=this.ppu.vram,r=16128;return 63&t[r+(31&e)]}},{key:"setMemoryMap",value:function(e){var t=this,r=16404,n=this.cpu;n.resetMemoryMap(),n.setReadMemory(8192,16383,function(e){var r=7&e;return t.ppu.read(r)}),n.setWriteMemory(8192,16383,function(e,r){var n=7&e;t.ppu.write(n,r)}),n.setReadMemory(16384,24575,function(e){return t.apu.read(e)}),n.setWriteMemory(16384,24575,function(e,n){switch(e){case r:n>=0&&31>=n?t.ppu.copyWithDma(t.ram,n<<8):console.error("OAMDMA not implemented except for RAM: "+d.Util.hex(n,2));break;default:t.apu.write(e,n)}}),n.setReadMemory(0,8191,function(e){return t.ram[e&y-1]}),n.setWriteMemory(0,8191,function(e,r){t.ram[e&y-1]=r}),this.setMemoryMapForMapper(e)}},{key:"setMemoryMapForMapper",value:function(e){console.log("Mapper "+e),e in v.kMapperTable?v.kMapperTable[e](this.romData,this.cpu,this.ppu,this):(console.error("  not supported"),v.kMapperTable[0](this.romData,this.cpu,this.ppu,this))}},{key:"tryHblankEvent",value:function(e,t,r){var n=e+t,a=i(e),s=i(n);if(s>a){switch(this.ppu.setHcount(s),s){case E:this.apu.isIrqEnabled()&&(this.apu.setFrameInterrupt(),this.cpu.requestIrq()),this.vblankCallback(r/k),this.ppu.setVBlank();break;case m:this.interruptVBlank();break;case g:this.ppu.clearVBlank();break;case b:n-=341*b/3|0,this.ppu.hcount=0,this.irqHlineCounter=this.irqHlineValue}0!==(24&this.ppu.regs[1])&&0===--this.irqHlineCounter&&this.irqHlineEnable&&this.cpu.requestIrq()}return n}},{key:"interruptVBlank",value:function(){this.ppu.interruptEnable()&&this.interruptNmi()}},{key:"interruptNmi",value:function(){this.cpu.nmi()}}],[{key:"create",value:function(){return new e}},{key:"getPaletColorString",value:function(e){var t=h.kColors[3*e],r=h.kColors[3*e+1],n=h.kColors[3*e+2];return"rgb("+t+","+r+","+n+")"}}]),e}();t.Nes=T},433:function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();!function(e){e[e.A=0]="A",e[e.B=1]="B",e[e.SELECT=2]="SELECT",e[e.START=3]="START",e[e.U=4]="U",e[e.D=5]="D",e[e.L=6]="L",e[e.R=7]="R"}(t.PadBit||(t.PadBit={}));t.PadBit;!function(e){e[e.A=1]="A",e[e.B=2]="B",e[e.SELECT=4]="SELECT",e[e.START=8]="START",e[e.U=16]="U",e[e.D=32]="D",e[e.L=64]="L",e[e.R=128]="R"}(t.PadValue||(t.PadValue={}));var i=(t.PadValue,16384),a=16405,s=16406,o=16407,u=16407,c=64,l=128,h=16,f=32,p=[10,254,20,2,40,4,80,6,160,8,60,10,14,12,26,14,12,16,24,18,48,20,96,22,192,24,72,26,16,28,32,30],d=[4,8,16,32,64,96,128,160,202,254,380,508,762,1016,2034,4068].map(function(e){return 1*e}),v=function(){function e(){r(this,e),this.padStatus=new Array(2),this.padTmp=new Array(2),this.regs=new Uint8Array(32),this.lengthCounter=new Array(e.CHANNEL),this.channelStopped=new Array(e.CHANNEL)}return n(e,[{key:"reset",value:function(){this.regs.fill(0),this.regs[u-i]=c,this.frameInterrupt=0,this.dmcInterrupt=128;for(var t=0;t<e.CHANNEL;++t)this.lengthCounter[t]=0,this.channelStopped[t]=!0}},{key:"read",value:function(t){switch(t){case a:for(var r=this.dmcInterrupt|this.frameInterrupt,n=0;n<e.CHANNEL;++n)this.lengthCounter[n]>0&&(r|=1<<n);return this.frameInterrupt=0,r;case s:case o:return this.shiftPad(t-s);default:return 0}}},{key:"write",value:function(e,t){if(16416>e&&(this.regs[e-16384]=t,16400>e)){var r=e-16384>>2;if(3===(3&e)){var n=p[t>>3];this.lengthCounter[r]=n,this.channelStopped[r]=!1}}switch(e){case a:this.dmcInterrupt=0;break;case s:0===(1&t)&&this.latchPad()}}},{key:"getFrequency",value:function(e){switch(e){case 0:case 1:var t=this.regs[4*e+2]+((7&this.regs[4*e+3])<<8);return 111875/(t+1)|0;case 2:var r=this.regs[4*e+2]+((7&this.regs[4*e+3])<<8);return 223750/(r+1)|0;case 3:var n=15&this.regs[4*e+2];return d[n]}}},{key:"getVolume",value:function(e){if(0===(this.regs[21]&1<<e)||this.channelStopped[e])return 0;var t=this.lengthCounter[e],r=this.regs[4*e];if(0===(r&f)&&(this.lengthCounter[e]=t-=2,0>=t))return this.regs[4*e]=r=240&r,this.lengthCounter[e]=0,this.channelStopped[e]=!0,0;switch(e){case 0:case 1:case 3:return 0!==(r&h)?(15&r)/15:1;case 2:return 1}return 0}},{key:"setPadStatus",value:function(e,t){this.padStatus[e]=t}},{key:"isIrqEnabled",value:function(){return 0===(this.regs[u-i]&(c|l))}},{key:"setFrameInterrupt",value:function(){this.frameInterrupt=64}},{key:"latchPad",value:function(){this.padTmp[0]=this.padStatus[0],this.padTmp[1]=this.padStatus[1]}},{key:"shiftPad",value:function(e){var t=this.padTmp[e];return this.padTmp[e]=t>>1,1&t}}]),e}();v.CHANNEL=4,t.Apu=v},434:function(e,t){"use strict";var r;!function(e){e.WIDTH=256,e.HEIGHT=240}(r=t.Const||(t.Const={})),t.kColors=[124,124,124,0,0,252,0,0,188,68,40,188,148,0,132,168,0,32,168,16,0,136,20,0,80,48,0,0,120,0,0,104,0,0,88,0,0,64,88,0,0,0,0,0,0,0,0,0,188,188,188,0,120,248,0,88,248,104,68,252,216,0,204,228,0,88,248,56,0,228,92,16,172,124,0,0,184,0,0,168,0,0,168,68,0,136,136,0,0,0,0,0,0,0,0,0,248,248,248,60,188,252,104,136,252,152,120,248,248,120,248,248,88,152,248,120,88,252,160,68,248,184,0,184,248,24,88,216,84,88,248,152,0,232,216,120,120,120,0,0,0,0,0,0,252,252,252,164,228,252,184,184,248,216,184,248,248,184,248,248,164,192,240,208,176,252,224,168,248,216,120,216,248,120,184,248,184,184,248,216,0,252,252,248,216,248,0,0,0,0,0,0],t.kStaggered=function(){for(var e=8,t=1<<e,r=new Uint16Array(t),n=0;t>n;++n){for(var i=0,a=0;e>a;++a)i<<=2,0!==(n&1<<e-1-a)&&(i|=1);r[n]=i}return r}(),t.kFlipBits=function(){for(var e=8,t=1<<e,r=new Uint8Array(t),n=0;t>n;++n){for(var i=0,a=0;e>a;++a)i<<=1,0!==(n&1<<a)&&(i|=1);r[n]=i}return r}()},435:function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t,r){return t?e|r:e&~r}function a(e){return e+1&255}function s(e){return e-1&255}function o(e){return 128>e?e:e-256}var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),c=r(436),l=r(438),h=r(439),f=l.Util.hex,p=0,d=1,v=2,y=4,E=5,m=6,g=7,b=1<<p,k=1<<d,T=1<<v,A=1<<y,O=1<<E,C=1<<m,R=1<<g,w=65530,S=65532,M=65534,P=8192,B=200,I=function(){var e={opType:c.OpType.UNKNOWN,addressing:c.Addressing.UNKNOWN,bytes:1,cycle:0},t=new Uint8Array(3),r=new Array(3);return function(n,i){for(var a=n.read8Raw(i),s=c.kInstTable[a]||e,o=0;o<s.bytes;++o){var u=n.read8Raw(n.pc+o);t[o]=u,r[o]=l.Util.hex(u,2)}for(var f=s.bytes;3>f;++f)r[f]="  ";var p=l.Util.hex(n.pc,4),d=r.join(" "),v=h.disassemble(s,t,1,n.pc);return p+": "+d+"   "+v}}(),L=function(){function e(){n(this,e),this.$DEBUG=!!window.$DEBUG,this.readerFuncTable=new Array(65536/P),this.writerFuncTable=new Array(65536/P),this.a=this.x=this.y=this.s=0,this.breakPoints={},this.watchRead={},this.watchWrite={},this.paused=!1,this.stepLogs=[]}return u(e,[{key:"resetMemoryMap",value:function(){this.readerFuncTable.fill(null),this.writerFuncTable.fill(null)}},{key:"setReadMemory",value:function(e,t,r){for(var n=e/P|0,i=t/P|0,a=n;i>=a;++a)this.readerFuncTable[a]=r}},{key:"setWriteMemory",value:function(e,t,r){for(var n=e/P|0,i=t/P|0,a=n;i>=a;++a)this.writerFuncTable[a]=r}},{key:"reset",value:function(){this.p=T|A|O,this.s=this.s-3&255,this.pc=this.read16(S),this.readErrorReported=this.writeErrorReported=!1,this.stepLogs.length=0}},{key:"deleteAllBreakPoints",value:function(){this.breakPoints={},this.watchRead={},this.watchWrite={}}},{key:"pause",value:function(e){this.paused=e}},{key:"isPaused",value:function(){return this.paused}},{key:"nmi",value:function(){var e=this.read16(w);this.breakPoints.nmi&&(this.paused=!0,console.warn("paused because NMI: "+l.Util.hex(this.pc,4)+", "+l.Util.hex(e,4))),this.$DEBUG&&this.addStepLog("NMI occurred at pc="+l.Util.hex(this.pc,4)),this.push16(this.pc),this.push(this.p&~A),this.pc=e,this.p|=T}},{key:"requestIrq",value:function(){return 0!==(this.p&T)?!1:(this.$DEBUG&&this.addStepLog("IRQ occurred at pc="+l.Util.hex(this.pc,4)),this.push16(this.pc),this.push(this.p&~A),this.pc=this.read16(M),this.p|=T,!0)}},{key:"step",value:function(){var e=this.pc;this.$DEBUG&&this.addStepLog(I(this,e));var t=this.read8(e++),r=c.kInstTable[t];if(null==r)return console.error("Unhandled OPCODE, "+f(this.pc-1,4)+": "+f(t,2)),this.paused=!0,0;this.pc+=r.bytes;var n=this.getAdr(e,r.addressing);switch(r.opType){default:case 0:break;case 1:break;case 2:this.a=this.read8(n),this.setNZFlag(this.a);break;case 3:this.write8(n,this.a);break;case 4:this.x=this.read8(n),this.setNZFlag(this.x);break;case 5:this.write8(n,this.x);break;case 6:this.y=this.read8(n),this.setNZFlag(this.y);break;case 7:this.write8(n,this.y);break;case 8:this.x=this.a,this.setNZFlag(this.x);break;case 9:this.y=this.a,this.setNZFlag(this.y);break;case 10:this.a=this.x,this.setNZFlag(this.x);break;case 11:this.a=this.y,this.setNZFlag(this.a);break;case 12:this.s=this.x;break;case 13:this.x=this.s,this.setNZFlag(this.x);break;case 14:var i=0!==(this.p&b)?1:0,u=this.read8(n),h=this.a+u+i,p=0!==((this.a^h)&(u^h)&128);this.a=255&h,this.setNZFlag(this.a),this.setCarry(h>=256),this.setOverFlow(p);break;case 15:var d=0!==(this.p&b)?1:0,v=255-this.read8(n),y=this.a+v+d,E=0!==((this.a^y)&(v^y)&128);this.a=255&y,this.setNZFlag(this.a),this.setCarry(y>=256),this.setOverFlow(E);break;case 16:this.x=a(this.x),this.setNZFlag(this.x);break;case 17:this.y=a(this.y),this.setNZFlag(this.y);break;case 18:var m=a(this.read8(n));this.write8(n,m),this.setNZFlag(m);break;case 19:this.x=s(this.x),this.setNZFlag(this.x);break;case 20:this.y=s(this.y),this.setNZFlag(this.y);break;case 21:var g=s(this.read8(n));this.write8(n,g),this.setNZFlag(g);break;case 22:var w=this.read8(n);this.a&=w,this.setNZFlag(this.a);break;case 23:var S=this.read8(n);this.a|=S,this.setNZFlag(this.a);break;case 24:var P=this.read8(n);this.a^=P,this.setNZFlag(this.a);break;case 25:var B=null==n?this.a:this.read8(n),L=0!==(this.p&b)?1:0,D=0!==(128&B),N=255&(B<<1|L);null==n?this.a=N:this.write8(n,N),this.setNZFlag(N),this.setCarry(D);break;case 26:var x=null==n?this.a:this.read8(n),U=0!==(this.p&b)?128:0,W=0!==(1&x),X=x>>1|U;null==n?this.a=X:this.write8(n,X),this.setNZFlag(X),this.setCarry(W);break;case 27:var _=null==n?this.a:this.read8(n),H=0!==(128&_),Y=_<<1&255;null==n?this.a=Y:this.write8(n,Y),this.setNZFlag(Y),this.setCarry(H);break;case 28:var G=null==n?this.a:this.read8(n),Z=0!==(1&G),F=G>>1&255;null==n?this.a=F:this.write8(n,F),this.setNZFlag(F),this.setCarry(Z);break;case 29:var V=this.read8(n),j=this.a&V;this.setZero(0===j);var q=R|C;this.p=this.p&~q|V&q;break;case 30:var z=this.read8(n),K=this.a-z;this.setNZFlag(K),this.setCarry(K>=0);break;case 31:var $=this.read8(n),J=this.x-$;this.setNZFlag(J),this.setCarry(J>=0);break;case 32:var Q=this.read8(n),ee=this.y-Q;this.setNZFlag(ee),this.setCarry(ee>=0);break;case 33:this.pc=n;break;case 34:this.push16(this.pc-1),this.pc=n;break;case 35:this.pc=this.pop16()+1;break;case 36:this.p=this.pop()|O,this.pc=this.pop16();break;case 37:0===(this.p&b)&&(this.pc+=o(this.read8(n)));break;case 38:0!==(this.p&b)&&(this.pc+=o(this.read8(n)));break;case 39:0===(this.p&R)&&(this.pc+=o(this.read8(n)));break;case 40:0!==(this.p&R)&&(this.pc+=o(this.read8(n)));break;case 41:0===(this.p&k)&&(this.pc+=o(this.read8(n)));break;case 42:0!==(this.p&k)&&(this.pc+=o(this.read8(n)));break;case 43:0===(this.p&C)&&(this.pc+=o(this.read8(n)));break;case 44:0!==(this.p&C)&&(this.pc+=o(this.read8(n)));break;case 45:this.push(this.a);break;case 46:this.push(this.p|A);break;case 47:this.a=this.pop(),this.setNZFlag(this.a);break;case 48:this.p=this.pop()|O;break;case 49:this.p&=~b;break;case 50:this.p|=b;break;case 51:this.p|=T;break;case 52:this.p&=~T;break;case 53:this.p&=~C;break;case 54:break;case 55:break;case 56:this.$DEBUG&&this.addStepLog("BRK occurred"),this.push16(this.pc+1),this.push(this.p|A),this.pc=this.read16(M),this.p|=T}return this.breakPoints[this.pc]&&(this.paused=!0,console.warn("paused because PC matched break point: "+l.Util.hex(this.pc,4))),r.cycle}},{key:"setNZFlag",value:function(e){this.setZero(0===e),this.setNegative(0!==(128&e))}},{key:"setCarry",value:function(e){this.p=i(this.p,e,b)}},{key:"setZero",value:function(e){this.p=i(this.p,e,k)}},{key:"setOverFlow",value:function(e){this.p=i(this.p,e,C)}},{key:"setNegative",value:function(e){this.p=i(this.p,e,R)}},{key:"read8",value:function(e){var t=this.read8Raw(e);return this.watchRead[e]&&(this.paused=!0,console.warn("Break because watched point read: adr="+l.Util.hex(e,4)+", value="+l.Util.hex(t,2))),t}},{key:"read8Raw",value:function(e){var t=e/P|0,r=this.readerFuncTable[t];return r?r(e):(this.readErrorReported||(console.error("Illegal read at "+f(e,4)+", pc="+f(this.pc,4)),this.readErrorReported=!0),191)}},{key:"read16",value:function(e){var t=this.read8(e),r=this.read8(e+1);return r<<8|t}},{key:"read16Indirect",value:function(e){var t=this.read8(e),r=this.read8((65280&e)+(e+1&255));return r<<8|t}},{key:"write8",value:function(e,t){var r=e/P|0,n=this.writerFuncTable[r];return n?(this.watchWrite[e]&&(this.paused=!0,console.warn("Break because watched point write: adr="+l.Util.hex(e,4)+", value="+l.Util.hex(t,2))),n(e,t)):void(this.writeErrorReported||(console.error("Illegal write at "+f(e,4)+", pc="+f(this.pc,4)+", "+f(t,2)),this.writeErrorReported=!0))}},{key:"dump",value:function(e,t){for(var r=[],n=0;t>n;++n)r.push(this.read8(n+e));for(var i=0;t>i;i+=16){var a=r.splice(0,16).map(function(e){return l.Util.hex(e,2)}).join(" ");console.log(l.Util.hex(e+i,4)+": "+a)}}},{key:"push",value:function(e){this.write8(256+this.s,e),this.s=s(this.s)}},{key:"push16",value:function(e){var t=this.s;this.write8(256+t,e>>8),t=s(t),this.write8(256+t,255&e),this.s=s(t)}},{key:"pop",value:function(){return this.s=a(this.s),this.read8(256+this.s)}},{key:"pop16",value:function(){var e=this.s;e=a(e);var t=this.read8(256+e);e=a(e);var r=this.read8(256+e);return this.s=e,r<<8|t}},{key:"addStepLog",value:function(e){if(this.stepLogs.length<B)this.stepLogs.push(e);else{for(var t=1;B>t;++t)this.stepLogs[t-1]=this.stepLogs[t];this.stepLogs[B-1]=e}}},{key:"getAdr",value:function(e,t){switch(t){case c.Addressing.ACCUMULATOR:case c.Addressing.IMPLIED:return null;case c.Addressing.IMMEDIATE:case c.Addressing.RELATIVE:return e;case c.Addressing.ZEROPAGE:return this.read8(e);case c.Addressing.ZEROPAGE_X:return this.read8(e)+this.x&255;case c.Addressing.ZEROPAGE_Y:return this.read8(e)+this.y&255;case c.Addressing.ABSOLUTE:return this.read16(e);case c.Addressing.ABSOLUTE_X:return this.read16(e)+this.x&65535;case c.Addressing.ABSOLUTE_Y:return this.read16(e)+this.y&65535;case c.Addressing.INDIRECT_X:var r=this.read8(e);return this.read16Indirect(r+this.x&255);case c.Addressing.INDIRECT_Y:var n=this.read8(e),i=this.read16Indirect(n);return i+this.y&65535;case c.Addressing.INDIRECT:var a=this.read16(e);return this.read16Indirect(a);default:return console.error("Illegal addressing: "+t),this.paused=!0,null}}}]),e}();t.Cpu=L},436:function(e,t,r){"use strict";var n=function(){function e(e,t){var r=[],n=!0,i=!1,a=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(u){i=!0,a=u}finally{try{!n&&o["return"]&&o["return"]()}finally{if(i)throw a}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();r(437),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.IMPLIED=1]="IMPLIED",e[e.ACCUMULATOR=2]="ACCUMULATOR",e[e.IMMEDIATE=3]="IMMEDIATE",e[e.IMMEDIATE16=4]="IMMEDIATE16",e[e.ZEROPAGE=5]="ZEROPAGE",e[e.ZEROPAGE_X=6]="ZEROPAGE_X",e[e.ZEROPAGE_Y=7]="ZEROPAGE_Y",e[e.ABSOLUTE=8]="ABSOLUTE",e[e.ABSOLUTE_X=9]="ABSOLUTE_X",e[e.ABSOLUTE_Y=10]="ABSOLUTE_Y",e[e.INDIRECT=11]="INDIRECT",e[e.INDIRECT_X=12]="INDIRECT_X",e[e.INDIRECT_Y=13]="INDIRECT_Y",e[e.RELATIVE=14]="RELATIVE"}(t.Addressing||(t.Addressing={}));var i=t.Addressing;!function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.NOP=1]="NOP",e[e.LDA=2]="LDA",e[e.STA=3]="STA",e[e.LDX=4]="LDX",e[e.STX=5]="STX",e[e.LDY=6]="LDY",e[e.STY=7]="STY",e[e.TAX=8]="TAX",e[e.TAY=9]="TAY",e[e.TXA=10]="TXA",e[e.TYA=11]="TYA",e[e.TXS=12]="TXS",e[e.TSX=13]="TSX",e[e.ADC=14]="ADC",e[e.SBC=15]="SBC",e[e.INX=16]="INX",e[e.INY=17]="INY",e[e.INC=18]="INC",e[e.DEX=19]="DEX",e[e.DEY=20]="DEY",e[e.DEC=21]="DEC",e[e.AND=22]="AND",e[e.ORA=23]="ORA",e[e.EOR=24]="EOR",e[e.ROL=25]="ROL",e[e.ROR=26]="ROR",e[e.ASL=27]="ASL",e[e.LSR=28]="LSR",e[e.BIT=29]="BIT",e[e.CMP=30]="CMP",e[e.CPX=31]="CPX",e[e.CPY=32]="CPY",e[e.JMP=33]="JMP",e[e.JSR=34]="JSR",e[e.RTS=35]="RTS",e[e.RTI=36]="RTI",e[e.BCC=37]="BCC",e[e.BCS=38]="BCS",e[e.BPL=39]="BPL",e[e.BMI=40]="BMI",e[e.BNE=41]="BNE",e[e.BEQ=42]="BEQ",e[e.BVC=43]="BVC",e[e.BVS=44]="BVS",e[e.PHA=45]="PHA",e[e.PHP=46]="PHP",e[e.PLA=47]="PLA",e[e.PLP=48]="PLP",e[e.CLC=49]="CLC",e[e.SEC=50]="SEC",e[e.SEI=51]="SEI",e[e.CLI=52]="CLI",e[e.CLV=53]="CLV",e[e.SED=54]="SED",e[e.CLD=55]="CLD",e[e.BRK=56]="BRK"}(t.OpType||(t.OpType={}));var a=t.OpType,s=[[234,a.NOP,i.IMPLIED,1,2],[169,a.LDA,i.IMMEDIATE,2,2],[165,a.LDA,i.ZEROPAGE,2,3],[181,a.LDA,i.ZEROPAGE_X,2,4],[173,a.LDA,i.ABSOLUTE,3,4],[189,a.LDA,i.ABSOLUTE_X,3,4],[185,a.LDA,i.ABSOLUTE_Y,3,4],[161,a.LDA,i.INDIRECT_X,2,6],[177,a.LDA,i.INDIRECT_Y,2,5],[133,a.STA,i.ZEROPAGE,2,3],[149,a.STA,i.ZEROPAGE_X,2,4],[141,a.STA,i.ABSOLUTE,3,4],[157,a.STA,i.ABSOLUTE_X,3,5],[153,a.STA,i.ABSOLUTE_Y,3,5],[149,a.STA,i.ZEROPAGE_X,2,4],[129,a.STA,i.INDIRECT_X,2,6],[145,a.STA,i.INDIRECT_Y,2,6],[162,a.LDX,i.IMMEDIATE,2,2],[166,a.LDX,i.ZEROPAGE,2,3],[182,a.LDX,i.ZEROPAGE_Y,2,4],[174,a.LDX,i.ABSOLUTE,3,4],[190,a.LDX,i.ABSOLUTE_Y,3,4],[134,a.STX,i.ZEROPAGE,2,3],[150,a.STX,i.ZEROPAGE_Y,2,4],[142,a.STX,i.ABSOLUTE,3,4],[160,a.LDY,i.IMMEDIATE,2,2],[164,a.LDY,i.ZEROPAGE,2,3],[180,a.LDY,i.ZEROPAGE_X,2,4],[172,a.LDY,i.ABSOLUTE,3,4],[188,a.LDY,i.ABSOLUTE_X,3,4],[132,a.STY,i.ZEROPAGE,2,3],[148,a.STY,i.ZEROPAGE_X,2,4],[140,a.STY,i.ABSOLUTE,3,4],[170,a.TAX,i.IMPLIED,1,2],[168,a.TAY,i.IMPLIED,1,2],[138,a.TXA,i.IMPLIED,1,2],[152,a.TYA,i.IMPLIED,1,2],[154,a.TXS,i.IMPLIED,1,2],[186,a.TSX,i.IMPLIED,1,2],[105,a.ADC,i.IMMEDIATE,2,2],[101,a.ADC,i.ZEROPAGE,2,3],[117,a.ADC,i.ZEROPAGE_X,2,4],[109,a.ADC,i.ABSOLUTE,3,4],[125,a.ADC,i.ABSOLUTE_X,3,4],[121,a.ADC,i.ABSOLUTE_Y,3,4],[97,a.ADC,i.INDIRECT_X,2,6],[113,a.ADC,i.INDIRECT_Y,2,5],[233,a.SBC,i.IMMEDIATE,2,2],[229,a.SBC,i.ZEROPAGE,2,3],[245,a.SBC,i.ZEROPAGE_X,2,4],[237,a.SBC,i.ABSOLUTE,3,4],[253,a.SBC,i.ABSOLUTE_X,3,4],[249,a.SBC,i.ABSOLUTE_Y,3,4],[225,a.SBC,i.INDIRECT_X,2,6],[241,a.SBC,i.INDIRECT_Y,2,5],[201,a.CMP,i.IMMEDIATE,2,2],[197,a.CMP,i.ZEROPAGE,2,3],[213,a.CMP,i.ZEROPAGE_X,2,4],[205,a.CMP,i.ABSOLUTE,3,4],[221,a.CMP,i.ABSOLUTE_X,3,4],[217,a.CMP,i.ABSOLUTE_Y,3,4],[193,a.CMP,i.INDIRECT_X,2,6],[209,a.CMP,i.INDIRECT_Y,2,5],[224,a.CPX,i.IMMEDIATE,2,2],[228,a.CPX,i.ZEROPAGE,2,3],[236,a.CPX,i.ABSOLUTE,3,4],[192,a.CPY,i.IMMEDIATE,2,2],[196,a.CPY,i.ZEROPAGE,2,3],[204,a.CPY,i.ABSOLUTE,3,4],[232,a.INX,i.IMPLIED,1,2],[200,a.INY,i.IMPLIED,1,2],[230,a.INC,i.ZEROPAGE,2,5],[246,a.INC,i.ZEROPAGE_X,2,6],[238,a.INC,i.ABSOLUTE,3,6],[254,a.INC,i.ABSOLUTE_X,3,7],[202,a.DEX,i.IMPLIED,1,2],[136,a.DEY,i.IMPLIED,1,2],[198,a.DEC,i.ZEROPAGE,2,5],[214,a.DEC,i.ZEROPAGE_X,2,6],[206,a.DEC,i.ABSOLUTE,3,6],[222,a.DEC,i.ABSOLUTE_X,3,7],[41,a.AND,i.IMMEDIATE,2,2],[37,a.AND,i.ZEROPAGE,2,3],[53,a.AND,i.ZEROPAGE_X,2,4],[45,a.AND,i.ABSOLUTE,3,4],[61,a.AND,i.ABSOLUTE_X,3,4],[57,a.AND,i.ABSOLUTE_Y,3,4],[33,a.AND,i.INDIRECT_X,2,6],[49,a.AND,i.INDIRECT_Y,2,5],[9,a.ORA,i.IMMEDIATE,2,2],[5,a.ORA,i.ZEROPAGE,2,3],[21,a.ORA,i.ZEROPAGE_X,2,4],[13,a.ORA,i.ABSOLUTE,3,4],[29,a.ORA,i.ABSOLUTE_X,3,4],[25,a.ORA,i.ABSOLUTE_Y,3,4],[1,a.ORA,i.INDIRECT_X,2,6],[17,a.ORA,i.INDIRECT_Y,2,5],[73,a.EOR,i.IMMEDIATE,2,2],[69,a.EOR,i.ZEROPAGE,2,3],[85,a.EOR,i.ZEROPAGE_X,2,4],[77,a.EOR,i.ABSOLUTE,3,4],[93,a.EOR,i.ABSOLUTE_X,3,4],[89,a.EOR,i.ABSOLUTE_Y,3,4],[65,a.EOR,i.INDIRECT_X,2,6],[81,a.EOR,i.INDIRECT_Y,2,5],[42,a.ROL,i.ACCUMULATOR,1,2],[38,a.ROL,i.ZEROPAGE,2,5],[54,a.ROL,i.ZEROPAGE_X,2,6],[46,a.ROL,i.ABSOLUTE,3,6],[62,a.ROL,i.ABSOLUTE_X,3,7],[106,a.ROR,i.ACCUMULATOR,1,2],[102,a.ROR,i.ZEROPAGE,2,5],[118,a.ROR,i.ZEROPAGE_X,2,6],[110,a.ROR,i.ABSOLUTE,3,6],[126,a.ROR,i.ABSOLUTE_X,3,7],[10,a.ASL,i.ACCUMULATOR,1,2],[6,a.ASL,i.ZEROPAGE,2,5],[22,a.ASL,i.ZEROPAGE_X,2,6],[14,a.ASL,i.ABSOLUTE,3,6],[30,a.ASL,i.ABSOLUTE_X,3,7],[74,a.LSR,i.ACCUMULATOR,1,2],[70,a.LSR,i.ZEROPAGE,2,5],[86,a.LSR,i.ZEROPAGE_X,2,6],[78,a.LSR,i.ABSOLUTE,3,6],[94,a.LSR,i.ABSOLUTE_X,3,7],[36,a.BIT,i.ZEROPAGE,2,3],[44,a.BIT,i.ABSOLUTE,3,4],[76,a.JMP,i.ABSOLUTE,3,3],[108,a.JMP,i.INDIRECT,3,5],[32,a.JSR,i.ABSOLUTE,3,6],[96,a.RTS,i.IMPLIED,1,6],[64,a.RTI,i.IMPLIED,1,6],[144,a.BCC,i.RELATIVE,2,2],[176,a.BCS,i.RELATIVE,2,2],[16,a.BPL,i.RELATIVE,2,2],[48,a.BMI,i.RELATIVE,2,2],[208,a.BNE,i.RELATIVE,2,2],[240,a.BEQ,i.RELATIVE,2,2],[80,a.BVC,i.RELATIVE,2,2],[112,a.BVS,i.RELATIVE,2,2],[72,a.PHA,i.IMPLIED,1,3],[8,a.PHP,i.IMPLIED,1,3],[104,a.PLA,i.IMPLIED,1,4],[40,a.PLP,i.IMPLIED,1,4],[24,a.CLC,i.IMPLIED,1,2],[56,a.SEC,i.IMPLIED,1,2],[120,a.SEI,i.IMPLIED,1,2],[88,a.CLI,i.IMPLIED,1,2],[184,a.CLV,i.IMPLIED,1,2],[248,a.SED,i.IMPLIED,1,2],[216,a.CLD,i.IMPLIED,1,2],[0,a.BRK,i.IMPLIED,1,7]];t.kInstTable=function(){var e=new Array(256);return e.fill(null),s.forEach(function(t){var r=n(t,5),i=r[0],a=r[1],s=r[2],o=r[3],u=r[4];e[i]={opType:a,addressing:s,bytes:o,cycle:u}}),e}()},437:function(e,t){"use strict";"fill"in Array.prototype||(Array.prototype.fill=function(e){for(var t=arguments.length<=1||void 0===arguments[1]?0:arguments[1],r=arguments.length<=2||void 0===arguments[2]?this.length:arguments[2],n=t;r>n;++n)this[n]=e;return this}),"fill"in Uint8Array.prototype||(Uint8Array.prototype.fill=function(e){for(var t=arguments.length<=1||void 0===arguments[1]?0:arguments[1],r=arguments.length<=2||void 0===arguments[2]?this.length:arguments[2],n=t;r>n;++n)this[n]=e;return this}),Uint8Array.prototype.slice||(Uint8Array.prototype.slice=function(e,t){void 0==t&&(t=this.length);
for(var r=new Uint8Array(t-e),n=0;n<r.length;++n)r[n]=this[n+e];return r})},438:function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i="0123456789abcdef",a=function(){function e(){r(this,e)}return n(e,null,[{key:"hex",value:function(e,t){t=t||2;for(var r=new Array(t),n=0;t>n;++n)r[t-n-1]=i[15&e],e>>=4;return r.join("")}}]),e}();t.Util=a},439:function(e,t,r){"use strict";function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t,r,n){var i="";switch(e.addressing){case s.Addressing.IMPLIED:case s.Addressing.ACCUMULATOR:break;case s.Addressing.IMMEDIATE:i=" #$"+o.Util.hex(t[r],2);break;case s.Addressing.IMMEDIATE16:i=" #$"+o.Util.hex(t[r]|t[r+1]<<8,4);break;case s.Addressing.ZEROPAGE:i=" $"+o.Util.hex(t[r],2);break;case s.Addressing.ZEROPAGE_X:i=" $"+o.Util.hex(t[r],2)+", X";break;case s.Addressing.ZEROPAGE_Y:i=" $"+o.Util.hex(t[r],2)+", Y";break;case s.Addressing.ABSOLUTE:i=" $"+o.Util.hex(t[r]|t[r+1]<<8,4);break;case s.Addressing.ABSOLUTE_X:i=" $"+o.Util.hex(t[r]|t[r+1]<<8,4)+", X";break;case s.Addressing.ABSOLUTE_Y:i=" $"+o.Util.hex(t[r]|t[r+1]<<8,4)+", Y";break;case s.Addressing.INDIRECT:i=" ($"+o.Util.hex(t[r]|t[r+1]<<8,4)+")";break;case s.Addressing.INDIRECT_X:i=" ($"+o.Util.hex(t[r],2)+", X)";break;case s.Addressing.INDIRECT_Y:i=" ($"+o.Util.hex(t[r],2)+"), Y";break;case s.Addressing.RELATIVE:var a=t[r];i=128>a?" +"+a+"  ; $"+o.Util.hex(n+e.bytes+a,4):" "+(a-256)+"  ; $"+o.Util.hex(n+e.bytes+a-256,4);break;default:console.error("Unhandled addressing: "+e.addressing)}return""+u[e.opType]+i}var a,s=r(436),o=r(438),u=(a={},n(a,s.OpType.LDA,"LDA"),n(a,s.OpType.STA,"STA"),n(a,s.OpType.LDX,"LDX"),n(a,s.OpType.STX,"STX"),n(a,s.OpType.LDY,"LDY"),n(a,s.OpType.STY,"STY"),n(a,s.OpType.TAX,"TAX"),n(a,s.OpType.TAY,"TAY"),n(a,s.OpType.TXA,"TXA"),n(a,s.OpType.TYA,"TYA"),n(a,s.OpType.TXS,"TXS"),n(a,s.OpType.TSX,"TSX"),n(a,s.OpType.ADC,"ADC"),n(a,s.OpType.SBC,"SBC"),n(a,s.OpType.INX,"INX"),n(a,s.OpType.INY,"INY"),n(a,s.OpType.INC,"INC"),n(a,s.OpType.DEX,"DEX"),n(a,s.OpType.DEY,"DEY"),n(a,s.OpType.DEC,"DEC"),n(a,s.OpType.AND,"AND"),n(a,s.OpType.ORA,"ORA"),n(a,s.OpType.EOR,"EOR"),n(a,s.OpType.ROL,"ROL"),n(a,s.OpType.ROR,"ROR"),n(a,s.OpType.ASL,"ASL"),n(a,s.OpType.LSR,"LSR"),n(a,s.OpType.BIT,"BIT"),n(a,s.OpType.CMP,"CMP"),n(a,s.OpType.CPX,"CPX"),n(a,s.OpType.CPY,"CPY"),n(a,s.OpType.JMP,"JMP"),n(a,s.OpType.JSR,"JSR"),n(a,s.OpType.RTS,"RTS"),n(a,s.OpType.RTI,"RTI"),n(a,s.OpType.BCC,"BCC"),n(a,s.OpType.BCS,"BCS"),n(a,s.OpType.BPL,"BPL"),n(a,s.OpType.BMI,"BMI"),n(a,s.OpType.BNE,"BNE"),n(a,s.OpType.BEQ,"BEQ"),n(a,s.OpType.BVC,"BVC"),n(a,s.OpType.BVS,"BVS"),n(a,s.OpType.PHA,"PHA"),n(a,s.OpType.PHP,"PHP"),n(a,s.OpType.PLA,"PLA"),n(a,s.OpType.PLP,"PLP"),n(a,s.OpType.CLC,"CLC"),n(a,s.OpType.SEC,"SEC"),n(a,s.OpType.SEI,"SEI"),n(a,s.OpType.CLI,"CLI"),n(a,s.OpType.CLV,"CLV"),n(a,s.OpType.SED,"SED"),n(a,s.OpType.CLD,"CLD"),n(a,s.OpType.BRK,"BRK"),n(a,s.OpType.NOP,"NOP"),a);t.disassemble=i},440:function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e){return e.concat()}function a(e,t,r,n){var i=(t>>5&1)+((r/30&1)<<1)^e,a=n<<10-(i<<1)&3072;return 8192+a}function s(e,t){if(e>=12288&&16128>e&&(e-=4096),e>=8192&&12288>e){var r=e>>10&3,n=t<<10-(r<<1)&3072;return 62463&e|n}return e>=16128&&16383>=e&&(e&=65311,16144===(65523&e)&&(e&=65519)),e}function o(e,t){var r=0!==(t&g)?32:1;return e+r&f-1}var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),c=r(434),l=r(438),h=8,f=16384,p=256,d=0,v=128,y=32,E=16,m=8,g=4,b=3,k=1,T=16,A=8,O=4,C=2,R=2,w=128,S=64,M=32,P=3,B=4,I=5,L=6,D=7,N=64,x=128;!function(e){e[e.HORZ=0]="HORZ",e[e.VERT=1]="VERT",e[e.SINGLE0=2]="SINGLE0",e[e.SINGLE1=3]="SINGLE1"}(t.MirrorMode||(t.MirrorMode={}));var U=(t.MirrorMode,[80,68,0,85]),W=[9,1,0,1,0,2,2,13,8,16,8,36,0,0,4,44,9,1,52,3,0,4,0,20,8,58,0,2,0,32,44,8],X=function(){function e(){n(this,e),this.regs=new Uint8Array(h),this.vram=new Uint8Array(f),this.oam=new Uint8Array(p),this.mirrorModeBit=68,this.hevents={count:0,events:[]},this.hevents2={count:0,events:[]},this.chrBankOffset=new Array(8);for(var t=0;8>t;++t)this.chrBankOffset[t]=t<<10}return u(e,[{key:"reset",value:function(){this.regs.fill(0),this.vram.fill(0),this.oam.fill(0),this.hcount=0,this.scrollX=this.scrollY=0,this.ppuAddr=0,this.latch=0,this.bufferedValue=0,this.hevents={count:0,events:[]},this.hevents2={count:0,events:[]};for(var e=0;8>e;++e)this.chrBankOffset[e]=e<<10;for(var t=0;32>t;++t)this.vram[16128+t]=W[t]}},{key:"setChrData",value:function(e){e&&e.length>0?this.chrData=e:this.chrData=this.vram}},{key:"setChrBank",value:function(e){for(var t=0;8>t;++t)this.setChrBankOffset(t,(e<<3)+t)}},{key:"setChrBankOffset",value:function(e,t){var r=this.chrData.length;this.chrBankOffset[e]=t<<10&r-1,this.addHevent({scrollX:this.scrollX,scrollY:this.scrollY,ppuCtrl:this.regs[d],ppuMask:this.regs[k],chrBankOffset:i(this.chrBankOffset),mirrorModeBit:this.mirrorModeBit})}},{key:"setMirrorMode",value:function(e){this.mirrorModeBit=U[e],this.addHevent({scrollX:this.scrollX,scrollY:this.scrollY,ppuCtrl:this.regs[d],ppuMask:this.regs[k],chrBankOffset:i(this.chrBankOffset),mirrorModeBit:this.mirrorModeBit})}},{key:"read",value:function(e){var t=this.regs[e];switch(e){case R:this.regs[R]&=~w,this.latch=0;break;case B:t=this.oam[this.regs[P]];break;case D:var r=this.ppuAddr,n=s(r,this.mirrorModeBit);n>=16128&&16383>=n?(t=this.readPpuDirect(n),this.bufferedValue=this.readPpuDirect(s(r-4096,this.mirrorModeBit))):(t=this.bufferedValue,this.bufferedValue=this.readPpuDirect(n)),this.ppuAddr=o(r,this.regs[d])}return t}},{key:"write",value:function(e,t){switch(e===R&&(t&=~(w|S|M)),this.regs[e]=t,e){case d:case k:this.addHevent({scrollX:this.scrollX,scrollY:this.scrollY,ppuCtrl:this.regs[d],ppuMask:this.regs[k],chrBankOffset:i(this.chrBankOffset),mirrorModeBit:this.mirrorModeBit});break;case B:var r=this.regs[P];this.oam[r]=t,this.regs[P]=r+1&255;break;case I:0===this.latch?this.scrollX=t:(this.hcount>=240&&(this.scrollY=t),this.addHevent({scrollX:this.scrollX,scrollY:this.scrollY,ppuCtrl:this.regs[d],ppuMask:this.regs[k],chrBankOffset:i(this.chrBankOffset),mirrorModeBit:this.mirrorModeBit})),this.latch=1-this.latch;break;case L:0===this.latch?this.ppuAddr=t:this.ppuAddr=(this.ppuAddr<<8|t)&f-1,this.latch=1-this.latch;break;case D:var n=s(this.ppuAddr,this.mirrorModeBit);this.vram[n]=t,this.ppuAddr=o(this.ppuAddr,this.regs[d])}}},{key:"copyWithDma",value:function(e,t){for(var r=this.oam,n=this.regs[P],i=0;256>i;++i)r[n]=e[t+i],n=n+1&255}},{key:"setVBlank",value:function(){this.regs[R]=this.regs[R]|w;var e=this.hevents;this.hevents=this.hevents2,this.hevents2=e,this.hevents.count=0,this.addHevent({scrollX:this.scrollX,scrollY:this.scrollY,ppuCtrl:this.regs[d],ppuMask:this.regs[k],chrBankOffset:i(this.chrBankOffset),mirrorModeBit:this.mirrorModeBit})}},{key:"clearVBlank",value:function(){this.regs[R]&=~(w|S)}},{key:"interruptEnable",value:function(){return 0!==(this.regs[d]&v)}},{key:"getBgPatternTableAddress",value:function(){return(this.regs[d]&E)<<8}},{key:"getSpritePatternTableAddress",value:function(){return 0===(this.regs[d]&y)?(this.regs[d]&m)<<9:0}},{key:"isSprite8x16",value:function(){return 0!==(this.regs[d]&y)}},{key:"renderBg",value:function(e){this.doRenderBgLine(e)}},{key:"doRenderBg",value:function(e,t,r,n,i,s){var o=this,u=function(e,t){var r=e+t,n=r>>10&7,i=o.chrBankOffset[n],a=1023&r,s=i+a;return c.kStaggered[o.chrData[s+8]]<<1|c.kStaggered[o.chrData[s]]},l=8,h=e.width,f=this.getBgPatternTableAddress(),p=this.vram,d=16128,v=e.data,y=63&p[d],E=c.kColors[3*y+0],m=c.kColors[3*y+1],g=c.kColors[3*y+2];r>=240&&(r-=256);for(var b=0;b<c.Const.HEIGHT/l+1;++b)for(var k=(b+(r>>3)+60)%60,T=k%30,A=0;A<c.Const.WIDTH/l+1;++A)for(var O=A+(t>>3)&63,C=31&O,R=a(0,O,k,this.mirrorModeBit)+s,w=p[R+C+(T<<5)],S=16*w+f,M=(2&C)+((2&T)<<1),P=(C>>2)+(T<<1&248),B=R+960,I=(p[B+P]>>M&3)<<2,L=0;l>L;++L){var D=b*l+L-(7&r);if(!(0>D)){if(D>=c.Const.HEIGHT)break;for(var N=u(S,L),x=0;l>x;++x){var U=A*l+x-(7&t);if(!(0>U)){if(U>=c.Const.WIDTH)break;var W=N>>(l-1-x<<1)&3,X=E,_=m,H=g;if(0!==W){var Y=I+W,G=63&p[d+Y],Z=3*G;X=c.kColors[Z],_=c.kColors[Z+1],H=c.kColors[Z+2]}var F=4*((D+i)*h+(U+n));v[F+0]=X,v[F+1]=_,v[F+2]=H}}}}}},{key:"doRenderBgLine",value:function(e){for(var t=this.hevents.count,r=0;t>r;++r){var n=this.hevents.events[r],i=n.hcount,a=t-1>r?this.hevents.events[r+1].hcount:248;if(!(i>=a))if(0!==(n.ppuMask&A)){var s=n.ppuCtrl&b,o=(n.ppuCtrl&E)<<8,u=0;0===(n.ppuMask&C)&&this.clearBg(e,i,a,u=8),this.doRenderBg2(e,n.scrollX,n.scrollY,s,i,a,u,n.chrBankOffset,n.mirrorModeBit,o)}else this.clearBg(e,i,a,e.width)}}},{key:"doRenderBg2",value:function(e,t,r,n,i,s,o,u,l,h){var f=this,p=function(e,t){var r=e+t,n=r>>10&7,i=u[n],a=1023&r,s=i+a;return c.kStaggered[f.chrData[s+8]]<<1|c.kStaggered[f.chrData[s]]},d=8,v=e.width,y=this.vram,E=16128,m=e.data,g=63&y[E],b=c.kColors[3*g+0],k=c.kColors[3*g+1],T=c.kColors[3*g+2];r>=240&&(r-=256);for(var A=i/8|0,O=(s+7)/8|0,C=0,R=A;O>R;++R)for(var w=(R+(r>>3)+60)%60,S=w%30,M=0;M<c.Const.WIDTH/d+1;++M){for(var P=M+(t>>3)&63,B=31&P,I=a(n,P,w,l),L=y[I+B+(S<<5)],D=16*L+h,N=(2&B)+((2&S)<<1),x=(B>>2)+(S<<1&248),U=I+960,W=(y[U+x]>>N&3)<<2,X=C;d>X;++X){var _=R*d+X-(7&r);if(!(0>_)){if(_>=c.Const.HEIGHT)break;for(var H=p(D,X),Y=0;d>Y;++Y){var G=M*d+Y-(7&t);if(!(o>G)){if(G>=c.Const.WIDTH)break;var Z=H>>(d-1-Y<<1)&3,F=b,V=k,j=T;if(0!==Z){var q=W+Z,z=63&y[E+q],K=3*z;F=c.kColors[K],V=c.kColors[K+1],j=c.kColors[K+2]}var $=4*(_*v+G);m[$+0]=F,m[$+1]=V,m[$+2]=j}}}}C=0}}},{key:"clearBg",value:function(e,t,r,n){for(var i=4*e.width,a=e.data,s=16128,o=63&this.vram[s],u=c.kColors[3*o+0],l=c.kColors[3*o+1],h=c.kColors[3*o+2],f=t;r>f;++f)for(var p=f*i,d=0;n>d;++d)a[p++]=u,a[p++]=l,a[p++]=h,a[p++]=255}},{key:"setHcount",value:function(e){this.hcount=e,this.checkSprite0Hit(e)}},{key:"renderSprite",value:function(e){for(var t=0,r=this.hevents.count,n=0;r>n;++n){var i=this.hevents.events[n];if(0!==(i.ppuMask&T)){var a=i.hcount,s=r-1>n?this.hevents.events[n+1].hcount:248;if(!(a>=s)){0===(this.regs[d]&y)&&(t=(this.regs[d]&m)<<9);var o=i.ppuMask&O?0:8;this.renderSprite2(e,a,s,o,i.chrBankOffset,t)}}}}},{key:"renderSprite2",value:function(e,t,r,n,i,a){for(var s=this,o=function(e,t,r){var n=e+(7&t)+((8&t)<<1),a=n>>10&7,o=i[a],u=1023&n,l=o+u,h=s.chrData[l+8],f=s.chrData[l];return r&&(h=c.kFlipBits[h],f=c.kFlipBits[f]),c.kStaggered[h]<<1|c.kStaggered[f]},u=8,l=e.width,h=3,f=this.oam,p=this.vram,d=16144,v=e.data,y=this.isSprite8x16(),E=y?16:8,m=64;--m>=0;){var g=f[4*m]+1;if(!(t>g||g>=r))for(var b=f[4*m+1],k=f[4*m+2],T=0!==(k&x),A=0!==(k&N),O=f[4*m+3],C=y?16*(254&b)+((1&b)<<12):16*b+a,R=(k&h)<<2,w=0;E>w&&!(g+w>=c.Const.HEIGHT);++w)for(var S=T?E-1-w:w,M=o(C,S,A),P=0;u>P;++P){var B=O+P;if(!(n>B)){if(B>=c.Const.WIDTH)break;var I=M>>(u-1-P<<1)&3;if(0!==I){var L=R+I,D=63&p[d+L],U=3*D,W=4*((g+w)*l+(O+P));v[W+0]=c.kColors[U],v[W+1]=c.kColors[U+1],v[W+2]=c.kColors[U+2]}}}}}},{key:"dumpVram",value:function(e,t){for(var r=[],n=0;t>n;++n)r.push(this.vram[s(e+n,this.mirrorModeBit)]);for(var i=0;t>i;i+=16){var a=r.splice(0,16).map(function(e){return l.Util.hex(e,2)}).join(" ");console.log(l.Util.hex(e+i,4)+": "+a)}}},{key:"renderPattern",value:function(e,t){for(var r=8,n=e.width,i=e.data,a=0;2>a;++a)for(var s=0;16>s;++s)for(var o=0;16>o;++o)for(var u=16*(o+16*s+256*a),l=0;r>l;++l)for(var h=s*r+l,f=u+l,p=c.kStaggered[this.readPpuDirect(f+8)]<<1|c.kStaggered[this.readPpuDirect(f)],d=0;r>d;++d){var v=o*r+d+a*(16*r),y=p>>(r-1-d<<1)&3,E=3*y,m=4*(h*n+v);i[m+0]=t[E+0],i[m+1]=t[E+1],i[m+2]=t[E+2]}}},{key:"writePpuDirect",value:function(e,t){if(e>=8192)this.vram[e]=t;else{var r=this.chrBankOffset[e>>10&7];this.chrData[(1023&e)+r]=t}}},{key:"checkSprite0Hit",value:function(e){if(0===(this.regs[R]&S)&&(this.regs[k]&(A|T))===(A|T)){var t=this.oam[0];if(!(t>e||e>=t+16)){var r=this.oam[3];if(!(r>=255)){var n=this.getNonEmptySprite0Line();0>n||e!==t+n||(this.regs[R]|=S)}}}}},{key:"getNonEmptySprite0Line",value:function(){for(var e=this,t=function(t,r){var n=t+(7&r)+((8&r)<<1),i=n>>10&7,a=e.chrBankOffset[i],s=1023&n,o=a+s,u=e.chrData[o+8],l=e.chrData[o];return c.kStaggered[u]<<1|c.kStaggered[l]},r=this.oam,n=this.getSpritePatternTableAddress(),i=this.isSprite8x16(),a=i?16:8,s=0,o=r[4*s+1],u=r[4*s+2],l=0!==(u&x),h=i?16*(254&o)+((1&o)<<12):16*o+n,f=0;a>f;++f){var p=l?a-1-f:f,d=t(h,p);if(0!==d)return f}return-1}},{key:"addHevent",value:function(e){var t=this.hcount;t>=240&&(t=0);var r=this.hevents,n=r.count;(0>=n||r.events[n-1].hcount!==t)&&++n>=r.events.length&&r.events.push({});var i=r.events[n-1];i.hcount=t,Object.keys(e).forEach(function(t){i[t]=e[t]}),r.count=n}},{key:"readPpuDirect",value:function(e){if(e>=8192)return this.vram[e];var t=this.chrBankOffset[e>>10&7];return this.chrData[(1023&e)+t]}}]),e}();t.Ppu=X},441:function(e,t,r){"use strict";var n=r(442),i=r(443),a=r(444),s=r(445),o=r(446),u=r(447),c=r(448),l=r(449),h=r(450),f=r(451),p=r(452),d=r(453),v=r(454),y=r(455),E=r(456);t.kMapperTable={0:n.mapper000,1:i.mapper001,2:a.mapper002,3:s.mapper003,4:o.mapper004,7:u.mapper007,10:c.mapper010,19:l.mapper019,23:h.mapper023,24:f.mapper024,25:h.mapper025,32:p.mapper032,69:d.mapper069,73:v.mapper073,75:y.mapper075,88:o.mapper004,93:a.mapper093,95:o.mapper004,118:o.mapper004,184:E.mapper184,185:s.mapper185,206:o.mapper004}},442:function(e,t){"use strict";function r(e,t,r){t.setReadMemory(32768,49151,function(t){return e[t&e.length-1]}),t.setReadMemory(49152,65535,function(t){return e[t&e.length-1]})}t.mapper000=r},443:function(e,t,r){"use strict";function n(e,t,r){var n=14,i=1<<n,s=e.length,o=(e.length>>n)-1,u=0,c=0,l=3,h=[0,s-i],f=!0,p=[0,4],d=function(){u=0,c=0},v=function(e,t){if(f)for(var n=e<<2,i=t<<2,a=0;4>a;++a)r.setChrBankOffset(n+a,i+a);else 0===e&&r.setChrBank(254&t);p[e]=t},y=function(e,t){var r=(15&e|16&t)&o;switch(l){case 0:case 1:h[0]=(-2&r)<<n,h[1]=h[0]+i;break;case 2:h[0]=0,h[1]=r<<n;break;case 3:h[0]=r<<n,h[1]=s-i}};t.setReadMemory(32768,65535,function(t){var r=t>>n&1,a=t&i-1;return e[h[r]+a]}),t.setWriteMemory(32768,65535,function(e,t){if(0!==(128&t))return d();if(u|=(1&t)<<c,!(++c<5)){switch(57344&e){case 32768:switch(r.setMirrorMode(a[3&u]),l=u>>2&3){case 2:h[0]=0;break;case 3:h[1]=s-i}var o=0!==(16&u);f!==o&&(f=o,v(0,p[0]),v(1,p[1]));break;case 40960:case 49152:var E=e-40960>>13&1,m=31&u;p[E]!==m&&v(E,m),0===E&&y(h[0]>>n,m);break;case 57344:y(u,p[0])}d()}});var E=new Uint8Array(8192);E.fill(191),t.setReadMemory(24576,32767,function(e){return E[8191&e]}),t.setWriteMemory(24576,32767,function(e,t){E[8191&e]=t})}var i=r(440),a=[i.MirrorMode.SINGLE0,i.MirrorMode.SINGLE1,i.MirrorMode.VERT,i.MirrorMode.HORZ];t.mapper001=n},444:function(e,t){"use strict";function r(e){return function(t,r,n){var i=14,a=1<<i,s=t.length,o=s/a,u=s-a,c=0;r.setReadMemory(32768,49151,function(e){return t[(e&a-1)+c]}),r.setReadMemory(49152,65535,function(e){return t[(e&a-1)+u]}),r.setWriteMemory(32768,65535,function(t,r){c=(r>>e&o-1)<<i})}}t.mapper002=r(0),t.mapper093=r(4)},445:function(e,t){"use strict";function r(e,t,r){t.setReadMemory(32768,65535,function(t){return e[t&e.length-1]}),t.setWriteMemory(32768,65535,function(e,t){r.setChrBank(t)})}function n(e,t,n){return n.writePpuDirect(0,1),r(e,t,n)}t.mapper003=r,t.mapper185=n},446:function(e,t,r){"use strict";function n(e,t,r,n){var a=13,s=(1<<a)-1,o=new Uint8Array(8),u=(e.length>>a)-1,c=0,l=0,h=1<<a,f=2<<a,p=u<<a,d=function(e){0===(64&e)?(l=(o[6]&u)<<a,h=(o[7]&u)<<a,f=u-1<<a):(f=(o[6]&u)<<a,h=(o[7]&u)<<a,l=u-1<<a)},v=function(e){0===(128&e)?(r.setChrBankOffset(0,254&o[0]),r.setChrBankOffset(1,1|o[0]),r.setChrBankOffset(2,254&o[1]),r.setChrBankOffset(3,1|o[1]),r.setChrBankOffset(4,o[2]),r.setChrBankOffset(5,o[3]),r.setChrBankOffset(6,o[4]),r.setChrBankOffset(7,o[5])):(r.setChrBankOffset(4,254&o[0]),r.setChrBankOffset(5,1|o[0]),r.setChrBankOffset(6,254&o[1]),r.setChrBankOffset(7,1|o[1]),r.setChrBankOffset(0,o[2]),r.setChrBankOffset(1,o[3]),r.setChrBankOffset(2,o[4]),r.setChrBankOffset(3,o[5]))};t.setReadMemory(32768,40959,function(t){return e[(t&s)+l]}),t.setReadMemory(40960,49151,function(t){return e[(t&s)+h]}),t.setReadMemory(49152,57343,function(t){return e[(t&s)+f]}),t.setReadMemory(57344,65535,function(t){return e[(t&s)+p]});var y=new Uint8Array(8192);y.fill(255),t.setReadMemory(24576,32767,function(e){return y[8191&e]}),t.setWriteMemory(24576,32767,function(e,t){y[8191&e]=t}),t.setWriteMemory(32768,40959,function(e,t){if(0===(1&e))c=t,d(c),v(c);else{var r=7&c;o[r]=t,6>r?v(c):d(c)}}),t.setWriteMemory(40960,49151,function(e,t){0===(1&e)&&r.setMirrorMode(0===(1&t)?i.MirrorMode.VERT:i.MirrorMode.HORZ)}),t.setWriteMemory(49152,57343,function(e,t){0===(1&e)?n.setIrqHlineValue(t):n.resetIrqHlineCounter()}),t.setWriteMemory(57344,65535,function(e,t){0===(1&e)?(n.enableIrqHline(!1),n.resetIrqHlineCounter()):n.enableIrqHline(!0)}),d(c),r.setMirrorMode(i.MirrorMode.VERT)}var i=r(440);t.mapper004=n},447:function(e,t,r){"use strict";function n(e,t,r){var n=15,i=1<<n,s=e.length,o=s/i,u=0;t.setReadMemory(32768,65535,function(t){return e[(t&i-1)+u]}),t.setWriteMemory(32768,65535,function(e,t){u=(t&o-1)<<n;var i=t>>4&1;r.setMirrorMode(a[i])})}var i=r(440),a=[i.MirrorMode.SINGLE0,i.MirrorMode.SINGLE1];t.mapper007=n},448:function(e,t,r){"use strict";function n(e,t,r){var n=14,a=1<<n,s=e.length,o=s/a,u=s-a,c=0;t.setReadMemory(32768,49151,function(t){return e[(t&a-1)+c]}),t.setReadMemory(49152,65535,function(t){return e[(t&a-1)+u]}),t.setWriteMemory(40960,49151,function(e,t){45056>e?c=(t&o-1)<<n:r.setChrBank(t)}),t.setWriteMemory(57344,61440,function(e,t){e>=61440&&r.setMirrorMode(0===(1&t)?i.MirrorMode.VERT:i.MirrorMode.HORZ)});var l=new Uint8Array(8192);l.fill(191),t.setReadMemory(24576,32767,function(e){return l[8191&e]}),t.setWriteMemory(24576,32767,function(e,t){l[8191&e]=t})}var i=r(440);t.mapper010=n},449:function(e,t){"use strict";function r(e,t,r){var n=13,i=1<<n,a=e.length,s=a/i,o=a-i,u=0,c=0,l=0;t.setReadMemory(32768,40959,function(t){return e[(t&i-1)+u]}),t.setReadMemory(40960,49151,function(t){return e[(t&i-1)+c]}),t.setReadMemory(49152,57343,function(t){return e[(t&i-1)+l]}),t.setReadMemory(57344,65535,function(t){return e[(t&i-1)+o]}),t.setWriteMemory(32768,49151,function(e,t){var n=e>>11&7;r.setChrBankOffset(n,t)}),t.setWriteMemory(57344,65535,function(e,t){59391>=e?u=(t&s-1)<<n:61439>=e?c=(t&s-1)<<n:63487>=e&&(l=(t&s-1)<<n)})}t.mapper019=r},450:function(e,t,r){"use strict";function n(e){return function(t,r,n){var i=13,s=1<<i,o=t.length,u=o/s,c=0,l=0,h=1<<i,f=u-2<<i,p=u-1<<i,d=new Array(8);r.setReadMemory(32768,40959,function(e){return t[(e&s-1)+l]}),r.setReadMemory(40960,49151,function(e){return t[(e&s-1)+h]}),r.setReadMemory(49152,57343,function(e){return t[(e&s-1)+f]}),r.setReadMemory(57344,65535,function(e){return t[(e&s-1)+p]}),r.setWriteMemory(32768,40959,function(t,r){if(t>=32768&&32774>=t)switch(c){case 0:l=(r&u-1)<<i;break;case 1:f=(r&u-1)<<i}else if(36864===(65280&t)){var s=255&t;if(s===e[0]||s===e[2]){var o=3&r;n.setMirrorMode(a[o])}else if(s===e[4]||s===e[6])switch(c=r>>1&1){case 0:f=u-2<<i;break;case 1:l=u-2<<i}}}),r.setWriteMemory(40960,49151,function(t,r){if(t>=40960&&40966>=t)h=(r&u-1)<<i;else if(45056===(65280&t)){var a=255&t;a===e[0]?(d[0]=-16&d[0]|15&r,n.setChrBankOffset(0,d[0])):a===e[2]?(d[0]=-497&d[0]|(31&r)<<4,n.setChrBankOffset(0,d[0])):a===e[4]?(d[1]=-16&d[1]|15&r,n.setChrBankOffset(1,d[1])):a===e[6]&&(d[1]=-497&d[1]|(31&r)<<4,n.setChrBankOffset(1,d[1]))}}),r.setWriteMemory(49152,65535,function(t,r){if(t>=49152&&61439>=t){var i=255&t,a=0,s=!1;if(i===e[0])a=0;else if(i===e[2])a=0,s=!0;else if(i===e[4])a=1;else{if(i!==e[6])return;a=1,s=!0}var o=((12288&t)>>11)+2+a;s?d[o]=-497&d[o]|(31&r)<<4:d[o]=-16&d[o]|15&r,n.setChrBankOffset(o,d[o])}});var v=new Uint8Array(8192);v.fill(255),r.setReadMemory(24576,32767,function(e){return v[8191&e]}),r.setWriteMemory(24576,32767,function(e,t){v[8191&e]=t})}}var i=r(440),a=[i.MirrorMode.VERT,i.MirrorMode.HORZ,i.MirrorMode.SINGLE0,i.MirrorMode.SINGLE1];t.mapper023=n({0:0,2:4,4:8,6:12}),t.mapper025=n({0:0,2:2,4:1,6:3})},451:function(e,t,r){"use strict";function n(e){return function(t,r,n){var i=13,s=1<<i,o=t.length,u=o/s,c=0,l=u-2<<i,h=u-1<<i;r.setReadMemory(32768,49151,function(e){return t[(e&2*s-1)+c]}),r.setReadMemory(49152,57343,function(e){return t[(e&s-1)+l]}),r.setReadMemory(57344,65535,function(e){return t[(e&s-1)+h]}),r.setWriteMemory(32768,40959,function(e,t){e>=32768&&32771>=e&&(c=(t&u/2-1)<<i+1)}),r.setWriteMemory(49152,57343,function(e,t){e>=49152&&49155>=e&&(l=(t&u-1)<<i)});var f=0,p=0,d=new Uint8Array(8),v=function(){switch(f){case 0:n.setChrBankOffset(0,d[0]),n.setChrBankOffset(1,d[1]),n.setChrBankOffset(2,d[2]),n.setChrBankOffset(3,d[3]),n.setChrBankOffset(4,d[4]),n.setChrBankOffset(5,d[5]),n.setChrBankOffset(6,d[6]),n.setChrBankOffset(7,d[7]);break;case 1:n.setChrBankOffset(0,d[0]),n.setChrBankOffset(1,d[0]),n.setChrBankOffset(2,d[1]),n.setChrBankOffset(3,d[1]),n.setChrBankOffset(4,d[2]),n.setChrBankOffset(5,d[2]),n.setChrBankOffset(6,d[3]),n.setChrBankOffset(7,d[3]);break;case 2:case 3:n.setChrBankOffset(0,d[0]),n.setChrBankOffset(1,d[1]),n.setChrBankOffset(2,d[2]),n.setChrBankOffset(3,d[3]),n.setChrBankOffset(4,d[4]),n.setChrBankOffset(5,d[4]),n.setChrBankOffset(6,d[5]),n.setChrBankOffset(7,d[5])}};r.setWriteMemory(40960,49151,function(t,r){45056===(61440&t)&&(255&t)===e[3]&&(f=3&r,p=r>>2&3,n.setMirrorMode(a[p]))}),r.setWriteMemory(53248,65535,function(t,r){if(t>=53248&&61439>=t){var n=15&t;4>n&&(d[e[n]]=r,v())}});var y=new Uint8Array(8192);y.fill(255),r.setReadMemory(24576,32767,function(e){return y[8191&e]}),r.setWriteMemory(24576,32767,function(e,t){y[8191&e]=t})}}var i=r(440),a=[i.MirrorMode.VERT,i.MirrorMode.HORZ,i.MirrorMode.SINGLE0,i.MirrorMode.SINGLE1];t.mapper024=n({0:0,1:1,2:2,3:3})},452:function(e,t,r){"use strict";function n(e,t,r,n){var i=13,s=(1<<i)-1,o=(e.length>>i)-1,u=o-1<<i,c=0,l=1<<i,h=o-1<<i,f=o<<i,p=[0,1<<i],d=0,v=function(){0===d?(c=p[0],l=p[1],h=u):(h=p[0],l=p[1],c=u)};t.setReadMemory(32768,40959,function(t){return e[(t&s)+c]}),t.setReadMemory(40960,49151,function(t){return e[(t&s)+l]}),t.setReadMemory(49152,57343,function(t){return e[(t&s)+h]}),t.setReadMemory(57344,65535,function(t){return e[(t&s)+f]});var y=new Uint8Array(8192);y.fill(191),t.setReadMemory(24576,32767,function(e){return y[8191&e]}),t.setWriteMemory(24576,32767,function(e,t){y[8191&e]=t}),t.setWriteMemory(32768,40959,function(e,t){36863>=e?(p[0]=(t&o)<<i,v()):(r.setMirrorMode(a[1&t]),d=t>>1&1,v())}),t.setWriteMemory(40960,49151,function(e,t){45055>=e?(p[1]=(t&o)<<i,v()):r.setChrBankOffset(7&e,t)})}var i=r(440),a=[i.MirrorMode.VERT,i.MirrorMode.HORZ];t.mapper032=n},453:function(e,t,r){"use strict";function n(e,t,r){var n=13,i=1<<n,s=e.length,o=s/i,u=s-i,c=0,l=0,h=0;t.setReadMemory(32768,40959,function(t){return e[(t&i-1)+c]}),t.setReadMemory(40960,49151,function(t){return e[(t&i-1)+l]}),t.setReadMemory(49152,57343,function(t){return e[(t&i-1)+h]}),t.setReadMemory(57344,65535,function(t){return e[(t&i-1)+u]});var f=0;t.setWriteMemory(32768,40959,function(e,t){f=15&t}),t.setWriteMemory(40960,49151,function(e,t){switch(f){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:r.setChrBankOffset(f,t);break;case 9:c=(t&o-1)<<n;break;case 10:l=(t&o-1)<<n;break;case 11:h=(t&o-1)<<n;break;case 12:r.setMirrorMode(a[3&t])}});var p=new Uint8Array(8192);p.fill(191),t.setReadMemory(24576,32767,function(e){return p[8191&e]}),t.setWriteMemory(24576,32767,function(e,t){p[8191&e]=t})}var i=r(440),a=[i.MirrorMode.VERT,i.MirrorMode.HORZ,i.MirrorMode.SINGLE0,i.MirrorMode.SINGLE1];t.mapper069=n},454:function(e,t){"use strict";function r(e,t,r){var n=14,i=1<<n,a=e.length,s=a/i,o=a-i,u=0;t.setReadMemory(32768,49151,function(t){return e[(t&i-1)+u]}),t.setReadMemory(49152,65535,function(t){return e[(t&i-1)+o]}),t.setWriteMemory(61440,65535,function(e,t){u=(t&s-1)<<n});var c=new Uint8Array(8192);c.fill(255),t.setReadMemory(24576,32767,function(e){return c[8191&e]}),t.setWriteMemory(24576,32767,function(e,t){c[8191&e]=t})}t.mapper073=r},455:function(e,t,r){"use strict";function n(e,t,r){var n=13,a=1<<n,s=e.length,o=s/a,u=s-a,c=[u,u,u,u],l=[0,0],h=function(e,t){l[e]=t;for(var n=e<<2,i=t<<2,a=0;4>a;++a)r.setChrBankOffset(n+a,i+a)};t.setReadMemory(32768,65535,function(t){var r=t>>13&3;return e[(t&a-1)+c[r]]}),t.setWriteMemory(32768,40959,function(e,t){36864>e?c[0]=(t&o-1)<<n:(r.setMirrorMode(0===(1&t)?i.MirrorMode.VERT:i.MirrorMode.HORZ),h(0,15&l[0]|(2&t)<<3),h(1,15&l[1]|(4&t)<<2))}),t.setWriteMemory(40960,49151,function(e,t){45056>e&&(c[1]=(t&o-1)<<n)}),t.setWriteMemory(49152,57343,function(e,t){53248>e&&(c[2]=(t&o-1)<<n)}),t.setWriteMemory(57344,65535,function(e,t){var r=e>>12&1;h(r,16&l[r]|15&t)});var f=new Uint8Array(8192);f.fill(191),t.setReadMemory(24576,32767,function(e){return f[8191&e]}),t.setWriteMemory(24576,32767,function(e,t){f[8191&e]=t})}var i=r(440);t.mapper075=n},456:function(e,t){"use strict";function r(e,t,r){var n=e.length-1;t.setReadMemory(32768,65535,function(t){return e[t&n]}),t.setWriteMemory(24576,32767,function(e,t){for(var n=(t>>2&28)+16,i=(7&t)<<2,a=0;4>a;++a)r.setChrBankOffset(a+4,n+a);for(var s=0;4>s;++s)r.setChrBankOffset(s,i+s)})}t.mapper184=r},457:function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a,s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();!function(e){!function(e){e[e.RENDER=1]="RENDER",e[e.RUN=2]="RUN",e[e.PAUSE=3]="PAUSE",e[e.STEP=4]="STEP",e[e.RESET=5]="RESET",e[e.LOAD_ROM=6]="LOAD_ROM",e[e.BREAK_POINT=7]="BREAK_POINT",e[e.SCREEN_SHOT=8]="SCREEN_SHOT",e[e.DESTROY=9]="DESTROY",e[e.START_CALC=10]="START_CALC",e[e.END_CALC=11]="END_CALC"}(e.Type||(e.Type={}));var t=e.Type,a=function(e){function a(){return r(this,a),n(this,Object.getPrototypeOf(a).apply(this,arguments))}return i(a,e),s(a,[{key:"triggerRender",value:function(){this.next(t.RENDER)}},{key:"triggerRun",value:function(){this.next(t.RUN)}},{key:"triggerPause",value:function(){this.next(t.PAUSE)}},{key:"triggerStep",value:function(){this.next(t.STEP)}},{key:"triggerReset",value:function(){this.next(t.RESET)}},{key:"triggerScreenShot",value:function(){this.next(t.SCREEN_SHOT)}},{key:"triggerLoadRom",value:function(){this.next(t.LOAD_ROM)}},{key:"triggerBreakPoint",value:function(){this.next(t.BREAK_POINT)}},{key:"triggerDestroy",value:function(){this.next(t.DESTROY)}},{key:"triggerStartCalc",value:function(){this.next(t.START_CALC)}},{key:"triggerEndCalc",value:function(){this.next(t.END_CALC)}}]),a}(Rx.Subject);e.Stream=a}(a=t.AppEvent||(t.AppEvent={}))},458:function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=["square","square","triangle","noise"],a=function(){function e(){r(this,e)}return n(e,[{key:"destroy",value:function(){null!=this.gainNode&&(this.gainNode.disconnect(),this.gainNode=null),null!=this.oscillator&&(this.oscillator.disconnect(),this.oscillator=null)}},{key:"create",value:function(e,t){if(this.gainNode=e.createGain(),this.gainNode.gain.value=0,this.oscillator=e.createOscillator(),"noise"!==t)this.oscillator.type=t;else{for(var r=1024,n=new Float32Array(r),i=new Float32Array(r),a=0;r>a;++a)n[a]=2*Math.random()-1,i[a]=0;var s=e.createPeriodicWave(n,i);this.oscillator.setPeriodicWave(s)}return this.oscillator.connect(this.gainNode),this.gainNode.connect(e.destination),this}},{key:"start",value:function(){return this.oscillator.start(),this}},{key:"setFrequency",value:function(e){this.oscillator.frequency.setValueAtTime(e,0)}},{key:"setVolume",value:function(e){this.gainNode.gain.value=e}}]),e}(),s=function(){function e(){r(this,e),this.masterVolume=0,e.setUp(),null!=e.context&&(this.masterVolume=1,this.channels=i.map(function(t){var r=new a;return r.create(e.context,t).start(),r}))}return n(e,[{key:"destroy",value:function(){if(null!=this.channels){var e=!0,t=!1,r=void 0;try{for(var n,i=this.channels[Symbol.iterator]();!(e=(n=i.next()).done);e=!0){var a=n.value;a.destroy()}}catch(s){t=!0,r=s}finally{try{!e&&i["return"]&&i["return"]()}finally{if(t)throw r}}this.channels=null}}},{key:"setChannelFrequency",value:function(t,r){null!=e.context&&this.channels[t].setFrequency(r)}},{key:"setChannelVolume",value:function(t,r){null!=e.context&&this.channels[t].setVolume(r*this.masterVolume)}},{key:"setMasterVolume",value:function(t){null!=e.context&&(this.masterVolume=t,0>=t&&this.channels.forEach(function(e){e.setVolume(0)}))}}],[{key:"setUp",value:function(){if(!e.initialized){e.initialized=!0;var t=window.AudioContext||window.webkitAudioContext;null!=t&&(e.context=new t)}}}]),e}();s.CHANNEL=4,s.initialized=!1,s.context=null,t.AudioManager=s},459:function(e,t,r){"use strict";function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t,r,n){var i=arguments.length<=4||void 0===arguments[4]?{}:arguments[4],a=document.createElement("div");return a.className="gamepad-btn",a.style.left=t+"px",a.style.top=r+"px",a.style.width=(i.width||30)+"px",a.style.height=(i.height||30)+"px",a.innerHTML=n,"round"===i.type&&(a.style.borderRadius="15px"),e.appendChild(a),a}var o,u=function g(e,t,r){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,t);if(void 0===n){var i=Object.getPrototypeOf(e);return null===i?void 0:g(i,t,r)}if("value"in n)return n.value;var a=n.get;if(void 0!==a)return a.call(r)},c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},l=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),h=r(433),f=r(460),p=r(461);!function(e){e[e.AXIS=0]="AXIS",e[e.BUTTON=1]="BUTTON"}(o||(o={}));var d=[{type:o.BUTTON,index:0,direction:1},{type:o.BUTTON,index:1,direction:1},{type:o.BUTTON,index:2,direction:1},{type:o.BUTTON,index:3,direction:1},{type:o.AXIS,
index:1,direction:-1},{type:o.AXIS,index:1,direction:1},{type:o.AXIS,index:0,direction:-1},{type:o.AXIS,index:0,direction:1}],v=["A","B","SELECT","START","U","D","L","R"],y=function(){function e(){a(this,e)}return l(e,null,[{key:"setUp",value:function(){e.loadSetting()}},{key:"isSupported",value:function(){return"Gamepad"in window}},{key:"getState",value:function(t){if(!window.Gamepad)return 0;var r=navigator.getGamepads();if(t>=r.length)return 0;var n=r[t];if(!n)return 0;var i=e.AXIS_THRESHOLD,a=0;return d.forEach(function(e,t){if(e.type===o.AXIS){var r=n.axes[e.index]||0;r*e.direction>=i&&(a|=1<<t)}else{var s=n.buttons[e.index];s&&s.pressed&&(a|=1<<t)}}),a}},{key:"setButton",value:function(t,r){d[t].type=o.BUTTON,d[t].index=r,d[t].direction=1,e.saveSetting()}},{key:"setAxis",value:function(t,r,n){d[t].type=o.AXIS,d[t].index=r,d[t].direction=n,e.saveSetting()}},{key:"saveSetting",value:function(){var e={};d.forEach(function(t,r){var n=v[r];switch(t.type){default:return null;case o.BUTTON:e[n]={button:t.index};break;case o.AXIS:e[n]={axis:t.index,direction:t.direction}}}),p["default"].putObject("pad0",e)}},{key:"loadSetting",value:function(){var t=p["default"].getObject("pad0",{});"object"===("undefined"==typeof t?"undefined":c(t))&&Object.keys(t).forEach(function(r){var n=v.indexOf(r.toUpperCase());if(!(0>n)){var i=t[r];"button"in i?e.setButton(n,i.button):"axis"in i&&"direction"in i&&e.setAxis(n,i.axis,parseInt(i.direction,10))}})}}]),e}();y.AXIS_THRESHOLD=.5,t.GamepadManager=y;var E=[{x:40,y:10,name:"&uarr;",padbit:h.PadBit.U},{x:10,y:40,name:"&larr;",padbit:h.PadBit.L},{x:70,y:40,name:"&rarr;",padbit:h.PadBit.R},{x:40,y:70,name:"&darr;",padbit:h.PadBit.D},{x:130,y:40,name:"B",opt:{type:"round"},padbit:h.PadBit.B},{x:175,y:40,name:"A",opt:{type:"round"},padbit:h.PadBit.A},{x:50,y:110,name:"Select",opt:{width:60,height:20},padbit:h.PadBit.SELECT},{x:120,y:110,name:"Start",opt:{width:60,height:20},padbit:h.PadBit.START}],m=function(e){function t(e){a(this,t);var r=n(this,Object.getPrototypeOf(t).call(this,e,230,150,"Gamepad config"));r.destroying=!1;var i=document.createElement("div");i.className="gamepad-content",i.style.width="230px",i.style.height="150px",r.setContent(i),i.addEventListener("click",function(){r.setSelectedButton(null)}),r.buttons=E.map(function(e){var t=s(i,e.x,e.y,e.name,e.opt);return t.addEventListener("click",function(e){e.stopPropagation(),r.setSelectedButton(t)}),t}),r.selectedButton=null;var o=function u(){r.destroying||(r.checkGamepad(),requestAnimationFrame(u))};return requestAnimationFrame(o),r}return i(t,e),l(t,[{key:"close",value:function(){this.destroying=!0,u(Object.getPrototypeOf(t.prototype),"close",this).call(this)}},{key:"checkGamepad",value:function(){var e=0;if(window.Gamepad){var t=navigator.getGamepads();if(!(e>=t.length)){var r=t[e];if(r){if(null!=this.selectedButton&&this.isTop()){var n=this.buttons.indexOf(this.selectedButton);this.replaceGamepadButton(e,r,n)&&this.setSelectedButton(null)}this.checkGamepadPressed(e)}}}}},{key:"replaceGamepadButton",value:function(e,t,r){for(var n=0;n<t.buttons.length;++n)if(t.buttons[n].pressed)return y.setButton(E[r].padbit,n),!0;for(var i=y.AXIS_THRESHOLD,a=0;a<t.axes.length;++a){var s=t.axes[a];if(-i>s)return y.setAxis(E[r].padbit,a,-1),!0;if(s>i)return y.setAxis(E[r].padbit,a,1),!0}return!1}},{key:"checkGamepadPressed",value:function(e){for(var t=y.getState(e),r=0;r<E.length;++r){var n=this.buttons[r];0===(t&1<<E[r].padbit)?n.classList.remove("pressed"):n.classList.add("pressed")}}},{key:"setSelectedButton",value:function(e){return null!=this.selectedButton&&this.selectedButton.classList.remove("selected"),this.selectedButton===e?void(this.selectedButton=null):(this.selectedButton=e,void(null!=this.selectedButton&&this.selectedButton.classList.add("selected")))}}]),t}(f["default"]);t.GamepadWnd=m},460:function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){var r=e.getBoundingClientRect(),n=t.getBoundingClientRect();return{left:n.left-r.left,top:n.top-r.top,right:n.right-r.left,bottom:n.bottom-r.top}}var i=function(){function e(e,t){var r=[],n=!0,i=!1,a=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(u){i=!0,a=u}finally{try{!n&&o["return"]&&o["return"]()}finally{if(i)throw a}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=1e3,o=s+1,u=function(){function e(t,n,i,a){r(this,e),this.wndMgr=t,this.callback=function(){},this.root=this.createRoot(),this.root.className="wnd",this.root.style.position="absolute",this.setClientSize(n,i),this.createTitleBar(a),this.contentHolder=document.createElement("div"),this.contentHolder.className="content-holder",this.root.appendChild(this.contentHolder)}return a(e,[{key:"setContent",value:function(e){return this.contentHolder.appendChild(e),this}},{key:"setPos",value:function(e,t){return this.root.style.left=e+"px",this.root.style.top=t+"px",this}},{key:"setTitle",value:function(e){return this.titleElem.innerText=e,this}},{key:"setClientSize",value:function(t,r){return this.root.style.width=t+"px",this.root.style.height=r+e.HEADER_HEIGHT+"px",this}},{key:"getWindowSize",value:function(){var e=parseInt(this.root.style.width,10),t=parseInt(this.root.style.height,10);return{width:e,height:t}}},{key:"setCallback",value:function(e){return this.callback=e,this}},{key:"setFocus",value:function(){return this.root.focus(),this}},{key:"isTop",value:function(){return this.wndMgr.isTop(this)}},{key:"addMenuBar",value:function(e){var t=this;return this.menuBar=document.createElement("div"),this.menuBar.className="menu-bar",this.menuBar.style.zIndex=String(s),e.forEach(function(e){var r=document.createElement("div");r.className="menu-item pull-left",r.innerText=e.label,r.addEventListener("click",function(n){"submenu"in e&&t.addSubmenu(e,r)}),t.menuBar.appendChild(r),t.root.appendChild(t.menuBar)}),this}},{key:"getRootNode",value:function(){return this.root}},{key:"close",value:function(){this.callback("close")!==!1&&(this.wndMgr.remove(this),this.root=null)}},{key:"addResizeBox",value:function(){var t=this;this.root.classList.add("resizable");var r=8,n=[{styleParams:{right:"-1px",bottom:"-1px",cursor:"nwse-resize"},horz:"right",vert:"bottom"},{styleParams:{left:"-1px",bottom:"-1px",cursor:"nesw-resize"},horz:"left",vert:"bottom"},{styleParams:{right:"-1px",top:"-1px",cursor:"nesw-resize"},horz:"right",vert:"top"},{styleParams:{left:"-1px",top:"-1px",cursor:"nwse-resize"},horz:"left",vert:"top"}],a=64,s=24+e.HEADER_HEIGHT;n.forEach(function(n){var o=document.createElement("div");o.style.position="absolute",Object.keys(n.styleParams).forEach(function(e){o.style[e]=n.styleParams[e]}),o.style.width=o.style.height=r+"px",o.style.zIndex="100";var u=void 0,c=void 0,l=function(r){var o=t.getMousePosIn(r,t.root.parentNode),l=i(o,2),h=l[0],f=l[1],p=t.root.getBoundingClientRect(),d=t.root.parentNode.getBoundingClientRect(),v={left:p.left-d.left,top:p.top-d.top,right:p.right-d.left,bottom:p.bottom-d.top};v[n.horz]=h+u,v[n.vert]=f+c;var y=v.right-v.left-2,E=v.bottom-v.top-2;a>y&&(v[n.horz]-=(a-y)*("left"===n.horz?1:-1)),s>E&&(v[n.vert]-=(s-E)*("top"===n.vert?1:-1)),t.root.style.width=v.right-v.left-2+"px",t.root.style.height=v.bottom-v.top-2+"px",t.root.style.left=v.left+"px",t.root.style.top=v.top+"px",t.callback("resize",y,E-e.HEADER_HEIGHT)},h=function f(e){document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",f)};o.addEventListener("mousedown",function(e){e.stopPropagation(),e.preventDefault();var a=t.getMousePosIn(e,o),s=i(a,2),f=s[0],p=s[1];u="left"===n.horz?-f:r-f,c="top"===n.vert?-p:r-p,document.addEventListener("mousemove",l),document.addEventListener("mouseup",h),t.wndMgr.moveToTop(t)}),t.root.appendChild(o)})}},{key:"createRoot",value:function(){var e=this,t=document.createElement("div");return t.addEventListener("mousedown",function(t){return t.stopPropagation(),e.wndMgr.moveToTop(e),!1}),t}},{key:"createTitleBar",value:function(e){var t=this;this.titleBar=document.createElement("div"),this.titleBar.className="title-bar clearfix",this.addTitleButton(this.titleBar,"close",function(){t.close()}),this.titleElem=this.addTitle(this.titleBar,e);var r=void 0,n=void 0,a=function(e){var a=t.getMousePosIn(e,t.root.parentNode),s=i(a,2),o=s[0],u=s[1];t.root.style.left=o+r+"px",t.root.style.top=u+n+"px"},s=function o(e){document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",o)};this.titleBar.addEventListener("mousedown",function(e){if(r=n=null,0===e.button){e.preventDefault();var o=t.getMousePosIn(e,t.root),u=i(o,2),c=u[0],l=u[1];return r=-c,n=-l,document.addEventListener("mousemove",a),document.addEventListener("mouseup",s),!0}}),this.root.appendChild(this.titleBar)}},{key:"addTitleButton",value:function(e,t,r){var n=document.createElement("div");return n.className=t+" btn",n.addEventListener("click",r),n.addEventListener("mousedown",function(e){e.preventDefault(),e.stopPropagation()}),e.appendChild(n),n}},{key:"addTitle",value:function(e,t){var r=document.createElement("div");return r.className="title",r.appendChild(document.createTextNode(t)),e.appendChild(r),r}},{key:"addSubmenu",value:function(e,t){var r=document.createElement("div");r.className="menu-subitem-holder",r.style.zIndex=String(o),e.submenu.forEach(function(e){var t=document.createElement("div");t.className="menu-item",t.innerText=e.label,t.addEventListener("click",function(t){t.stopPropagation(),"click"in e&&e.click()}),r.appendChild(t)}),this.root.appendChild(r);var i=n(this.root,t);r.style.left=i.left-1+"px",r.style.top=i.bottom-1+"px";var a=function s(e){r.parentNode.removeChild(r),document.removeEventListener("click",s,!0)};document.addEventListener("click",a,!0)}},{key:"getMousePosIn",value:function(e,t){var r=t.getBoundingClientRect(),n=document.body.scrollLeft,i=document.body.scrollTop;return[e.pageX-r.left-n,e.pageY-r.top-i]}}]),e}();u.HEADER_HEIGHT=12,Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=u},461:function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e){return""+u+e}var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=r(462),o=null,u="";if(null==o){try{"localStorage"in window&&null!=window.localStorage&&(o=window.localStorage)}catch(c){}null==o&&(o=new s["default"])}var l=function(){function e(){n(this,e)}return a(e,null,[{key:"setKeyPrefix",value:function(e){u=e}},{key:"get",value:function(e,t){var r=i(e);return null!=o.getItem(r)?o.getItem(r):t}},{key:"getInt",value:function(e,t){var r=i(e),n=parseInt(o.getItem(r),10);return isNaN(n)?t:n}},{key:"getFloat",value:function(e,t){var r=i(e),n=parseFloat(o.getItem(r));return isNaN(n)?t:n}},{key:"getBool",value:function(e,t){var r=i(e),n=o.getItem(r);return"true"===n?!0:"false"===n?!1:t}},{key:"getObject",value:function(e,t){var r=i(e),n=o.getItem(r);try{if(null!=n)return JSON.parse(n)}catch(a){console.error(a)}return t}},{key:"put",value:function(e,t){var r=i(e);return o.setItem(r,t),!0}},{key:"putObject",value:function(e,t){var r=i(e);return o.setItem(r,JSON.stringify(t)),!0}}]),e}();Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=l},462:function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(){function e(){r(this,e),this.storage={}}return n(e,[{key:"setItem",value:function(e,t){this.storage[e]=String(t)}},{key:"getItem",value:function(e){var t=this.storage[e];return"undefined"==typeof t?null:t}},{key:"removeItem",value:function(e){delete this.storage[e]}},{key:"key",value:function(e){var t=Object.keys(this.storage);return t[e]||null}},{key:"length",get:function(){return Object.keys(this.storage).length}}]),e}();Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=i},463:function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i,a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=r(433);!function(e){e[e.SPACE=32]="SPACE",e[e.RETURN=13]="RETURN",e[e.LEFT=37]="LEFT",e[e.UP=38]="UP",e[e.RIGHT=39]="RIGHT",e[e.DOWN=40]="DOWN",e[e.Z=90]="Z",e[e.X=88]="X",e[e.I=73]="I",e[e.J=74]="J",e[e.K=75]="K",e[e.L=76]="L",e[e.Q=81]="Q",e[e.W=87]="W",e[e.O=79]="O",e[e.P=80]="P"}(i||(i={}));var o=function(){var e={};return e[i.LEFT]={no:0,bit:s.PadValue.L},e[i.RIGHT]={no:0,bit:s.PadValue.R},e[i.UP]={no:0,bit:s.PadValue.U},e[i.DOWN]={no:0,bit:s.PadValue.D},e[i.Z]={no:0,bit:s.PadValue.B},e[i.X]={no:0,bit:s.PadValue.A},e[i.SPACE]={no:0,bit:s.PadValue.SELECT},e[i.RETURN]={no:0,bit:s.PadValue.START},e[i.J]={no:1,bit:s.PadValue.L},e[i.L]={no:1,bit:s.PadValue.R},e[i.I]={no:1,bit:s.PadValue.U},e[i.K]={no:1,bit:s.PadValue.D},e[i.Q]={no:1,bit:s.PadValue.B},e[i.W]={no:1,bit:s.PadValue.A},e[i.O]={no:1,bit:s.PadValue.SELECT},e[i.P]={no:1,bit:s.PadValue.START},e}(),u=function(){function e(){n(this,e),this.controller=[0,0]}return a(e,[{key:"onKeyDown",value:function(e){var t=o[e];t&&(this.controller[t.no]|=t.bit)}},{key:"onKeyUp",value:function(e){var t=o[e];t&&(this.controller[t.no]&=~t.bit)}},{key:"getStatus",value:function(e){return this.controller[e]}}]),e}();t.PadKeyHandler=u},464:function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e){var t=e.getContext("2d");t.strokeStyle="",t.fillStyle="rgb(64,64,64)",t.fillRect(0,0,e.width,e.height)}function o(e,t){var r=document.createElement("img"),n=String(Date.now());r.src=t.capture(),r.className="pixelated",r.style.width=r.style.height="100%",r.title=r.alt=n;var i=new p["default"](e,g,b,n);return i.setContent(r),i.addResizeBox(),e.add(i),i}function u(e,t){for(var r=[{fullscreen:"requestFullscreen",change:"fullscreenchange"},{fullscreen:"webkitRequestFullScreen",change:"webkitfullscreenchange"},{fullscreen:"mozRequestFullScreen",change:"mozfullscreenchange"},{fullscreen:"msRequestFullscreen",change:"MSFullscreenChange"}],n=0;n<r.length;++n)if(e[r[n].fullscreen]){var i=function(){e[r[n].fullscreen]();var i=r[n].change,a=function s(){var e=document.fullScreen||document.mozFullScreen||document.webkitIsFullScreen;t&&t(e),e||document.removeEventListener(i,s,!1)};return document.addEventListener(i,a,!1),{v:!0}}();if("object"===("undefined"==typeof i?"undefined":f(i)))return i.v}return!1}var c=function(){function e(e,t){var r=[],n=!0,i=!1,a=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(u){i=!0,a=u}finally{try{!n&&o["return"]&&o["return"]()}finally{if(i)throw a}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),l=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),h=function L(e,t,r){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,t);if(void 0===n){var i=Object.getPrototypeOf(e);return null===i?void 0:L(i,t,r)}if("value"in n)return n.value;var a=n.get;if(void 0!==a)return a.call(r)},f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},p=r(460),d=r(432),v=r(436),y=r(439),E=r(438),m=r(457),g=256,b=240,k=function(e){function t(e,r,a,u){n(this,t);var c=i(this,Object.getPrototypeOf(t).call(this,e,2*g,2*b,"NES"));c.app=r,c.nes=a,c.stream=u,c.addMenuBar([{label:"File",submenu:[{label:"Pause",click:function(){c.nes.cpu.paused?c.stream.triggerRun():c.stream.triggerPause()}},{label:"Reset",click:function(){c.stream.triggerReset()}},{label:"Screenshot",click:function(){o(c.wndMgr,c)}},{label:"Quit",click:function(){c.close()}}]},{label:"View",submenu:[{label:"1x1",click:function(){c.setClientSize(g,b)}},{label:"2x2",click:function(){c.setClientSize(2*g,2*b)}},{label:"Adjust aspect ratio",click:function(){var e=c.getRootNode(),t=parseInt(e.style.width,10),r=t*(b/g)|0;c.setClientSize(t,r)}},{label:"Max",click:function(){c.setClientSize(window.innerWidth-2,window.innerHeight-p["default"].HEADER_HEIGHT-2),c.setPos(0,0)}},{label:"Fullscreen",click:function(){c.setFullscreen()}}]},{label:"Debug",submenu:[{label:"Palette",click:function(){c.app.createPaletWnd()}},{label:"NameTable",click:function(){c.app.createNameTableWnd()}},{label:"PatternTable",click:function(){c.app.createPatternTableWnd()}},{label:"Trace",click:function(){c.app.createTraceWnd()}},{label:"Registers",click:function(){c.app.createRegisterWnd()}},{label:"Control",click:function(){c.app.createControlWnd()}},{label:"FPS",click:function(){c.createFpsWnd()}}]}]);var l=document.createElement("canvas");return l.width=g,l.height=b,l.style.width="100%",l.style.height="100%",l.className="pixelated",s(l),c.setContent(l),c.canvas=l,c.context=c.canvas.getContext("2d"),c.imageData=c.context.getImageData(0,0,c.canvas.width,c.canvas.height),c.addResizeBox(),c.subscription=c.stream.subscribe(function(e){switch(e){case m.AppEvent.Type.RENDER:c.nes.render(c.context,c.imageData);break;case m.AppEvent.Type.SCREEN_SHOT:o(c.wndMgr,c);break;case m.AppEvent.Type.RESET:s(c.canvas)}}),c}return a(t,e),l(t,[{key:"capture",value:function(){return this.canvas.toDataURL()}},{key:"getCanvas",value:function(){return this.canvas}},{key:"setFullscreen",value:function(e){var t=this;return u(this.contentHolder,function(r){var n=t.contentHolder.style;if(r){var i=window.parent.screen.width,a=window.parent.screen.height;i/a>=g/b?i=a*(g/b)|0:a=i*(b/g)|0,n.width=i+"px",n.height=a+"px",n.margin="auto",n.backgroundColor="black"}else n.width=n.height=n.margin=n.backgroundColor="";e&&e(r)})}},{key:"close",value:function(){this.subscription.unsubscribe(),this.stream.triggerDestroy(),h(Object.getPrototypeOf(t.prototype),"close",this).call(this)}},{key:"setFocus",value:function(){return this.canvas.focus(),this}},{key:"createFpsWnd",value:function(){var e=new I(this.wndMgr,this.stream);this.wndMgr.add(e)}}]),t}(p["default"]);t.ScreenWnd=k;var T=function(e){function t(e,r,a){n(this,t);var s=i(this,Object.getPrototypeOf(t).call(this,e,128,16,"Palette"));s.nes=r,s.stream=a,s.palet=new Uint8Array(t.W*t.H),s.tmp=new Uint8Array(t.W*t.H);var o=t.createDom(),u=c(o,2),l=u[0],h=u[1];return s.setContent(l),s.boxes=h,s.subscription=s.stream.subscribe(function(e){switch(e){case m.AppEvent.Type.DESTROY:s.close();break;case m.AppEvent.Type.RENDER:s.render()}}),s.render(),s}return a(t,e),l(t,[{key:"close",value:function(){this.subscription.unsubscribe(),h(Object.getPrototypeOf(t.prototype),"close",this).call(this)}},{key:"render",value:function(){var e=this.tmp;t.getPalet(this.nes,e);for(var r=t.W*t.H,n=0;r>n;++n){var i=e[n];i!==this.palet[n]&&(this.palet[n]=i,this.boxes[n].style.backgroundColor=d.Nes.getPaletColorString(i))}}}],[{key:"createDom",value:function(){var e=t.UNIT,r=t.W,n=t.H,i=document.createElement("div");i.className="clearfix",i.style.width=e*r+"px",i.style.height=e*n+"px";for(var a=new Array(r*n),s=0;n>s;++s)for(var o=0;r>o;++o){var u=document.createElement("div");u.className="pull-left",u.style.width=e-1+"px",u.style.height=e-1+"px",u.style.borderRight=u.style.borderBottom="1px solid black",a[o+s*r]=u,i.appendChild(u)}return[i,a]}},{key:"getPalet",value:function(e,r){for(var n=t.W*t.H,i=0;n>i;++i)r[i]=e.getPalet(i)}}]),t}(p["default"]);T.UNIT=8,T.W=16,T.H=2,t.PaletWnd=T;var A=function(e){function t(e,r,a){n(this,t);var o=i(this,Object.getPrototypeOf(t).call(this,e,512,240,"NameTable"));o.nes=r,o.stream=a;var u=document.createElement("canvas");return u.width=512,u.height=240,u.style.width="512px",u.style.height="240px",u.className="pixelated",s(u),o.setContent(u),o.canvas=u,o.subscription=o.stream.subscribe(function(e){switch(e){case m.AppEvent.Type.DESTROY:o.close();break;case m.AppEvent.Type.RENDER:o.render()}}),o.render(),o}return a(t,e),l(t,[{key:"close",value:function(){this.subscription.unsubscribe(),h(Object.getPrototypeOf(t.prototype),"close",this).call(this)}},{key:"render",value:function(){this.nes.renderNameTable(this.canvas)}}]),t}(p["default"]);t.NameTableWnd=A;var O=[0,0,0,255,0,0,0,255,0,0,0,255],C=function(e){function t(e,r,a){n(this,t);var s=i(this,Object.getPrototypeOf(t).call(this,e,256,128,"PatternTable"));s.nes=r,s.stream=a;var o=t.createCanvas();return s.setContent(o),s.canvas=o,s.subscription=s.stream.subscribe(function(e){switch(e){case m.AppEvent.Type.DESTROY:s.close();break;case m.AppEvent.Type.RENDER:s.render()}}),s.render(),s}return a(t,e),l(t,[{key:"close",value:function(){this.subscription.unsubscribe(),h(Object.getPrototypeOf(t.prototype),"close",this).call(this)}},{key:"render",value:function(){this.nes.renderPatternTable(this.canvas,O)}}],[{key:"createCanvas",value:function(){var e=document.createElement("canvas");return e.width=256,e.height=128,e.style.width="256px",e.style.height="128px",e.className="pixelated",s(e),e}}]),t}(p["default"]);t.PatternTableWnd=C;var R=function(e){function t(e,r,a){n(this,t);var s=i(this,Object.getPrototypeOf(t).call(this,e,100,160,"Regs"));s.nes=r,s.stream=a;var o=s.createContent();return s.setContent(o),s.subscription=s.stream.subscribe(function(e){switch(e){case m.AppEvent.Type.DESTROY:s.close();break;case m.AppEvent.Type.RESET:case m.AppEvent.Type.STEP:case m.AppEvent.Type.PAUSE:case m.AppEvent.Type.BREAK_POINT:s.updateStatus()}}),s}return a(t,e),l(t,[{key:"updateStatus",value:function(){var e=this.nes.cpu;this.valueElems[0].value=E.Util.hex(e.pc,4),this.valueElems[1].value=E.Util.hex(e.a,2),this.valueElems[2].value=E.Util.hex(e.x,2),this.valueElems[3].value=E.Util.hex(e.y,2),this.valueElems[4].value=E.Util.hex(e.s,2),this.valueElems[5].value=E.Util.hex(e.p,2),this.valueElems[6].value=String(this.nes.cycleCount)}},{key:"close",value:function(){this.subscription.unsubscribe(),h(Object.getPrototypeOf(t.prototype),"close",this).call(this)}},{key:"createContent",value:function(){var e=document.createElement("div");e.className="fixed-font";var t=[{name:"PC"},{name:"A"},{name:"X"},{name:"Y"},{name:"S"},{name:"P"},{name:"cycle"}],r=document.createElement("table");r.style.fontSize="10px",r.style.width="100%",this.valueElems=[];for(var n=0;n<t.length;++n){var i=document.createElement("tr");r.appendChild(i);var a=document.createElement("td");a.innerText=t[n].name,i.appendChild(a);var s=document.createElement("td");i.appendChild(s);var o=document.createElement("input");o.className="fixed-font",o.type="text",o.style.width="100%",s.appendChild(o),this.valueElems.push(o)}return e.appendChild(r),e}}]),t}(p["default"]);t.RegisterWnd=R;var w=3,S=100,M={opType:v.OpType.UNKNOWN,addressing:v.Addressing.UNKNOWN,bytes:1,cycle:0},P=function(e){function t(e,r,a){n(this,t);var s=i(this,Object.getPrototypeOf(t).call(this,e,400,160,"Trace"));s.nes=r,s.stream=a,s.mem=new Uint8Array(w),s.bins=new Array(w);var o=s.createContent();return s.setContent(o),s.reset(),s.subscription=s.stream.subscribe(function(e){switch(e){case m.AppEvent.Type.DESTROY:s.close();break;case m.AppEvent.Type.RESET:s.reset();case m.AppEvent.Type.STEP:case m.AppEvent.Type.PAUSE:case m.AppEvent.Type.BREAK_POINT:s.updateStatus()}}),s}return a(t,e),l(t,[{key:"reset",value:function(){this.lines=[]}},{key:"updateStatus",value:function(){for(var e=this.nes.cpu,t=e.read8Raw(e.pc),r=v.kInstTable[t]||M,n=0;n<r.bytes;++n){var i=e.read8Raw(e.pc+n);this.mem[n]=i,this.bins[n]=E.Util.hex(i,2)}for(var a=r.bytes;w>a;++a)this.bins[a]="  ";var s=E.Util.hex(e.pc,4),o=this.bins.join(" "),u=y.disassemble(r,this.mem,1,e.pc);this.putConsole(s+": "+o+"   "+u)}},{key:"close",value:function(){this.subscription.unsubscribe(),h(Object.getPrototypeOf(t.prototype),"close",this).call(this)}},{key:"createContent",value:function(){var e=document.createElement("div"),t=document.createElement("textarea");return t.className="fixed-font",t.style.fontSize="14px",t.style.width="100%",t.style.height="160px",t.style.resize="none",t.style.margin="0",t.style.padding="2px",t.style.border="none",t.style.boxSizing="border-box",e.appendChild(t),this.textarea=t,e}},{key:"putConsole",value:function(e){this.lines.push(e),this.lines.length>S&&this.lines.shift(),this.textarea.value=this.lines.join("\n"),this.textarea.scrollTop=this.textarea.scrollHeight}}]),t}(p["default"]);t.TraceWnd=P;var B=function(e){function t(e,r){n(this,t);var a=i(this,Object.getPrototypeOf(t).call(this,e,256,32,"Control"));a.stream=r;var s=a.createElement();return a.setContent(s),a.updateState(!0),a.subscription=a.stream.subscribe(function(e){switch(e){case m.AppEvent.Type.DESTROY:a.close();break;case m.AppEvent.Type.RUN:a.updateState(!1);break;case m.AppEvent.Type.PAUSE:case m.AppEvent.Type.BREAK_POINT:a.updateState(!0)}}),a}return a(t,e),l(t,[{key:"updateState",value:function(e){this.stepBtn.disabled=!e,this.runBtn.disabled=!e,this.pauseBtn.disabled=e}},{key:"close",value:function(){this.subscription.unsubscribe(),h(Object.getPrototypeOf(t.prototype),"close",this).call(this)}},{key:"createElement",value:function(){var e=this,t=document.createElement("div");t.style.width="256px",t.style.height="32px",this.stepBtn=document.createElement("button"),this.stepBtn.innerText="Step",this.stepBtn.addEventListener("click",function(){e.stream.triggerStep()}),t.appendChild(this.stepBtn),this.runBtn=document.createElement("button"),this.runBtn.innerText="Run",this.runBtn.addEventListener("click",function(){e.stream.triggerRun()}),t.appendChild(this.runBtn),this.pauseBtn=document.createElement("button"),this.pauseBtn.innerText="Pause",this.pauseBtn.addEventListener("click",function(){e.stream.triggerPause()}),t.appendChild(this.pauseBtn);var r=document.createElement("button");r.innerText="Reset",r.addEventListener("click",function(){e.stream.triggerReset()}),t.appendChild(r);var n=document.createElement("button");return n.innerText="Capture",n.addEventListener("click",function(){e.stream.triggerScreenShot()}),t.appendChild(n),t}}]),t}(p["default"]);t.ControlWnd=B;var I=function(e){function t(e,r){n(this,t);var a=i(this,Object.getPrototypeOf(t).call(this,e,80,48,"Fps"));a.stream=r;var s=document.createElement("div");return s.style.width="80px",s.style.height="48px",a.setContent(s),a.stats=new Stats,s.appendChild(a.stats.domElement),a.subscription=a.stream.subscribe(function(e){switch(e){case m.AppEvent.Type.DESTROY:a.close();break;case m.AppEvent.Type.START_CALC:a.stats.begin();break;case m.AppEvent.Type.END_CALC:a.stats.end()}}),a}return a(t,e),l(t,[{key:"close",value:function(){this.subscription.unsubscribe(),h(Object.getPrototypeOf(t.prototype),"close",this).call(this)}}]),t}(p["default"]);t.FpsWnd=I},465:function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t,r){e.getRootNode().style.zIndex=String(a+(r-1-t))}var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=100,s=function(){function e(t){r(this,e),this.root=t,this.windows=[]}return i(e,[{key:"add",value:function(e){this.windows.unshift(e),this.root.appendChild(e.getRootNode()),n(e,0,this.windows.length)}},{key:"remove",value:function(e){this.removeWnd(e);var t=e.getRootNode();null!=t&&t.parentNode.removeChild(t)}},{key:"moveToTop",value:function(e){var t=this.windows.length;if(!(t>0&&this.windows[0]===e))for(var r=e,i=0;t>i;++i){var a=this.windows[i];if(this.windows[i]=r,n(r,i,t),a===e)break;r=a}}},{key:"isTop",value:function(e){return this.windows.length>0&&this.windows[0]===e}},{key:"removeWnd",value:function(e){var t=this.windows.indexOf(e);if(!(0>t)){this.windows.splice(t,1);for(var r=0;t>r;++r)n(this.windows[r],r,this.windows.length)}}}]),e}();Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=s}});