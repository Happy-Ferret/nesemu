webpackJsonp([1],{0:function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e){var t=e.lastIndexOf(".");return t>=0?e.slice(t+1):""}function s(e,t){var r=new FileReader;r.onload=function(r){var n=new Uint8Array(r.target.result);t(n,e.name)},r.readAsArrayBuffer(e)}function a(e,t){var r=new FileReader;r.onload=function(e){var r=new Uint8Array(e.target.result),n=new f;n.loadAsync(r).then(function(e){Object.keys(e.files).forEach(function(r){"nes"===i(r).toLowerCase()&&e.files[r].async("uint8array").then(function(e){t(e,r)}).catch(function(e){console.error(e)})})}).catch(function(e){console.error(e)})},r.readAsArrayBuffer(e)}function o(e,t){switch(i(e.name).toLowerCase()){case"nes":s(e,t);break;case"zip":a(e,t)}}function u(e,t){function r(e){e.stopPropagation(),e.preventDefault();var r=e.dataTransfer.files;if(r.length>0)for(var n=0;n<r.length;++n){var i=r[n];o(i,function(r,n){t(r,n,e.pageX,e.pageY)})}return!1}function n(e){return e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy",!1}e.addEventListener("dragover",n,!1),e.addEventListener("drop",r,!1)}var c=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),l=r(443),h=r(472),p=r(479);r(480);var f=r(1);window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame}();var d=function(){function e(t){n(this,e),this.root=t,this.wndMgr=new p.default(t),this.apps=[]}return c(e,[{key:"setUp",value:function(){l.App.setUp(),this.setUpFileDrop(),this.setUpGamePadLink(),this.setUpOpenRomLink(),this.setUpBlur()}},{key:"setUpFileDrop",value:function(){var e=this;window.File&&window.FileReader&&window.FileList&&window.Blob&&u(this.root,function(t,r,n,i){e.createApp(t,r,n,i)})}},{key:"createApp",value:function(e,t,r,n){var i=this,s={title:t,centerX:r,centerY:n,onClosed:function(e){i.removeApp(e)}},a=l.App.create(this.wndMgr,s);a.loadRom(e),this.apps.push(a)}},{key:"removeApp",value:function(e){var t=this.apps.indexOf(e);t>=0&&this.apps.splice(t,1)}},{key:"setUpGamePadLink",value:function(){var e=this,t=document.getElementById("gamepad");return h.GamepadManager.isSupported()?void t.addEventListener("click",function(){var t=new h.GamepadWnd(e.wndMgr);e.wndMgr.add(t)}):t.style.display="none"}},{key:"setUpOpenRomLink",value:function(){var e=this,t=document.getElementById("rom-file");t.addEventListener("change",function(){if(t.value){var r=t.files;if(r){for(var n=0;n<r.length;++n)console.log(r[n]),o(r[n],function(t,r){e.createApp(t,r,0,0)});t.value=""}}})}},{key:"setUpBlur",value:function(){var e=this;window.addEventListener("blur",function(){e.apps.forEach(function(e){e.onBlur()})}),window.addEventListener("focus",function(){e.apps.forEach(function(e){e.onFocus()})})}}]),e}();window.addEventListener("load",function(){var e=document.getElementById("nesroot"),t=new d(e);t.setUp()})},443:function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t,r){return e<t?t:(r<t&&(r=t),e>r?r:e)}var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=r(444),o=r(451),u=r(470),c=r(471),l=r(472),h=r(476),p=r(477),f=r(478),d=r(474),y=1789773,v=1e3/15,b=function(){function e(t,r){var s=this;n(this,e),this.wndMgr=t,this.destroying=!1,this.paused=!1,this.nes=a.Nes.create(),window.nes=this.nes,this.nes.setVblankCallback(function(e){s.onVblank(e)}),this.nes.setBreakPointCallback(function(){s.onBreakPoint()}),this.audioManager=new c.AudioManager,this.stream=new u.AppEvent.Stream,this.subscription=this.stream.subscribe(function(e){switch(e){case u.AppEvent.Type.DESTROY:s.cleanUp(),r.onClosed&&r.onClosed(s);break;case u.AppEvent.Type.RENDER:break;case u.AppEvent.Type.RUN:s.nes.cpu.pause(!1);break;case u.AppEvent.Type.PAUSE:s.nes.cpu.pause(!0);break;case u.AppEvent.Type.STEP:s.nes.step();break;case u.AppEvent.Type.RESET:s.nes.reset()}}),this.screenWnd=new f.ScreenWnd(this.wndMgr,this,this.nes,this.stream),this.wndMgr.add(this.screenWnd),r.title&&this.screenWnd.setTitle(r.title);var o=this.screenWnd.getWindowSize(),l=i((r.centerX||0)-o.width/2,0,window.innerWidth-o.width-1),h=i((r.centerY||0)-o.height/2,0,window.innerHeight-o.height-1);this.screenWnd.setPos(l,h),this.padKeyHandler=new p.PadKeyHandler,this.setUpKeyEvent(this.screenWnd.getCanvas(),this.padKeyHandler),this.startLoopAnimation()}return s(e,[{key:"loadRom",value:function(e){return this.nes.setRomData(e)?(this.nes.reset(),this.nes.cpu.pause(!1),this.screenWnd.setFocus(),this.stream.triggerLoadRom(),window.$DEBUG&&(this.createPaletWnd(),this.createNameTableWnd(),this.createPatternTableWnd(),this.createTraceWnd(),this.createRegisterWnd(),this.createControlWnd()),!0):(alert("Illegal ROM format"),!1)}},{key:"onBlur",value:function(){this.paused||(this.paused=!0,this.audioManager.setMasterVolume(0))}},{key:"onFocus",value:function(){this.paused&&(this.paused=!1,this.audioManager.setMasterVolume(1))}},{key:"createPaletWnd",value:function(){var e=this;if(this.hasPaletWnd)return!1;var t=new f.PaletWnd(this.wndMgr,this.nes,this.stream);return this.wndMgr.add(t),t.setPos(520,0),t.setCallback(function(t){"close"===t&&(e.hasPaletWnd=!1)}),this.hasPaletWnd=!0}},{key:"createNameTableWnd",value:function(){var e=this;if(this.hasNameTableWnd)return!1;var t=new f.NameTableWnd(this.wndMgr,this.nes,this.stream,this.nes.ppu.mirrorMode===o.MirrorMode.HORZ);return this.wndMgr.add(t),t.setPos(520,40),t.setCallback(function(t){"close"===t&&(e.hasNameTableWnd=!1)}),this.hasNameTableWnd=!0}},{key:"createPatternTableWnd",value:function(){var e=this;if(this.hasPatternTableWnd)return!1;var t=new f.PatternTableWnd(this.wndMgr,this.nes,this.stream);return this.wndMgr.add(t),t.setPos(520,300),t.setCallback(function(t){"close"===t&&(e.hasPatternTableWnd=!1)}),this.hasPatternTableWnd=!0}},{key:"createTraceWnd",value:function(){var e=this;if(this.hasTraceWnd)return!1;var t=new f.TraceWnd(this.wndMgr,this.nes,this.stream);return this.wndMgr.add(t),t.setPos(0,500),t.setCallback(function(t){"close"===t&&(e.hasTraceWnd=!1)}),this.hasTraceWnd=!0}},{key:"createRegisterWnd",value:function(){var e=this;if(null!=this.hasRegisterWnd)return!1;var t=new f.RegisterWnd(this.wndMgr,this.nes,this.stream);return this.wndMgr.add(t),t.setPos(410,500),t.setCallback(function(t){"close"===t&&(e.hasRegisterWnd=null)}),this.hasRegisterWnd=!0}},{key:"createControlWnd",value:function(){var e=this;if(null!=this.hasCtrlWnd)return!1;var t=new f.ControlWnd(this.wndMgr,this.stream);return this.wndMgr.add(t),t.setPos(520,500),t.setCallback(function(t){"close"===t&&(e.hasCtrlWnd=null)}),this.hasCtrlWnd=!0}},{key:"cleanUp",value:function(){this.cancelLoopAnimation(),this.destroying=!0,this.audioManager.destroy(),this.subscription.unsubscribe(),this.wndMgr=null}},{key:"onVblank",value:function(e){e<1&&this.render();for(var t=0;t<c.AudioManager.CHANNEL;++t){var r=this.nes.apu.getVolume(t);this.audioManager.setChannelVolume(t,r),r>0&&this.audioManager.setChannelFrequency(t,this.nes.apu.getFrequency(t))}}},{key:"onBreakPoint",value:function(){this.stream.triggerBreakPoint()}},{key:"startLoopAnimation",value:function(){var e=this;if(null==this.rafId){var t=window.performance.now(),r=function r(){if(!e.destroying){e.stream.triggerStartCalc();var n=window.performance.now(),i=n-t;t=n,e.loop(i),e.stream.triggerEndCalc(),e.rafId=requestAnimationFrame(r)}};this.rafId=requestAnimationFrame(r)}}},{key:"cancelLoopAnimation",value:function(){null!=this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=null)}},{key:"loop",value:function(e){if(!this.nes.cpu.isPaused()){for(var t=this.screenWnd.isTop(),r=0;r<2;++r){var n=this.padKeyHandler.getStatus(r);t&&(n|=l.GamepadManager.getState(r)),this.nes.setPadStatus(r,n)}var i=Math.min(e,v),s=y*i/1e3|0;this.nes.runCycles(s)}}},{key:"render",value:function(){this.stream.triggerRender()}},{key:"setUpKeyEvent",value:function(e,t){var r=this;e.setAttribute("tabindex","1"),e.style.outline="none",e.addEventListener("keydown",function(e){return e.ctrlKey&&e.keyCode===h.KeyCode.W?void r.screenWnd.close():void(e.ctrlKey||e.altKey||e.metaKey||(e.preventDefault(),t.onKeyDown(e.keyCode)))}),e.addEventListener("keyup",function(e){e.preventDefault(),t.onKeyUp(e.keyCode)})}}],[{key:"setUp",value:function(){d.default.setKeyPrefix("nesemu:"),l.GamepadManager.setUp()}},{key:"create",value:function(t,r){return new e(t,r)}}]),e}();t.App=b},444:function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e){return e*(3/341)|0}function s(e){return 78===e[0]&&69===e[1]&&83===e[2]&&26===e[3]}function a(e){return e[6]>>4&15|240&e[7]}function o(e){var t=16,r=16384*e[4],n=e.slice(t,t+r);return new Uint8Array(n)}function u(e){var t=16+16384*e[4],r=8192*e[5],n=e.slice(t,t+r);return new Uint8Array(n)}var c=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),l=r(445),h=r(446),p=r(447),f=r(451),d=r(449),y=r(452),v=2048,b=241,g=242,E=261,m=262,k=341*m/3|0,O=16404,T=function(){function e(){var t=this;n(this,e),this.mapper=null,this.cpu=new p.Cpu,this.ram=new Uint8Array(v),this.ppu=new f.Ppu,this.apu=new l.Apu(function(){t.cpu.requestIrq()}),this.mapperNo=0,this.cycleCount=0,this.vblankCallback=function(e){},this.breakPointCallback=function(){},this.romData=new Uint8Array(0)}return c(e,[{key:"setVblankCallback",value:function(e){this.vblankCallback=e}},{key:"setBreakPointCallback",value:function(e){this.breakPointCallback=e}},{key:"setRomData",value:function(e){return!!s(e)&&(this.mapperNo=a(e),this.romData=o(e),this.ppu.setChrData(u(e)),this.ppu.setMirrorMode(0===(1&e[6])?f.MirrorMode.HORZ:f.MirrorMode.VERT),this.cpu.deleteAllBreakPoints(),this.setMemoryMap(this.mapperNo),!0)}},{key:"reset",value:function(){this.ram.fill(255),this.cpu.reset(),this.ppu.reset(),this.apu.reset(),this.cycleCount=0,null!=this.mapper&&this.mapper.reset()}},{key:"setPadStatus",value:function(e,t){this.apu.setPadStatus(e,t)}},{key:"runCycles",value:function(e){try{for(var t=e;t>0;){var r=this.step(t);if(t-=r,this.cpu.isPaused())return this.breakPointCallback(),0}return-e}catch(e){throw this.cpu.pause(!0),e}}},{key:"step",value:function(e){var t=this.cpu.step();return this.cycleCount=this.tryHblankEvent(this.cycleCount,t,e),t}},{key:"render",value:function(e){this.ppu.render(e)}},{key:"renderNameTable1",value:function(e,t,r,n,i){this.ppu.renderNameTable1(e,t,r,n,i<<10)}},{key:"renderPatternTable",value:function(e,t,r){this.ppu.renderPattern(e,t,r)}},{key:"getPalet",value:function(e){var t=this.ppu.vram,r=16128;return 63&t[r+(31&e)]}},{key:"setMemoryMap",value:function(e){var t=this,r=this.cpu;r.resetMemoryMap(),r.setReadMemory(8192,16383,function(e){var r=7&e;return t.ppu.read(r)}),r.setWriteMemory(8192,16383,function(e,r){var n=7&e;t.ppu.write(n,r)}),r.setReadMemory(16384,24575,function(e){return t.apu.read(e)}),r.setWriteMemory(16384,24575,function(e,r){switch(e){case O:0<=r&&r<=31?t.ppu.copyWithDma(t.ram,r<<8):console.error("OAMDMA not implemented except for RAM: "+d.Util.hex(r,2));break;default:t.apu.write(e,r)}});var n=this.romData.length-1;this.prgBank=[0,8192,-16384&n,-8192&n],r.setReadMemory(32768,65535,function(e){var r=e-32768>>13,n=8191&e,i=t.romData.length;return t.romData[t.prgBank[r]+n&i-1]}),r.setReadMemory(0,8191,function(e){return t.ram[e&v-1]}),r.setWriteMemory(0,8191,function(e,r){t.ram[e&v-1]=r}),this.mapper=this.createMapper(e)}},{key:"setPrgBank",value:function(e,t){this.prgBank[e]=t<<13}},{key:"createMapper",value:function(e){console.log("Mapper "+e),e in y.kMapperTable||(console.error("  not supported"),e=0);var t=y.kMapperTable[e];return new t(this,this.romData.length,this.cpu,this.ppu)}},{key:"tryHblankEvent",value:function(e,t,r){var n=e+t,s=i(e),a=i(n);if(a>s){switch(this.ppu.setHcount(a),this.apu.onHblank(a),a){case b:this.vblankCallback(r/k),this.ppu.setVBlank();break;case g:this.interruptVBlank();break;case E:this.ppu.clearVBlank();break;case m:n-=341*m/3|0,this.ppu.hcount=0}this.mapper.onHblank(a)}return n}},{key:"interruptVBlank",value:function(){this.ppu.interruptEnable()&&this.interruptNmi()}},{key:"interruptNmi",value:function(){this.cpu.nmi()}}],[{key:"create",value:function(){return new e}},{key:"getPaletColorString",value:function(e){var t=h.kColors[3*e],r=h.kColors[3*e+1],n=h.kColors[3*e+2];return"rgb("+t+","+r+","+n+")"}}]),e}();t.Nes=T},445:function(e,t){"use strict";function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var s=Object.getPrototypeOf(t);return null===s?void 0:e(s,r,n)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(n)},a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();!function(e){e[e.A=0]="A",e[e.B=1]="B",e[e.SELECT=2]="SELECT",e[e.START=3]="START",e[e.U=4]="U",e[e.D=5]="D",e[e.L=6]="L",e[e.R=7]="R"}(t.PadBit||(t.PadBit={}));t.PadBit;!function(e){e[e.A=1]="A",e[e.B=2]="B",e[e.SELECT=4]="SELECT",e[e.START=8]="START",e[e.U=16]="U",e[e.D=32]="D",e[e.L=64]="L",e[e.R=128]="R"}(t.PadValue||(t.PadValue={}));var o=(t.PadValue,16384),u=21,c=22,l=23,h=23,p=64,f=128,d=16,y=32,v=0,b=1,g=2,E=3,m=[10,254,20,2,40,4,80,6,160,8,60,10,14,12,26,14,12,16,24,18,48,20,96,22,192,24,72,26,16,28,32,30],k=[4,8,16,32,64,96,128,160,202,254,380,508,762,1016,2034,4068].map(function(e){return 1*e}),O=241,T=function(){function e(){i(this,e),this.status=new Array(2),this.tmp=new Array(2)}return a(e,[{key:"setStatus",value:function(e,t){this.status[e]=t}},{key:"latch",value:function(){this.tmp[0]=this.status[0],this.tmp[1]=this.status[1]}},{key:"shift",value:function(e){var t=this.tmp[e];return this.tmp[e]=t>>1,1&t}}]),e}(),C=function(){function e(){i(this,e),this.regs=new Uint8Array(4)}return a(e,[{key:"reset",value:function(){this.regs.fill(0)}},{key:"write",value:function(e,t){this.regs[e]=t}},{key:"getVolume",value:function(){return 0}},{key:"getFrequency",value:function(){return 0}},{key:"stop",value:function(){}},{key:"update",value:function(){}},{key:"isPlaying",value:function(){return!1}}]),e}(),w=function(e){function t(){i(this,t);var e=r(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.stopped=!1,e.lengthCounter=0,e.sweepCounter=0,e}return n(t,e),a(t,[{key:"reset",value:function(){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"reset",this).call(this),this.stopped=!0,this.sweepCounter=0}},{key:"stop",value:function(){this.stopped=!0}},{key:"write",value:function(e,r){switch(s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"write",this).call(this,e,r),e){case 1:this.sweepCounter=r>>4;break;case 3:var n=m[r>>3];this.lengthCounter=n,this.stopped=!1}}},{key:"isPlaying",value:function(){return!this.stop}},{key:"getVolume",value:function(){if(this.stopped)return 0;var e=this.regs[0];return 0!==(e&d)?(15&e)/15:1}},{key:"getFrequency",value:function(){var e=this.regs[2]+((7&this.regs[3])<<8);return 111875/(e+1)|0}},{key:"update",value:function(){return this.stopped?0:(this.updateVolumes(),void this.sweep())}},{key:"updateVolumes",value:function(){var e=this.lengthCounter,t=this.regs[0];0===(t&y)&&(this.lengthCounter=e-=8,e<=0&&(this.regs[0]=t=240&t,this.lengthCounter=0,this.stopped=!0))}},{key:"sweep",value:function e(){var e=this.regs[1];if(0!==(128&e)){var t=this.sweepCounter;t+=2;var r=e>>4&7;if(t>=r){t-=r;var n=this.regs[2]+((7&this.regs[3])<<8),i=7&e;if(i>0){var s=n>>i;0===(8&e)?(n+=s,n>2047&&(this.stopped=!0)):(n-=s,n<8&&(this.stopped=!0)),this.regs[2]=255&n,this.regs[3]=this.regs[3]&-8|(1792&n)>>8}t-=2,t<=0&&(this.sweepCounter=(e>>4&7)+t)}this.sweepCounter=t}}}]),t}(C),A=function(e){function t(){i(this,t);var e=r(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.stopped=!1,e.lengthCounter=0,e}return n(t,e),a(t,[{key:"reset",value:function(){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"reset",this).call(this),this.stopped=!0}},{key:"stop",value:function(){this.stopped=!0}},{key:"write",value:function(e,r){switch(s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"write",this).call(this,e,r),e){case 3:var n=m[r>>3];this.lengthCounter=n,this.stopped=!1}}},{key:"isPlaying",value:function(){return!this.stop}},{key:"getVolume",value:function(){return this.stopped?0:1}},{key:"getFrequency",value:function(){var e=this.regs[2]+((7&this.regs[3])<<8);return 55937.5/(e+1)|0}},{key:"update",value:function(){this.stopped||this.updateVolumes()}},{key:"updateVolumes",value:function(){var e=this.lengthCounter,t=this.regs[0];0===(t&y)&&(this.lengthCounter=e-=8,e<=0&&(this.regs[0]=t=240&t,this.lengthCounter=0,this.stopped=!0))}}]),t}(C),P=function(e){function t(){i(this,t);var e=r(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.stopped=!1,e.lengthCounter=0,e}return n(t,e),a(t,[{key:"reset",value:function(){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"reset",this).call(this),this.stopped=!0}},{key:"stop",value:function(){this.stopped=!0}},{key:"write",value:function(e,r){switch(s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"write",this).call(this,e,r),e){case 3:var n=m[r>>3];this.lengthCounter=n,this.stopped=!1}}},{key:"isPlaying",value:function(){return!this.stop}},{key:"getVolume",value:function(){if(this.stopped)return 0;var e=this.regs[0];return 0!==(e&d)?(15&e)/15:1}},{key:"getFrequency",value:function(){var e=15&this.regs[2];return k[e]}},{key:"update",value:function(){this.stopped||this.updateVolumes()}},{key:"updateVolumes",value:function(){var e=this.lengthCounter,t=this.regs[0];0===(t&y)&&(this.lengthCounter=e-=8,e<=0&&(this.regs[0]=t=240&t,this.lengthCounter=0,this.stopped=!0))}}]),t}(C),M=function(){function e(t){i(this,e),this.triggerIrq=t,this.regs=new Uint8Array(32),this.channels=new Array(e.CHANNEL),this.frameInterrupt=0,this.dmcInterrupt=128,this.gamePad=new T,this.channels[v]=new w,this.channels[b]=new w,this.channels[g]=new A,this.channels[E]=new P}return a(e,[{key:"reset",value:function(){this.regs.fill(0),this.regs[h]=p,this.frameInterrupt=0,this.dmcInterrupt=128,this.channels.forEach(function(e){e.reset()})}},{key:"read",value:function(t){var r=t-o;switch(r){case u:for(var n=this.dmcInterrupt|this.frameInterrupt,i=0;i<e.CHANNEL;++i)this.channels[i].isPlaying()&&(n|=1<<i);return this.frameInterrupt=0,n;case c:case l:return this.gamePad.shift(r-c);default:return 0}}},{key:"write",value:function(t,r){var n=t-o;if(!(n>=32)){if(this.regs[n]=r,n<16){var i=n>>2,s=3&n;this.channels[i].write(s,r)}switch(n){case u:this.dmcInterrupt=0;for(var a=0;a<e.CHANNEL;++a)0===(this.regs[u]&1<<a)&&this.channels[a].stop();break;case c:0===(1&r)&&this.gamePad.latch()}}}},{key:"getVolume",value:function(e){return this.channels[e].getVolume()}},{key:"getFrequency",value:function(e){return this.channels[e].getFrequency()}},{key:"setPadStatus",value:function(e,t){this.gamePad.setStatus(e,t)}},{key:"onHblank",value:function(e){switch(e){case O:this.channels.forEach(function(e){e.update()}),this.isIrqEnabled()&&(this.frameInterrupt=64,this.triggerIrq())}}},{key:"isIrqEnabled",value:function(){return 0===(this.regs[h]&(p|f))}}]),e}();M.CHANNEL=4,t.Apu=M},446:function(e,t){"use strict";var r;!function(e){e.WIDTH=256,e.HEIGHT=240}(r=t.Const||(t.Const={})),t.kColors=[124,124,124,0,0,252,0,0,188,68,40,188,148,0,132,168,0,32,168,16,0,136,20,0,80,48,0,0,120,0,0,104,0,0,88,0,0,64,88,0,0,0,0,0,0,0,0,0,188,188,188,0,120,248,0,88,248,104,68,252,216,0,204,228,0,88,248,56,0,228,92,16,172,124,0,0,184,0,0,168,0,0,168,68,0,136,136,0,0,0,0,0,0,0,0,0,248,248,248,60,188,252,104,136,252,152,120,248,248,120,248,248,88,152,248,120,88,252,160,68,248,184,0,184,248,24,88,216,84,88,248,152,0,232,216,120,120,120,0,0,0,0,0,0,252,252,252,164,228,252,184,184,248,216,184,248,248,184,248,248,164,192,240,208,176,252,224,168,248,216,120,216,248,120,184,248,184,184,248,216,0,252,252,248,216,248,0,0,0,0,0,0],t.kStaggered=function(){for(var e=8,t=1<<e,r=new Uint16Array(t),n=0;n<t;++n){for(var i=0,s=0;s<e;++s)i<<=2,0!==(n&1<<e-1-s)&&(i|=1);r[n]=i}return r}(),t.kFlipBits=function(){for(var e=8,t=1<<e,r=new Uint8Array(t),n=0;n<t;++n){for(var i=0,s=0;s<e;++s)i<<=1,0!==(n&1<<s)&&(i|=1);r[n]=i}return r}()},447:function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t,r){return t?e|r:e&~r}function s(e){return e+1&255}function a(e){return e-1&255}function o(e){return e<128?e:e-256}var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),c=r(448),l=r(449),h=r(450),p=0,f=1,d=2,y=3,v=4,b=5,g=6,E=7,m=1<<p,k=1<<f,O=1<<d,T=1<<y,C=1<<v,w=1<<b,A=1<<g,P=1<<E,M=65530,R=65532,B=65534,_=8192,S=200,I=~(P|k),L=~(P|k|m),D=function(){for(var e=new Uint8Array(256),t=0;t<256;++t){var r=0;0===t&&(r|=k),0!==(128&t)&&(r|=P),e[t]=r}return e}(),N=function(){var e={opType:c.OpType.UNKNOWN,addressing:c.Addressing.UNKNOWN,bytes:1,cycle:0},t=new Uint8Array(3),r=new Array(3);return function(n,i){for(var s=n.read8Raw(i),a=c.kInstTable[s]||e,o=0;o<a.bytes;++o){var u=n.read8Raw(n.pc+o);t[o]=u,r[o]=l.Util.hex(u,2)}for(var p=a.bytes;p<3;++p)r[p]="  ";var f=l.Util.hex(n.pc,4),d=r.join(" "),y=h.disassemble(a,t,1,n.pc);return f+": "+d+"   "+y}}(),x=function(){function e(){n(this,e),this.breakPoints={},this.watchRead={},this.watchWrite={},this.paused=!1,this.readerFuncTable=new Array(65536/_),this.writerFuncTable=new Array(65536/_),this.stepLogs=[],this.$DEBUG=!!window.$DEBUG,this.a=this.x=this.y=this.s=0}return u(e,[{key:"resetMemoryMap",value:function(){this.readerFuncTable.fill(null),this.writerFuncTable.fill(null)}},{key:"setReadMemory",value:function(e,t,r){for(var n=e/_|0,i=t/_|0,s=n;s<=i;++s)this.readerFuncTable[s]=r}},{key:"setWriteMemory",value:function(e,t,r){for(var n=e/_|0,i=t/_|0,s=n;s<=i;++s)this.writerFuncTable[s]=r}},{key:"reset",value:function(){this.p=O|C|w,this.s=this.s-3&255,this.pc=this.read16(R),this.readErrorReported=this.writeErrorReported=!1,this.stepLogs.length=0}},{key:"deleteAllBreakPoints",value:function(){this.breakPoints={},this.watchRead={},this.watchWrite={}}},{key:"pause",value:function(e){this.paused=e}},{key:"isPaused",value:function(){return this.paused}},{key:"nmi",value:function(){var e=this.read16(M);this.breakPoints.nmi&&(this.paused=!0,console.warn("paused because NMI: "+l.Util.hex(this.pc,4)+", "+l.Util.hex(e,4))),this.$DEBUG&&this.addStepLog("NMI occurred at pc="+l.Util.hex(this.pc,4)),this.push16(this.pc),this.push(this.p&~C),this.pc=e,this.p|=O}},{key:"requestIrq",value:function(){return 0===(this.p&O)&&(this.$DEBUG&&this.addStepLog("IRQ occurred at pc="+l.Util.hex(this.pc,4)),this.push16(this.pc),this.push(this.p&~C),this.pc=this.read16(B),this.p|=O,!0)}},{key:"step",value:function(){var e=this.pc;this.$DEBUG&&this.addStepLog(N(this,e));var t=this.read8(e++),r=c.kInstTable[t];if(null==r)return console.error("Unhandled OPCODE, "+l.Util.hex(this.pc-1,4)+": "+l.Util.hex(t,2)),this.paused=!0,0;this.pc+=r.bytes;var n=this.getAdr(e,r.addressing),i=r.cycle;switch(r.opType){default:case 0:break;case 1:break;case 2:this.a=this.read8(n),this.setNZFlag(this.a);break;case 3:this.write8(n,this.a);break;case 4:this.x=this.read8(n),this.setNZFlag(this.x);break;case 5:this.write8(n,this.x);break;case 6:this.y=this.read8(n),this.setNZFlag(this.y);break;case 7:this.write8(n,this.y);break;case 8:this.x=this.a,this.setNZFlag(this.x);break;case 9:this.y=this.a,this.setNZFlag(this.y);break;case 10:this.a=this.x,this.setNZFlag(this.x);break;case 11:this.a=this.y,this.setNZFlag(this.a);break;case 12:this.s=this.x;break;case 13:this.x=this.s,this.setNZFlag(this.x);break;case 14:var o=0!==(this.p&m)?1:0,u=this.read8(n),h=this.a+u+o,p=0!==((this.a^h)&(u^h)&128);this.a=255&h,this.setNZCFlag(this.a,h>=256),this.setOverFlow(p);break;case 15:var f=0!==(this.p&m)?1:0,d=255-this.read8(n),y=this.a+d+f,v=0!==((this.a^y)&(d^y)&128);this.a=255&y,this.setNZCFlag(this.a,y>=256),this.setOverFlow(v);break;case 16:this.x=s(this.x),this.setNZFlag(this.x);break;case 17:this.y=s(this.y),this.setNZFlag(this.y);break;case 18:var b=s(this.read8(n));this.write8(n,b),this.setNZFlag(b);break;case 19:this.x=a(this.x),this.setNZFlag(this.x);break;case 20:this.y=a(this.y),this.setNZFlag(this.y);break;case 21:var g=a(this.read8(n));this.write8(n,g),this.setNZFlag(g);break;case 22:var E=this.read8(n);this.a&=E,this.setNZFlag(this.a);break;case 23:var M=this.read8(n);this.a|=M,this.setNZFlag(this.a);break;case 24:var R=this.read8(n);this.a^=R,this.setNZFlag(this.a);break;case 25:var _=null==n?this.a:this.read8(n),S=0!==(this.p&m)?1:0,I=0!==(128&_),L=255&(_<<1|S);null==n?this.a=L:this.write8(n,L),this.setNZCFlag(L,I);break;case 26:var D=null==n?this.a:this.read8(n),x=0!==(this.p&m)?128:0,U=0!==(1&D),j=D>>1|x;null==n?this.a=j:this.write8(n,j),this.setNZCFlag(j,U);break;case 27:var H=null==n?this.a:this.read8(n),W=0!==(128&H),X=H<<1&255;null==n?this.a=X:this.write8(n,X),this.setNZCFlag(X,W);break;case 28:var q=null==n?this.a:this.read8(n),F=0!==(1&q),V=q>>1&255;null==n?this.a=V:this.write8(n,V),this.setNZCFlag(V,F);break;case 29:var G=this.read8(n),Z=this.a&G;this.setZero(0===Z);var Y=P|A;this.p=this.p&~Y|G&Y;break;case 30:var K=this.read8(n),z=this.a-K;this.setNZCFlag(255&z,z>=0);break;case 31:var $=this.read8(n),J=this.x-$;this.setNZCFlag(255&J,J>=0);break;case 32:var Q=this.read8(n),ee=this.y-Q;this.setNZCFlag(255&ee,ee>=0);break;case 33:this.pc=n;break;case 34:this.push16(this.pc-1),this.pc=n;break;case 35:this.pc=this.pop16()+1;break;case 36:this.p=this.pop()|w,this.pc=this.pop16();break;case 37:i+=this.branch(n,0===(this.p&m));break;case 38:i+=this.branch(n,0!==(this.p&m));break;case 39:i+=this.branch(n,0===(this.p&P));break;case 40:i+=this.branch(n,0!==(this.p&P));break;case 41:i+=this.branch(n,0===(this.p&k));break;case 42:i+=this.branch(n,0!==(this.p&k));break;case 43:i+=this.branch(n,0===(this.p&A));break;case 44:i+=this.branch(n,0!==(this.p&A));break;case 45:this.push(this.a);break;case 46:this.push(this.p|C);break;case 47:this.a=this.pop(),this.setNZFlag(this.a);break;case 48:this.p=this.pop()|w;break;case 49:this.p&=~m;break;case 50:this.p|=m;break;case 51:this.p|=O;break;case 52:this.p&=~O;break;case 53:this.p&=~A;break;case 54:this.p|=T;break;case 55:this.p&=~T;break;case 56:this.push16(this.pc+1),this.push(this.p|C),this.pc=this.read16(B),this.p|=O}return this.breakPoints[this.pc]&&(this.paused=!0,console.warn("paused because PC matched break point: "+l.Util.hex(this.pc,4))),i}},{key:"read8",value:function(e){var t=this.read8Raw(e);return this.watchRead[e]&&(this.paused=!0,console.warn("Break because watched point read: adr="+l.Util.hex(e,4)+", value="+l.Util.hex(t,2))),t}},{key:"read8Raw",value:function(e){var t=e/_|0,r=this.readerFuncTable[t];return r?r(e):(this.readErrorReported||(console.error("Illegal read at "+l.Util.hex(e,4)+", pc="+l.Util.hex(this.pc,4)),this.readErrorReported=!0),191)}},{key:"read16",value:function(e){var t=this.read8(e),r=this.read8(e+1);return r<<8|t}},{key:"read16Indirect",value:function(e){var t=this.read8(e),r=this.read8((65280&e)+(e+1&255));return r<<8|t}},{key:"write8",value:function(e,t){var r=e/_|0,n=this.writerFuncTable[r];if(n)return this.watchWrite[e]&&(this.paused=!0,console.warn("Break because watched point write: adr="+l.Util.hex(e,4)+", value="+l.Util.hex(t,2))),n(e,t);if(!this.writeErrorReported){var i=l.Util.hex(e,4),s=l.Util.hex(this.pc,4),a=l.Util.hex(t,2);console.error("Illegal write at "+i+", pc="+s+", "+a),this.writeErrorReported=!0}}},{key:"dump",value:function(e,t){for(var r=[],n=0;n<t;++n)r.push(this.read8(n+e));for(var i=0;i<t;i+=16){var s=r.splice(0,16).map(function(e){return l.Util.hex(e,2)}).join(" ");console.log(l.Util.hex(e+i,4)+": "+s)}}},{key:"push",value:function(e){this.write8(256+this.s,e),this.s=a(this.s)}},{key:"push16",value:function(e){var t=this.s;this.write8(256+t,e>>8),t=a(t),this.write8(256+t,255&e),this.s=a(t)}},{key:"pop",value:function(){return this.s=s(this.s),this.read8(256+this.s)}},{key:"pop16",value:function(){var e=this.s;e=s(e);var t=this.read8(256+e);e=s(e);var r=this.read8(256+e);return this.s=e,r<<8|t}},{key:"setNZFlag",value:function(e){this.p=this.p&I|D[e]}},{key:"setNZCFlag",value:function(e,t){this.p=this.p&L|D[e]|(t?m:0)}},{key:"setZero",value:function(e){this.p=i(this.p,e,k)}},{key:"setOverFlow",value:function(e){this.p=i(this.p,e,A)}},{key:"addStepLog",value:function(e){if(this.stepLogs.length<S)this.stepLogs.push(e);else{for(var t=1;t<S;++t)this.stepLogs[t-1]=this.stepLogs[t];this.stepLogs[S-1]=e}}},{key:"getAdr",value:function(e,t){switch(t){case c.Addressing.ACCUMULATOR:case c.Addressing.IMPLIED:return null;case c.Addressing.IMMEDIATE:case c.Addressing.RELATIVE:return e;case c.Addressing.ZEROPAGE:return this.read8(e);case c.Addressing.ZEROPAGE_X:return this.read8(e)+this.x&255;case c.Addressing.ZEROPAGE_Y:return this.read8(e)+this.y&255;case c.Addressing.ABSOLUTE:return this.read16(e);case c.Addressing.ABSOLUTE_X:return this.read16(e)+this.x&65535;case c.Addressing.ABSOLUTE_Y:return this.read16(e)+this.y&65535;case c.Addressing.INDIRECT_X:var r=this.read8(e);return this.read16Indirect(r+this.x&255);case c.Addressing.INDIRECT_Y:var n=this.read8(e),i=this.read16Indirect(n);return i+this.y&65535;case c.Addressing.INDIRECT:var s=this.read16(e);return this.read16Indirect(s);default:return console.error("Illegal addressing: "+t),this.paused=!0,null}}},{key:"branch",value:function(e,t){if(!t)return 0;var r=this.pc,n=r+o(this.read8(e))&65535;return this.pc=n,(256&(r^n))>0?2:1}}]),e}();t.Cpu=x},448:function(e,t){"use strict";var r=function(){function e(e,t){var r=[],n=!0,i=!1,s=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,s=e}finally{try{!n&&o.return&&o.return()}finally{if(i)throw s}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();!function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.IMPLIED=1]="IMPLIED",e[e.ACCUMULATOR=2]="ACCUMULATOR",e[e.IMMEDIATE=3]="IMMEDIATE",e[e.IMMEDIATE16=4]="IMMEDIATE16",e[e.ZEROPAGE=5]="ZEROPAGE",e[e.ZEROPAGE_X=6]="ZEROPAGE_X",e[e.ZEROPAGE_Y=7]="ZEROPAGE_Y",e[e.ABSOLUTE=8]="ABSOLUTE",e[e.ABSOLUTE_X=9]="ABSOLUTE_X",e[e.ABSOLUTE_Y=10]="ABSOLUTE_Y",e[e.INDIRECT=11]="INDIRECT",e[e.INDIRECT_X=12]="INDIRECT_X",e[e.INDIRECT_Y=13]="INDIRECT_Y",e[e.RELATIVE=14]="RELATIVE"}(t.Addressing||(t.Addressing={}));var n=t.Addressing;
!function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.NOP=1]="NOP",e[e.LDA=2]="LDA",e[e.STA=3]="STA",e[e.LDX=4]="LDX",e[e.STX=5]="STX",e[e.LDY=6]="LDY",e[e.STY=7]="STY",e[e.TAX=8]="TAX",e[e.TAY=9]="TAY",e[e.TXA=10]="TXA",e[e.TYA=11]="TYA",e[e.TXS=12]="TXS",e[e.TSX=13]="TSX",e[e.ADC=14]="ADC",e[e.SBC=15]="SBC",e[e.INX=16]="INX",e[e.INY=17]="INY",e[e.INC=18]="INC",e[e.DEX=19]="DEX",e[e.DEY=20]="DEY",e[e.DEC=21]="DEC",e[e.AND=22]="AND",e[e.ORA=23]="ORA",e[e.EOR=24]="EOR",e[e.ROL=25]="ROL",e[e.ROR=26]="ROR",e[e.ASL=27]="ASL",e[e.LSR=28]="LSR",e[e.BIT=29]="BIT",e[e.CMP=30]="CMP",e[e.CPX=31]="CPX",e[e.CPY=32]="CPY",e[e.JMP=33]="JMP",e[e.JSR=34]="JSR",e[e.RTS=35]="RTS",e[e.RTI=36]="RTI",e[e.BCC=37]="BCC",e[e.BCS=38]="BCS",e[e.BPL=39]="BPL",e[e.BMI=40]="BMI",e[e.BNE=41]="BNE",e[e.BEQ=42]="BEQ",e[e.BVC=43]="BVC",e[e.BVS=44]="BVS",e[e.PHA=45]="PHA",e[e.PHP=46]="PHP",e[e.PLA=47]="PLA",e[e.PLP=48]="PLP",e[e.CLC=49]="CLC",e[e.SEC=50]="SEC",e[e.SEI=51]="SEI",e[e.CLI=52]="CLI",e[e.CLV=53]="CLV",e[e.SED=54]="SED",e[e.CLD=55]="CLD",e[e.BRK=56]="BRK"}(t.OpType||(t.OpType={}));var i=t.OpType,s=[[234,i.NOP,n.IMPLIED,1,2],[169,i.LDA,n.IMMEDIATE,2,2],[165,i.LDA,n.ZEROPAGE,2,3],[181,i.LDA,n.ZEROPAGE_X,2,4],[173,i.LDA,n.ABSOLUTE,3,4],[189,i.LDA,n.ABSOLUTE_X,3,4],[185,i.LDA,n.ABSOLUTE_Y,3,4],[161,i.LDA,n.INDIRECT_X,2,6],[177,i.LDA,n.INDIRECT_Y,2,5],[133,i.STA,n.ZEROPAGE,2,3],[149,i.STA,n.ZEROPAGE_X,2,4],[141,i.STA,n.ABSOLUTE,3,4],[157,i.STA,n.ABSOLUTE_X,3,5],[153,i.STA,n.ABSOLUTE_Y,3,5],[149,i.STA,n.ZEROPAGE_X,2,4],[129,i.STA,n.INDIRECT_X,2,6],[145,i.STA,n.INDIRECT_Y,2,6],[162,i.LDX,n.IMMEDIATE,2,2],[166,i.LDX,n.ZEROPAGE,2,3],[182,i.LDX,n.ZEROPAGE_Y,2,4],[174,i.LDX,n.ABSOLUTE,3,4],[190,i.LDX,n.ABSOLUTE_Y,3,4],[134,i.STX,n.ZEROPAGE,2,3],[150,i.STX,n.ZEROPAGE_Y,2,4],[142,i.STX,n.ABSOLUTE,3,4],[160,i.LDY,n.IMMEDIATE,2,2],[164,i.LDY,n.ZEROPAGE,2,3],[180,i.LDY,n.ZEROPAGE_X,2,4],[172,i.LDY,n.ABSOLUTE,3,4],[188,i.LDY,n.ABSOLUTE_X,3,4],[132,i.STY,n.ZEROPAGE,2,3],[148,i.STY,n.ZEROPAGE_X,2,4],[140,i.STY,n.ABSOLUTE,3,4],[170,i.TAX,n.IMPLIED,1,2],[168,i.TAY,n.IMPLIED,1,2],[138,i.TXA,n.IMPLIED,1,2],[152,i.TYA,n.IMPLIED,1,2],[154,i.TXS,n.IMPLIED,1,2],[186,i.TSX,n.IMPLIED,1,2],[105,i.ADC,n.IMMEDIATE,2,2],[101,i.ADC,n.ZEROPAGE,2,3],[117,i.ADC,n.ZEROPAGE_X,2,4],[109,i.ADC,n.ABSOLUTE,3,4],[125,i.ADC,n.ABSOLUTE_X,3,4],[121,i.ADC,n.ABSOLUTE_Y,3,4],[97,i.ADC,n.INDIRECT_X,2,6],[113,i.ADC,n.INDIRECT_Y,2,5],[233,i.SBC,n.IMMEDIATE,2,2],[229,i.SBC,n.ZEROPAGE,2,3],[245,i.SBC,n.ZEROPAGE_X,2,4],[237,i.SBC,n.ABSOLUTE,3,4],[253,i.SBC,n.ABSOLUTE_X,3,4],[249,i.SBC,n.ABSOLUTE_Y,3,4],[225,i.SBC,n.INDIRECT_X,2,6],[241,i.SBC,n.INDIRECT_Y,2,5],[201,i.CMP,n.IMMEDIATE,2,2],[197,i.CMP,n.ZEROPAGE,2,3],[213,i.CMP,n.ZEROPAGE_X,2,4],[205,i.CMP,n.ABSOLUTE,3,4],[221,i.CMP,n.ABSOLUTE_X,3,4],[217,i.CMP,n.ABSOLUTE_Y,3,4],[193,i.CMP,n.INDIRECT_X,2,6],[209,i.CMP,n.INDIRECT_Y,2,5],[224,i.CPX,n.IMMEDIATE,2,2],[228,i.CPX,n.ZEROPAGE,2,3],[236,i.CPX,n.ABSOLUTE,3,4],[192,i.CPY,n.IMMEDIATE,2,2],[196,i.CPY,n.ZEROPAGE,2,3],[204,i.CPY,n.ABSOLUTE,3,4],[232,i.INX,n.IMPLIED,1,2],[200,i.INY,n.IMPLIED,1,2],[230,i.INC,n.ZEROPAGE,2,5],[246,i.INC,n.ZEROPAGE_X,2,6],[238,i.INC,n.ABSOLUTE,3,6],[254,i.INC,n.ABSOLUTE_X,3,7],[202,i.DEX,n.IMPLIED,1,2],[136,i.DEY,n.IMPLIED,1,2],[198,i.DEC,n.ZEROPAGE,2,5],[214,i.DEC,n.ZEROPAGE_X,2,6],[206,i.DEC,n.ABSOLUTE,3,6],[222,i.DEC,n.ABSOLUTE_X,3,7],[41,i.AND,n.IMMEDIATE,2,2],[37,i.AND,n.ZEROPAGE,2,3],[53,i.AND,n.ZEROPAGE_X,2,4],[45,i.AND,n.ABSOLUTE,3,4],[61,i.AND,n.ABSOLUTE_X,3,4],[57,i.AND,n.ABSOLUTE_Y,3,4],[33,i.AND,n.INDIRECT_X,2,6],[49,i.AND,n.INDIRECT_Y,2,5],[9,i.ORA,n.IMMEDIATE,2,2],[5,i.ORA,n.ZEROPAGE,2,3],[21,i.ORA,n.ZEROPAGE_X,2,4],[13,i.ORA,n.ABSOLUTE,3,4],[29,i.ORA,n.ABSOLUTE_X,3,4],[25,i.ORA,n.ABSOLUTE_Y,3,4],[1,i.ORA,n.INDIRECT_X,2,6],[17,i.ORA,n.INDIRECT_Y,2,5],[73,i.EOR,n.IMMEDIATE,2,2],[69,i.EOR,n.ZEROPAGE,2,3],[85,i.EOR,n.ZEROPAGE_X,2,4],[77,i.EOR,n.ABSOLUTE,3,4],[93,i.EOR,n.ABSOLUTE_X,3,4],[89,i.EOR,n.ABSOLUTE_Y,3,4],[65,i.EOR,n.INDIRECT_X,2,6],[81,i.EOR,n.INDIRECT_Y,2,5],[42,i.ROL,n.ACCUMULATOR,1,2],[38,i.ROL,n.ZEROPAGE,2,5],[54,i.ROL,n.ZEROPAGE_X,2,6],[46,i.ROL,n.ABSOLUTE,3,6],[62,i.ROL,n.ABSOLUTE_X,3,7],[106,i.ROR,n.ACCUMULATOR,1,2],[102,i.ROR,n.ZEROPAGE,2,5],[118,i.ROR,n.ZEROPAGE_X,2,6],[110,i.ROR,n.ABSOLUTE,3,6],[126,i.ROR,n.ABSOLUTE_X,3,7],[10,i.ASL,n.ACCUMULATOR,1,2],[6,i.ASL,n.ZEROPAGE,2,5],[22,i.ASL,n.ZEROPAGE_X,2,6],[14,i.ASL,n.ABSOLUTE,3,6],[30,i.ASL,n.ABSOLUTE_X,3,7],[74,i.LSR,n.ACCUMULATOR,1,2],[70,i.LSR,n.ZEROPAGE,2,5],[86,i.LSR,n.ZEROPAGE_X,2,6],[78,i.LSR,n.ABSOLUTE,3,6],[94,i.LSR,n.ABSOLUTE_X,3,7],[36,i.BIT,n.ZEROPAGE,2,3],[44,i.BIT,n.ABSOLUTE,3,4],[76,i.JMP,n.ABSOLUTE,3,3],[108,i.JMP,n.INDIRECT,3,5],[32,i.JSR,n.ABSOLUTE,3,6],[96,i.RTS,n.IMPLIED,1,6],[64,i.RTI,n.IMPLIED,1,6],[144,i.BCC,n.RELATIVE,2,2],[176,i.BCS,n.RELATIVE,2,2],[16,i.BPL,n.RELATIVE,2,2],[48,i.BMI,n.RELATIVE,2,2],[208,i.BNE,n.RELATIVE,2,2],[240,i.BEQ,n.RELATIVE,2,2],[80,i.BVC,n.RELATIVE,2,2],[112,i.BVS,n.RELATIVE,2,2],[72,i.PHA,n.IMPLIED,1,3],[8,i.PHP,n.IMPLIED,1,3],[104,i.PLA,n.IMPLIED,1,4],[40,i.PLP,n.IMPLIED,1,4],[24,i.CLC,n.IMPLIED,1,2],[56,i.SEC,n.IMPLIED,1,2],[120,i.SEI,n.IMPLIED,1,2],[88,i.CLI,n.IMPLIED,1,2],[184,i.CLV,n.IMPLIED,1,2],[248,i.SED,n.IMPLIED,1,2],[216,i.CLD,n.IMPLIED,1,2],[0,i.BRK,n.IMPLIED,1,7]];t.kInstTable=function(){var e=new Array(256);return e.fill(null),s.forEach(function(t){var n=r(t,5),i=n[0],s=n[1],a=n[2],o=n[3],u=n[4];e[i]={opType:s,addressing:a,bytes:o,cycle:u}}),e}()},449:function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(){function e(){r(this,e)}return n(e,null,[{key:"hex",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,r=e.toString(16),n=r.length-t;if(n>0)return r.substring(n);if(0===n)return r;var i="0000000";return i.substring(i.length+n)+r}}]),e}();t.Util=i},450:function(e,t,r){"use strict";function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t,r,n){var i="";switch(e.addressing){case a.Addressing.IMPLIED:case a.Addressing.ACCUMULATOR:break;case a.Addressing.IMMEDIATE:i=" #$"+o.Util.hex(t[r],2);break;case a.Addressing.IMMEDIATE16:i=" #$"+o.Util.hex(t[r]|t[r+1]<<8,4);break;case a.Addressing.ZEROPAGE:i=" $"+o.Util.hex(t[r],2);break;case a.Addressing.ZEROPAGE_X:i=" $"+o.Util.hex(t[r],2)+", X";break;case a.Addressing.ZEROPAGE_Y:i=" $"+o.Util.hex(t[r],2)+", Y";break;case a.Addressing.ABSOLUTE:i=" $"+o.Util.hex(t[r]|t[r+1]<<8,4);break;case a.Addressing.ABSOLUTE_X:i=" $"+o.Util.hex(t[r]|t[r+1]<<8,4)+", X";break;case a.Addressing.ABSOLUTE_Y:i=" $"+o.Util.hex(t[r]|t[r+1]<<8,4)+", Y";break;case a.Addressing.INDIRECT:i=" ($"+o.Util.hex(t[r]|t[r+1]<<8,4)+")";break;case a.Addressing.INDIRECT_X:i=" ($"+o.Util.hex(t[r],2)+", X)";break;case a.Addressing.INDIRECT_Y:i=" ($"+o.Util.hex(t[r],2)+"), Y";break;case a.Addressing.RELATIVE:var s=t[r];i=s<128?" +"+s+"  ; $"+o.Util.hex(n+e.bytes+s,4):" "+(s-256)+"  ; $"+o.Util.hex(n+e.bytes+s-256,4);break;default:console.error("Unhandled addressing: "+e.addressing)}return""+u[e.opType]+i}var s,a=r(448),o=r(449),u=(s={},n(s,a.OpType.LDA,"LDA"),n(s,a.OpType.STA,"STA"),n(s,a.OpType.LDX,"LDX"),n(s,a.OpType.STX,"STX"),n(s,a.OpType.LDY,"LDY"),n(s,a.OpType.STY,"STY"),n(s,a.OpType.TAX,"TAX"),n(s,a.OpType.TAY,"TAY"),n(s,a.OpType.TXA,"TXA"),n(s,a.OpType.TYA,"TYA"),n(s,a.OpType.TXS,"TXS"),n(s,a.OpType.TSX,"TSX"),n(s,a.OpType.ADC,"ADC"),n(s,a.OpType.SBC,"SBC"),n(s,a.OpType.INX,"INX"),n(s,a.OpType.INY,"INY"),n(s,a.OpType.INC,"INC"),n(s,a.OpType.DEX,"DEX"),n(s,a.OpType.DEY,"DEY"),n(s,a.OpType.DEC,"DEC"),n(s,a.OpType.AND,"AND"),n(s,a.OpType.ORA,"ORA"),n(s,a.OpType.EOR,"EOR"),n(s,a.OpType.ROL,"ROL"),n(s,a.OpType.ROR,"ROR"),n(s,a.OpType.ASL,"ASL"),n(s,a.OpType.LSR,"LSR"),n(s,a.OpType.BIT,"BIT"),n(s,a.OpType.CMP,"CMP"),n(s,a.OpType.CPX,"CPX"),n(s,a.OpType.CPY,"CPY"),n(s,a.OpType.JMP,"JMP"),n(s,a.OpType.JSR,"JSR"),n(s,a.OpType.RTS,"RTS"),n(s,a.OpType.RTI,"RTI"),n(s,a.OpType.BCC,"BCC"),n(s,a.OpType.BCS,"BCS"),n(s,a.OpType.BPL,"BPL"),n(s,a.OpType.BMI,"BMI"),n(s,a.OpType.BNE,"BNE"),n(s,a.OpType.BEQ,"BEQ"),n(s,a.OpType.BVC,"BVC"),n(s,a.OpType.BVS,"BVS"),n(s,a.OpType.PHA,"PHA"),n(s,a.OpType.PHP,"PHP"),n(s,a.OpType.PLA,"PLA"),n(s,a.OpType.PLP,"PLP"),n(s,a.OpType.CLC,"CLC"),n(s,a.OpType.SEC,"SEC"),n(s,a.OpType.SEI,"SEI"),n(s,a.OpType.CLI,"CLI"),n(s,a.OpType.CLV,"CLV"),n(s,a.OpType.SED,"SED"),n(s,a.OpType.CLD,"CLD"),n(s,a.OpType.BRK,"BRK"),n(s,a.OpType.NOP,"NOP"),s);t.disassemble=i},451:function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e){return e.concat()}function s(e,t,r,n){var i=(t>>5&1)+((r/30&1)<<1)^e,s=n<<10-(i<<1)&3072;return 8192+s}function a(e,t){if(e&=16383,12288<=e&&e<16128&&(e-=4096),8192<=e&&e<12288){var r=e>>10&3,n=t<<10-(r<<1)&3072;return 62463&e|n}return 16128<=e&&e<=16383&&(e&=65311,16144===(65523&e)&&(e&=65519)),e}function o(e,t){var r=0!==(t&k)?32:1;return e+r&d-1}function u(e){return(e&E)<<8}function c(e,t,r){for(var n=16128,i=63&r[n],s=h.kColors[3*i+0],a=h.kColors[3*i+1],o=h.kColors[3*i+2],u=h.Const.WIDTH*h.Const.HEIGHT,c=0,l=0;l<u;++l){var p=31&e[l];if(0===p)t[c+0]=s,t[c+1]=a,t[c+2]=o;else{var f=63&r[n+p],d=3*f;t[c+0]=h.kColors[d],t[c+1]=h.kColors[d+1],t[c+2]=h.kColors[d+2]}c+=4}}var l=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),h=r(446),p=r(449),f=8,d=16384,y=256,v=0,b=128,g=32,E=16,m=8,k=4,O=3,T=1,C=16,w=8,A=4,P=2,M=2,R=128,B=64,_=32,S=3,I=4,L=64,D=5,N=6,x=7,U=64,j=128;!function(e){e[e.HORZ=0]="HORZ",e[e.VERT=1]="VERT",e[e.SINGLE0=2]="SINGLE0",e[e.SINGLE1=3]="SINGLE1"}(t.MirrorMode||(t.MirrorMode={}));var H=t.MirrorMode,W=[80,68,0,85],X=[9,1,0,1,0,2,2,13,8,16,8,36,0,0,4,44,9,1,52,3,0,4,0,20,8,58,0,2,0,32,44,8],q=128,F=[q,255],V=function(){function e(){n(this,e),this.regs=new Uint8Array(f),this.vram=new Uint8Array(d),this.oam=new Uint8Array(y),this.mirrorMode=H.VERT,this.mirrorModeBit=68,this.chrBankOffset=new Array(8),this.hevents={count:0,events:[]},this.hevents2={count:0,events:[]},this.scrollCurr=0,this.scrollTemp=0,this.scrollFineX=0,this.offscreen=new Uint8Array(h.Const.WIDTH*h.Const.HEIGHT);for(var t=0;t<8;++t)this.chrBankOffset[t]=t<<10}return l(e,[{key:"reset",value:function(){this.regs.fill(0),this.vram.fill(0),this.oam.fill(0),this.hcount=0,this.ppuAddr=0,this.latch=0,this.bufferedValue=0,this.hevents={count:0,events:[]},this.hevents2={count:0,events:[]},this.offscreen.fill(0);for(var e=0;e<8;++e)this.chrBankOffset[e]=e<<10;for(var t=0;t<32;++t)this.vram[16128+t]=X[t]}},{key:"setChrData",value:function(e){e&&e.length>0?this.chrData=e:this.chrData=this.vram}},{key:"setChrBank",value:function(e){for(var t=e<<3,r=0;r<8;++r)this.setChrBankOffset(r,t+r)}},{key:"setChrBankOffset",value:function(e,t){var r=this.chrData.length;this.chrBankOffset[e]=t<<10&r-1,this.incScrollCounter(),this.addHevent({ppuCtrl:this.regs[v],ppuMask:this.regs[T],chrBankOffset:i(this.chrBankOffset),mirrorModeBit:this.mirrorModeBit,scrollCurr:this.scrollCurr,scrollFineX:this.scrollFineX})}},{key:"setMirrorMode",value:function(e){this.mirrorMode=e,this.mirrorModeBit=W[e],this.incScrollCounter(),this.addHevent({ppuCtrl:this.regs[v],ppuMask:this.regs[T],chrBankOffset:i(this.chrBankOffset),mirrorModeBit:this.mirrorModeBit,scrollCurr:this.scrollCurr,scrollFineX:this.scrollFineX})}},{key:"read",value:function(e){var t=this.regs[e];switch(e){case M:this.regs[M]&=~R,this.latch=0;break;case I:t=this.oam[this.regs[S]];break;case x:var r=this.ppuAddr,n=a(r,this.mirrorModeBit);16128<=n&&n<=16383?(t=this.readPpuDirect(n),this.bufferedValue=this.readPpuDirect(a(r-4096,this.mirrorModeBit))):(t=this.bufferedValue,this.bufferedValue=this.readPpuDirect(n)),this.ppuAddr=o(this.ppuAddr,this.regs[v])}return t}},{key:"write",value:function(e,t){switch(e===M&&(t&=~(R|B|_)),this.regs[e]=t,e){case v:this.incScrollCounter(),this.scrollTemp=this.scrollTemp&-3073|(t&O)<<10,this.scrollCurr=this.scrollCurr&-1056|1055&this.scrollTemp,this.addHevent({ppuCtrl:this.regs[v],ppuMask:this.regs[T],chrBankOffset:i(this.chrBankOffset),mirrorModeBit:this.mirrorModeBit,scrollCurr:this.scrollCurr,scrollFineX:this.scrollFineX});break;case T:this.incScrollCounter(),this.addHevent({ppuCtrl:this.regs[v],ppuMask:this.regs[T],chrBankOffset:i(this.chrBankOffset),mirrorModeBit:this.mirrorModeBit,scrollCurr:this.scrollCurr,scrollFineX:this.scrollFineX});break;case I:var r=this.regs[S];this.oam[r]=t,this.regs[S]=r+1&255;break;case D:this.incScrollCounter(),0===this.latch?(this.scrollTemp=this.scrollTemp&-32|t>>3,this.scrollFineX=7&t,this.scrollCurr=this.scrollCurr&-1056|1055&this.scrollTemp):this.scrollTemp=this.scrollTemp&-29665|(248&t)<<2|(7&t)<<12,this.addHevent({ppuCtrl:this.regs[v],ppuMask:this.regs[T],chrBankOffset:i(this.chrBankOffset),mirrorModeBit:this.mirrorModeBit,scrollCurr:this.scrollCurr,scrollFineX:this.scrollFineX}),this.latch=1-this.latch;break;case N:0===this.latch?(this.scrollTemp=this.scrollTemp&-32513|(63&t)<<8,this.ppuAddr=t):(this.scrollTemp=this.scrollTemp&-256|t,this.scrollCurr=this.scrollTemp,this.ppuAddr=this.scrollCurr,this.addHevent({ppuCtrl:this.regs[v],ppuMask:this.regs[T],chrBankOffset:i(this.chrBankOffset),mirrorModeBit:this.mirrorModeBit,scrollCurr:this.scrollCurr,scrollFineX:this.scrollFineX})),this.latch=1-this.latch;break;case x:var n=a(this.ppuAddr,this.mirrorModeBit);this.vram[n]=t,this.ppuAddr=o(this.ppuAddr,this.regs[v])}}},{key:"copyWithDma",value:function(e,t){for(var r=this.oam,n=this.regs[S],i=0;i<256;++i)r[n]=e[t+i],n=n+1&255}},{key:"setVBlank",value:function(){this.regs[M]=this.regs[M]|R;var e=this.hevents;this.hevents=this.hevents2,this.hevents2=e,this.hevents.count=0,this.addHevent({ppuCtrl:this.regs[v],ppuMask:this.regs[T],chrBankOffset:i(this.chrBankOffset),mirrorModeBit:this.mirrorModeBit,scrollCurr:this.scrollCurr,scrollFineX:this.scrollFineX})}},{key:"clearVBlank",value:function(){this.regs[M]&=~(R|B),this.scrollCurr=this.scrollTemp,this.addHevent({ppuCtrl:this.regs[v],ppuMask:this.regs[T],chrBankOffset:i(this.chrBankOffset),mirrorModeBit:this.mirrorModeBit,scrollCurr:this.scrollCurr,scrollFineX:this.scrollFineX})}},{key:"interruptEnable",value:function(){return 0!==(this.regs[v]&b)}},{key:"getSpritePatternTableAddress",value:function(){return 0===(this.regs[v]&g)?(this.regs[v]&m)<<9:0}},{key:"setHcount",value:function(e){this.hcount=e,this.checkSprite0Hit(e)}},{key:"render",value:function(e){this.renderBg(),this.renderSprite(),c(this.offscreen,e,this.vram)}},{key:"renderPattern",value:function(e,t,r){for(var n=8,i=0;i<2;++i)for(var s=0;s<16;++s)for(var a=0;a<16;++a)for(var o=16*(a+16*s+256*i),u=0;u<n;++u)for(var c=s*n+u,l=o+u,p=h.kStaggered[this.readPpuDirect(l+8)]<<1|h.kStaggered[this.readPpuDirect(l)],f=0;f<n;++f){var d=a*n+f+i*(16*n),y=p>>(n-1-f<<1)&3,v=3*y,b=4*(c*t+d);e[b+0]=r[v+0],e[b+1]=r[v+1],e[b+2]=r[v+2]}}},{key:"writePpuDirect",value:function(e,t){if(e>=8192)this.vram[e]=t;else{var r=this.chrBankOffset[e>>10&7];this.chrData[(1023&e)+r]=t}}},{key:"dumpVram",value:function(e,t){for(var r=[],n=0;n<t;++n)r.push(this.vram[a(e+n,this.mirrorModeBit)]);for(var i=0;i<t;i+=16){var s=r.splice(0,16).map(function(e){return p.Util.hex(e,2)}).join(" ");console.log(p.Util.hex(e+i,4)+": "+s)}}},{key:"renderNameTable1",value:function(e,t,r,n,i){for(var a=this,o=function(e,t){var r=e+t,n=r>>10&7,i=a.chrBankOffset[n],s=1023&r,o=i+s;return h.kStaggered[a.chrData[o+8]]<<1|h.kStaggered[a.chrData[o]]},c=8,l=u(this.regs[v]),p=this.vram,f=16128,d=63&p[f],y=h.kColors[3*d+0],b=h.kColors[3*d+1],g=h.kColors[3*d+2],E=0;E<h.Const.HEIGHT/c;++E)for(var m=(E+60)%60,k=m%30,O=0;O<h.Const.WIDTH/c;++O)for(var T=63&O,C=31&T,w=s(0,T,m,this.mirrorModeBit)+i,A=p[w+C+(k<<5)],P=16*A+l,M=(2&C)+((2&k)<<1),R=(C>>2)+(k<<1&248),B=w+960,_=(p[B+R]>>M&3)<<2,S=0;S<c;++S)for(var I=E*c+S,L=o(P,S),D=0;D<c;++D){var N=O*c+D,x=L>>(c-1-D<<1)&3,U=y,j=b,H=g;if(0!==x){var W=_+x,X=63&p[f+W],q=3*X;U=h.kColors[q],j=h.kColors[q+1],H=h.kColors[q+2]}var F=4*((I+n)*t+(N+r));e[F+0]=U,e[F+1]=j,e[F+2]=H}}},{key:"renderBg",value:function(){for(var e=this.hevents.count,t=0;t<e;++t){var r=this.hevents.events[t],n=r.hcount,i=t<e-1?this.hevents.events[t+1].hcount:h.Const.HEIGHT;if(!(n>=i))if(0!==(r.ppuMask&w)){var s=(3072&r.scrollCurr)>>10,a=u(r.ppuCtrl),o=0;0===(r.ppuMask&P)&&(o=8,this.clearBg(this.offscreen,n,i,o));var c=r.scrollFineX|(31&r.scrollCurr)<<3,l=(28672&r.scrollCurr)>>12|(992&r.scrollCurr)>>2;this.doRenderBg(c,l,s,n,i,o,r.chrBankOffset,r.mirrorModeBit,a)}else this.clearBg(this.offscreen,n,i,h.Const.WIDTH)}}},{key:"doRenderBg",value:function(e,t,r,n,i,a,o,u,c){var l=this,p=function(e,t){var r=e+t,n=r>>10&7,i=o[n],s=1023&r,a=i+s;return h.kStaggered[l.chrData[a+8]]<<1|h.kStaggered[l.chrData[a]]},f=8,d=h.Const.WIDTH,y=this.vram,v=this.offscreen;t>=240&&(t-=256);for(var b=n;b<i;++b)for(var g=b-n+t,E=((g>>3)+60)%60,m=E%30,k=0;k<h.Const.WIDTH/f+1;++k)for(var O=k+(e>>3)&63,T=31&O,C=s(r,O,E,u),w=y[C+T+(m<<5)],A=16*w+c,P=(2&T)+((2&m)<<1),M=(T>>2)+(m<<1&248),R=C+960,B=(y[R+M]>>P&3)<<2,_=p(A,7&g),S=0;S<f;++S){var I=k*f+S-(7&e);if(!(I<a)){if(I>=h.Const.WIDTH)break;var L=_>>(f-1-S<<1)&3;0!==L&&(L|=B);var D=b*d+I;v[D]=L}}}},{key:"clearBg",value:function(e,t,r,n){for(var i=h.Const.WIDTH,s=t;s<r;++s)for(var a=s*i,o=0;o<n;++o)e[a+o]=0}},{key:"isSprite8x16",value:function(){return 0!==(this.regs[v]&g)}},{key:"renderSprite",value:function(){for(var e=0,t=this.hevents.count,r=0;r<t;++r){var n=this.hevents.events[r];if(0!==(n.ppuMask&C)){var i=n.hcount,s=r<t-1?this.hevents.events[r+1].hcount:h.Const.HEIGHT;if(!(i>=s)){0===(this.regs[v]&g)&&(e=(this.regs[v]&m)<<9);var a=n.ppuMask&A?0:8;this.renderSprite2(i,s,a,n.chrBankOffset,e)}}}}},{key:"renderSprite2",value:function(e,t,r,n,i){for(var s=this,a=function(e,t,r){var i=e+(7&t)+((8&t)<<1),a=i>>10&7,o=n[a],u=1023&i,c=o+u,l=s.chrData[c+8],p=s.chrData[c];return r&&(l=h.kFlipBits[l],p=h.kFlipBits[p]),h.kStaggered[l]<<1|h.kStaggered[p]},o=8,u=h.Const.WIDTH,c=3,l=this.offscreen,p=this.oam,f=this.isSprite8x16(),d=f?16:8,y=0;y<L;++y){var v=p[4*y]+1;if(!(v+d<e||v>=t))for(var b=p[4*y+1],g=p[4*y+2],E=0!==(g&j),m=0!==(g&U),k=p[4*y+3],O=F[g>>5&1],T=f?16*(254&b)+((1&b)<<12):16*b+i,C=(g&c)<<2|(16|q),w=Math.max(0,e-v),A=Math.min(d,t-v),P=w;P<A&&!(v+P>=h.Const.HEIGHT);++P)for(var M=E?d-1-P:P,R=a(T,M,m),B=0;B<o;++B){var _=k+B;if(!(_<r)){if(_>=h.Const.WIDTH)break;var S=R>>(o-1-B<<1)&3;if(0!==S){var I=(v+P)*u+(k+B);0===(l[I]&O)?l[I]=C+S:l[I]|=q}}}}}},{key:"checkSprite0Hit",value:function(e){if(0===(this.regs[M]&B)&&(this.regs[T]&(w|C))===(w|C)){var t=this.oam[0];if(!(e<t||e>=t+16)){var r=this.oam[3];if(!(r>=255)){var n=this.getNonEmptySprite0Line();n<0||e!==t+n||(this.regs[M]|=B)}}}}},{key:"getNonEmptySprite0Line",value:function(){for(var e=this,t=function(t,r){var n=t+(7&r)+((8&r)<<1),i=n>>10&7,s=e.chrBankOffset[i],a=1023&n,o=s+a,u=e.chrData[o+8],c=e.chrData[o];return h.kStaggered[u]<<1|h.kStaggered[c]},r=this.oam,n=this.getSpritePatternTableAddress(),i=this.isSprite8x16(),s=i?16:8,a=0,o=r[4*a+1],u=r[4*a+2],c=0!==(u&j),l=i?16*(254&o)+((1&o)<<12):16*o+n,p=0;p<s;++p){var f=c?s-1-p:p,d=t(l,f);if(0!==d)return p}return-1}},{key:"addHevent",value:function(e){var t=this.hcount+1;t>=h.Const.HEIGHT&&(t=0);var r=this.hevents,n=r.count;(n<=0||r.events[n-1].hcount!==t)&&++n>=r.events.length&&r.events.push({});var i=r.events[n-1];i.hcount=t,Object.keys(e).forEach(function(t){i[t]=e[t]}),r.count=n}},{key:"incScrollCounter",value:function(){if(!(this.hevents.count<=0)){var e=this.hevents.events[this.hevents.count-1],t=this.hcount<h.Const.HEIGHT-1?this.hcount+1:0,r=t-e.hcount;if(!(r<=0)){var n=function(e){var t=240*(e>>11&1),n=(992&e)>>2|e>>12&7;n>=240&&(n-=256);var i=t+n+r,s=i/240&1,a=i%240;return e&-31713|(248&a)<<2|(7&a)<<12|s<<11};this.scrollTemp=n(this.scrollTemp),this.scrollCurr=n(this.scrollCurr)}}}},{key:"readPpuDirect",value:function(e){if(e>=8192)return this.vram[e];var t=this.chrBankOffset[e>>10&7];return this.chrData[(1023&e)+t]}}]),e}();t.Ppu=V},452:function(e,t,r){"use strict";var n=r(453),i=r(455),s=r(456),a=r(457),o=r(458),u=r(459),c=r(460),l=r(461),h=r(462),p=r(463),f=r(464),d=r(465),y=r(466),v=r(467),b=r(468),g=r(469);t.kMapperTable={0:n.Mapper000,1:i.Mapper001,2:s.Mapper002,3:a.Mapper003,4:o.Mapper004,7:u.Mapper007,10:c.Mapper010,19:l.Mapper019,23:h.Mapper023,24:p.Mapper024,25:h.Mapper025,26:p.Mapper026,32:f.Mapper032,69:d.Mapper069,73:y.Mapper073,75:b.Mapper075,87:v.Mapper087,88:o.Mapper004,93:s.Mapper093,95:o.Mapper004,118:o.Mapper004,184:g.Mapper184,185:a.Mapper185,206:o.Mapper004}},453:function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=r(454),o=function(e){function t(){return n(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return s(t,e),t}(a.Mapper);t.Mapper000=o},454:function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(){function e(){r(this,e)}return n(e,[{key:"reset",value:function(){}},{key:"onHblank",value:function(e){}}]),e}();t.Mapper=i},455:function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=r(454),o=r(451),u=[o.MirrorMode.SINGLE0,o.MirrorMode.SINGLE1,o.MirrorMode.VERT,o.MirrorMode.HORZ],c=function(e){function t(e,r,s,a){n(this,t);var o=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));o.cpu=s,o.ppu=a;var c=14,l=(r>>c)-1,h=0,p=0,f=3,d=0,y=!0,v=[0,4],b=function(){h=0,p=0},g=function(e,t){if(y)for(var r=e<<2,n=t<<2,i=0;i<4;++i)a.setChrBankOffset(r+i,n+i);else 0===e&&a.setChrBank(t>>1);v[e]=t},E=function(t,r){d=t;var n=r&(16&l),i=(15&t|n)&l,s=void 0,a=void 0;switch(f){case 0:case 1:s=i&-2,a=1|i;break;case 2:s=0,a=i;break;case 3:s=i,a=15&l|n;break;default:return}e.setPrgBank(0,s<<1),e.setPrgBank(1,(s<<1)+1),e.setPrgBank(2,a<<1),e.setPrgBank(3,(a<<1)+1)};s.setWriteMemory(32768,65535,function(e,t){if(0!==(128&t))return b();if(h|=(1&t)<<p,!(++p<5)){switch(57344&e){case 32768:a.setMirrorMode(u[3&h]),f=h>>2&3,E(d,v[0]);var r=0!==(16&h);y!==r&&(y=r,g(0,v[0]),g(1,v[1]));break;case 40960:case 49152:var n=e-40960>>13&1,i=31&h;v[n]!==i&&g(n,i),0===n&&E(d,i);break;case 57344:E(h,v[0])}b()}});var m=new Uint8Array(8192);return m.fill(191),s.setReadMemory(24576,32767,function(e){return m[8191&e]}),s.setWriteMemory(24576,32767,function(e,t){m[8191&e]=t}),E(0,255),o}return s(t,e),t}(a.Mapper);t.Mapper001=c},456:function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=r(454),o=function(e){function t(e,r,s,a,o){n(this,t);var u=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),c=14,l=s>>c;return r.setPrgBank(0,0),r.setPrgBank(1,1),r.setPrgBank(2,2*l-2),r.setPrgBank(3,2*l-1),a.setWriteMemory(32768,65535,function(t,n){var i=n>>e<<1;r.setPrgBank(0,i),r.setPrgBank(1,i+1)}),u}return s(t,e),t}(a.Mapper),u=function(e){function t(e,r,s,a){return n(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,0,e,r,s,a))}return s(t,e),t}(o);t.Mapper002=u;var c=function(e){function t(e,r,s,a){return n(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,4,e,r,s,a))}return s(t,e),t}(o);t.Mapper093=c},457:function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=r(454),o=function(e){function t(e,r,s,a){n(this,t);var o=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return s.setWriteMemory(32768,65535,function(e,t){a.setChrBank(t)}),o}return s(t,e),t}(a.Mapper);t.Mapper003=o;var u=function(e){function t(e,r,s,a){n(this,t);var o=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r,s,a));return a.writePpuDirect(0,1),o}return s(t,e),t}(o);t.Mapper185=u},458:function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(454),u=r(451),c=262,l=function(e){function t(e,r,s,a){n(this,t);var o=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));o.cpu=s,o.ppu=a,o.irqHlineEnable=!1,o.irqHlineValue=o.irqHlineCounter=-1;var c=13,l=new Uint8Array(8),h=(r>>c)-1,p=0;e.setPrgBank(3,h);var f=function(t){0===(64&t)?(e.setPrgBank(0,l[6]),e.setPrgBank(1,l[7]),e.setPrgBank(2,h-1)):(e.setPrgBank(2,l[6]),e.setPrgBank(1,l[7]),e.setPrgBank(0,h-1))},d=function(e){0===(128&e)?(a.setChrBankOffset(0,254&l[0]),a.setChrBankOffset(1,1|l[0]),a.setChrBankOffset(2,254&l[1]),a.setChrBankOffset(3,1|l[1]),a.setChrBankOffset(4,l[2]),a.setChrBankOffset(5,l[3]),a.setChrBankOffset(6,l[4]),a.setChrBankOffset(7,l[5])):(a.setChrBankOffset(4,254&l[0]),a.setChrBankOffset(5,1|l[0]),a.setChrBankOffset(6,254&l[1]),a.setChrBankOffset(7,1|l[1]),a.setChrBankOffset(0,l[2]),a.setChrBankOffset(1,l[3]),a.setChrBankOffset(2,l[4]),a.setChrBankOffset(3,l[5]))},y=new Uint8Array(8192);y.fill(255),s.setReadMemory(24576,32767,function(e){return y[8191&e]}),s.setWriteMemory(24576,32767,function(e,t){y[8191&e]=t}),s.setWriteMemory(32768,40959,function(e,t){if(0===(1&e))p=t,f(p),d(p);else{var r=7&p;l[r]=t,r<6?d(p):f(p)}}),s.setWriteMemory(40960,49151,function(e,t){0===(1&e)&&a.setMirrorMode(0===(1&t)?u.MirrorMode.VERT:u.MirrorMode.HORZ)});var v=0;return s.setWriteMemory(49152,57343,function(e,t){0===(1&e)?(v=t,o.setIrqHlineValue(v)):o.setIrqHlineValue(v)}),s.setWriteMemory(57344,65535,function(e,t){0===(1&e)?(o.enableIrqHline(!1),o.resetIrqHlineCounter()):o.enableIrqHline(!0)}),f(p),a.setMirrorMode(u.MirrorMode.VERT),o}return s(t,e),a(t,[{key:"reset",value:function(){this.irqHlineEnable=!1,this.irqHlineValue=this.irqHlineCounter=-1}},{key:"onHblank",value:function(e){switch(0!==(24&this.ppu.regs[1])&&0===--this.irqHlineCounter&&this.irqHlineEnable&&this.cpu.requestIrq(),e){case c:this.irqHlineCounter=this.irqHlineValue}}},{key:"setIrqHlineValue",value:function(e){this.irqHlineValue=e,this.irqHlineCounter=this.irqHlineValue}},{key:"enableIrqHline",value:function(e){this.irqHlineEnable=e}},{key:"resetIrqHlineCounter",value:function(){this.irqHlineCounter=0}}]),t}(o.Mapper);t.Mapper004=l},459:function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=r(454),o=r(451),u=[o.MirrorMode.SINGLE0,o.MirrorMode.SINGLE1],c=function(e){function t(e,r,s,a){n(this,t);var o=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return s.setWriteMemory(32768,65535,function(t,r){for(var n=r<<2,i=0;i<4;++i)e.setPrgBank(i,n+i);var s=r>>4&1;a.setMirrorMode(u[s])}),o}return s(t,e),t}(a.Mapper);t.Mapper007=c},460:function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=r(454),o=r(451),u=function(e){function t(e,r,s,a){n(this,t);var u=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));s.setWriteMemory(40960,49151,function(t,r){if(t<45056){var n=r<<1;e.setPrgBank(0,n),e.setPrgBank(1,n+1)}else a.setChrBank(r)}),s.setWriteMemory(57344,61440,function(e,t){e>=61440&&a.setMirrorMode(0===(1&t)?o.MirrorMode.VERT:o.MirrorMode.HORZ)});var c=new Uint8Array(8192);return c.fill(191),s.setReadMemory(24576,32767,function(e){return c[8191&e]}),s.setWriteMemory(24576,32767,function(e,t){c[8191&e]=t}),u}return s(t,e),t}(a.Mapper);t.Mapper010=u},461:function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,
configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=r(454),o=function(e){function t(e,r,s,a){n(this,t);var o=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return s.setWriteMemory(32768,49151,function(e,t){var r=e>>11&7;a.setChrBankOffset(r,t)}),s.setWriteMemory(57344,65535,function(t,r){if(t<=63487){var n=(t-57344)/2048;e.setPrgBank(n,r)}}),o}return s(t,e),t}(a.Mapper);t.Mapper019=o},462:function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(454),u=r(451),c=1,l=2,h=4,p=[u.MirrorMode.VERT,u.MirrorMode.HORZ,u.MirrorMode.SINGLE0,u.MirrorMode.SINGLE1],f=function(e){function t(e,r,s,a,o){n(this,t);var u=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));u.cpu=s,u.ppu=a,u.irqControl=0,u.irqLatch=0,u.irqCounter=0;var h=13,f=r>>h,d=0,y=new Array(8);e.setPrgBank(0,0),e.setPrgBank(1,1),e.setPrgBank(2,f-2),e.setPrgBank(3,f-1),s.setWriteMemory(32768,40959,function(t,r){if(32768<=t&&t<=32774)switch(d){case 0:e.setPrgBank(0,r);break;case 1:e.setPrgBank(2,r)}else if(36864===(65280&t)){var n=o[255&t];if(0===n||2===n){var i=3&r;a.setMirrorMode(p[i])}else if(4===n||6===n)switch(d=r>>1&1){case 0:e.setPrgBank(2,f-2);break;case 1:e.setPrgBank(0,f-2)}}}),s.setWriteMemory(40960,49151,function(t,r){if(40960<=t&&t<=40966)e.setPrgBank(1,r&f-1);else if(45056===(65280&t)){var n=o[255&t];0===n?(y[0]=y[0]&-16|15&r,a.setChrBankOffset(0,y[0])):2===n?(y[0]=y[0]&-497|(31&r)<<4,a.setChrBankOffset(0,y[0])):4===n?(y[1]=y[1]&-16|15&r,a.setChrBankOffset(1,y[1])):6===n&&(y[1]=y[1]&-497|(31&r)<<4,a.setChrBankOffset(1,y[1]))}}),s.setWriteMemory(49152,65535,function(e,t){if(49152<=e&&e<=61439){var r=o[255&e],n=0,i=!1;if(0===r)n=0;else if(2===r)n=0,i=!0;else if(4===r)n=1;else{if(6!==r)return;n=1,i=!0}var s=((12288&e)>>11)+2+n;i?y[s]=y[s]&-497|(31&t)<<4:y[s]=y[s]&-16|15&t,a.setChrBankOffset(s,y[s])}else{var h=o[255&e];if(0===h)u.irqLatch=u.irqLatch&-16|15&t;else if(2===h)u.irqLatch=u.irqLatch&-241|(15&t)<<4;else if(4===h)u.irqControl=t,0!==(u.irqControl&l)&&(u.irqCounter=u.irqLatch);else if(6===h){var p=u.irqControl&c;u.irqControl=u.irqControl&~l|p<<1}}});var v=new Uint8Array(8192);return v.fill(255),s.setReadMemory(24576,32767,function(e){return v[8191&e]}),s.setWriteMemory(24576,32767,function(e,t){v[8191&e]=t}),u}return s(t,e),a(t,[{key:"reset",value:function(){this.irqControl=0,this.irqLatch=this.irqCounter=0}},{key:"onHblank",value:function(e){if(0!==(this.irqControl&l)){var t=this.irqCounter;t+=0===(this.irqControl&h)?1:185,t>255&&(t=this.irqLatch,this.cpu.requestIrq()),this.irqCounter=t}}}]),t}(o.Mapper),d=function(e){function t(e,r,s,a){return n(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r,s,a,{0:0,4:2,8:4,12:6,1:2,2:4,3:6}))}return s(t,e),t}(f);t.Mapper023=d;var y=function(e){function t(e,r,s,a){return n(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r,s,a,{0:0,1:4,2:2,3:6}))}return s(t,e),t}(f);t.Mapper025=y},463:function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(454),u=r(451),c=1,l=2,h=4,p=[u.MirrorMode.VERT,u.MirrorMode.HORZ,u.MirrorMode.SINGLE0,u.MirrorMode.SINGLE1],f=[[0,1,2,3,4,5,6,7],[0,0,1,1,2,2,3,3],[0,1,2,3,4,4,5,5],[0,1,2,3,4,4,5,5]],d=function(e){function t(e,r,s,a,o){n(this,t);var u=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));u.cpu=s,u.ppu=a,u.irqControl=0,u.irqLatch=0,u.irqCounter=0;var h=13,d=r>>h;e.setPrgBank(0,0),e.setPrgBank(1,1),e.setPrgBank(2,d-2),e.setPrgBank(3,d-1),s.setWriteMemory(32768,40959,function(t,r){if(32768<=t&&t<=32771){var n=(r&d/2-1)<<1;e.setPrgBank(0,n),e.setPrgBank(1,n+1)}}),s.setWriteMemory(49152,57343,function(t,r){49152<=t&&t<=49155&&e.setPrgBank(2,r)});var y=0,v=0,b=new Uint8Array(8),g=function(){for(var e=f[y],t=0;t<8;++t)a.setChrBankOffset(t,b[e[t]])},E=45056|o[3];s.setWriteMemory(40960,49151,function(e,t){(61695&e)===E&&(y=3&t,g(),v=t>>2&3,a.setMirrorMode(p[v]))}),s.setWriteMemory(53248,65535,function(e,t){if(53248<=e&&e<=61439){var r=e-53248>>10&4,n=15&e;if(n<4){var i=o[n]+r;b[i]=t,g()}}else{var s=255&e;switch(s){case 0:u.irqLatch=t;break;case 1:u.irqControl=t,0!==(u.irqControl&l)&&(u.irqCounter=u.irqLatch);break;case 2:var a=u.irqControl&c;u.irqControl=u.irqControl&~l|a<<1}}});var m=new Uint8Array(8192);return m.fill(255),s.setReadMemory(24576,32767,function(e){return m[8191&e]}),s.setWriteMemory(24576,32767,function(e,t){m[8191&e]=t}),u}return s(t,e),a(t,[{key:"reset",value:function(){this.irqControl=0,this.irqLatch=this.irqCounter=0}},{key:"onHblank",value:function(e){if(0!==(this.irqControl&l)){var t=this.irqCounter;t+=0===(this.irqControl&h)?1:185,t>=255&&(t=this.irqLatch,this.cpu.requestIrq()),this.irqCounter=t}}}]),t}(o.Mapper),y=function(e){function t(e,r,s,a){return n(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r,s,a,{0:0,1:1,2:2,3:3}))}return s(t,e),t}(d);t.Mapper024=y;var v=function(e){function t(e,r,s,a){return n(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r,s,a,{0:0,1:2,2:1,3:3}))}return s(t,e),t}(d);t.Mapper026=v},464:function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=r(454),o=r(451),u=[o.MirrorMode.VERT,o.MirrorMode.HORZ],c=function(e){function t(e,r,s,a){n(this,t);var o=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),c=13,l=(r>>c)-1,h=l-1,p=[0,1<<c],f=0,d=function(){var t=void 0,r=void 0,n=void 0;0===f?(t=p[0],r=p[1],n=h):(n=p[0],r=p[1],t=h),e.setPrgBank(0,t),e.setPrgBank(1,r),e.setPrgBank(2,n)},y=new Uint8Array(8192);return y.fill(191),s.setReadMemory(24576,32767,function(e){return y[8191&e]}),s.setWriteMemory(24576,32767,function(e,t){y[8191&e]=t}),s.setWriteMemory(32768,40959,function(e,t){e<=36863?(p[0]=t,d()):(a.setMirrorMode(u[1&t]),f=t>>1&1,d())}),s.setWriteMemory(40960,49151,function(e,t){e<=45055?(p[1]=t,d()):a.setChrBankOffset(7&e,t)}),o}return s(t,e),t}(a.Mapper);t.Mapper032=c},465:function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=r(454),o=r(451),u=[o.MirrorMode.VERT,o.MirrorMode.HORZ,o.MirrorMode.SINGLE0,o.MirrorMode.SINGLE1],c=function(e){function t(e,r,s,a){n(this,t);var o=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),c=0;s.setWriteMemory(32768,40959,function(e,t){c=15&t}),s.setWriteMemory(40960,49151,function(t,r){switch(c){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a.setChrBankOffset(c,r);break;case 9:case 10:case 11:e.setPrgBank(c-9,r);break;case 12:a.setMirrorMode(u[3&r])}});var l=new Uint8Array(8192);return l.fill(191),s.setReadMemory(24576,32767,function(e){return l[8191&e]}),s.setWriteMemory(24576,32767,function(e,t){l[8191&e]=t}),o}return s(t,e),t}(a.Mapper);t.Mapper069=c},466:function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(454),u=function(e){function t(e,r,s,a){n(this,t);var o=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));o.cpu=s,o.ppu=a,o.irqEnable=!1,o.irqValue=o.irqCounter=-1;var u=14,c=r>>u;e.setPrgBank(0,0),e.setPrgBank(1,1),e.setPrgBank(2,2*c-2),e.setPrgBank(3,2*c-1),s.setWriteMemory(61440,65535,function(t,r){var n=r<<1;e.setPrgBank(0,n),e.setPrgBank(1,n+1)}),s.setWriteMemory(32768,40959,function(e,t){console.log(),e<36864?o.irqValue=65520&o.irqValue|15&t:o.irqValue=65295&o.irqValue|(15&t)<<4}),s.setWriteMemory(40960,49151,function(e,t){e<45056?o.irqValue=61695&o.irqValue|(15&t)<<8:o.irqValue=4095&o.irqValue|(15&t)<<12}),s.setWriteMemory(49152,57343,function(e,t){e<53248&&(o.enableIrq(0!==(2&t)),o.irqCounter=o.irqValue)});var l=new Uint8Array(8192);return l.fill(255),s.setReadMemory(24576,32767,function(e){return l[8191&e]}),s.setWriteMemory(24576,32767,function(e,t){l[8191&e]=t}),o}return s(t,e),a(t,[{key:"reset",value:function(){this.irqEnable=!1,this.irqValue=this.irqCounter=-1}},{key:"onHblank",value:function(e){this.irqEnable&&this.irqCounter>0&&(this.irqCounter-=185,this.irqCounter<0&&(this.irqCounter=0,this.cpu.requestIrq()))}},{key:"enableIrq",value:function(e){this.irqEnable=e}}]),t}(o.Mapper);t.Mapper073=u},467:function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=r(454),o=function(e){function t(e,r,s,a){n(this,t);var o=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return s.setWriteMemory(24576,32767,function(e,t){var r=(2&t)>>1|(1&t)<<1;a.setChrBank(r)}),o}return s(t,e),t}(a.Mapper);t.Mapper087=o},468:function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=r(454),o=r(451),u=function(e){function t(e,r,s,a){n(this,t);for(var u=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),c=13,l=r>>c,h=0;h<4;++h)e.setPrgBank(h,l-1);var p=[0,0],f=function(e,t){p[e]=t;for(var r=e<<2,n=t<<2,i=0;i<4;++i)a.setChrBankOffset(r+i,n+i)};s.setWriteMemory(32768,40959,function(t,r){t<36864?e.setPrgBank(0,r):(a.setMirrorMode(0===(1&r)?o.MirrorMode.VERT:o.MirrorMode.HORZ),f(0,15&p[0]|(2&r)<<3),f(1,15&p[1]|(4&r)<<2))}),s.setWriteMemory(40960,49151,function(t,r){t<45056&&e.setPrgBank(1,r)}),s.setWriteMemory(49152,57343,function(t,r){t<53248&&e.setPrgBank(2,r)}),s.setWriteMemory(57344,65535,function(e,t){var r=e>>12&1;f(r,16&p[r]|15&t)});var d=new Uint8Array(8192);return d.fill(191),s.setReadMemory(24576,32767,function(e){return d[8191&e]}),s.setWriteMemory(24576,32767,function(e,t){d[8191&e]=t}),u}return s(t,e),t}(a.Mapper);t.Mapper075=u},469:function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=r(454),o=function(e){function t(e,r,s,a){n(this,t);var o=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return s.setWriteMemory(24576,32767,function(e,t){for(var r=(t>>2&28)+16,n=(7&t)<<2,i=0;i<4;++i)a.setChrBankOffset(i+4,r+i);for(var s=0;s<4;++s)a.setChrBankOffset(s,n+s)}),o}return s(t,e),t}(a.Mapper);t.Mapper184=o},470:function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a,o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),u=r(100);!function(e){!function(e){e[e.RENDER=1]="RENDER",e[e.RUN=2]="RUN",e[e.PAUSE=3]="PAUSE",e[e.STEP=4]="STEP",e[e.RESET=5]="RESET",e[e.LOAD_ROM=6]="LOAD_ROM",e[e.BREAK_POINT=7]="BREAK_POINT",e[e.SCREEN_SHOT=8]="SCREEN_SHOT",e[e.DESTROY=9]="DESTROY",e[e.START_CALC=10]="START_CALC",e[e.END_CALC=11]="END_CALC"}(e.Type||(e.Type={}));var t=e.Type,r=function(e){function r(){return n(this,r),i(this,(r.__proto__||Object.getPrototypeOf(r)).apply(this,arguments))}return s(r,e),o(r,[{key:"triggerRender",value:function(){this.next(t.RENDER)}},{key:"triggerRun",value:function(){this.next(t.RUN)}},{key:"triggerPause",value:function(){this.next(t.PAUSE)}},{key:"triggerStep",value:function(){this.next(t.STEP)}},{key:"triggerReset",value:function(){this.next(t.RESET)}},{key:"triggerScreenShot",value:function(){this.next(t.SCREEN_SHOT)}},{key:"triggerLoadRom",value:function(){this.next(t.LOAD_ROM)}},{key:"triggerBreakPoint",value:function(){this.next(t.BREAK_POINT)}},{key:"triggerDestroy",value:function(){this.next(t.DESTROY)}},{key:"triggerStartCalc",value:function(){this.next(t.START_CALC)}},{key:"triggerEndCalc",value:function(){this.next(t.END_CALC)}}]),r}(u.Subject);e.Stream=r}(a=t.AppEvent||(t.AppEvent={}))},471:function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=["square","square","triangle","noise"],s=function(){function e(){r(this,e)}return n(e,[{key:"destroy",value:function(){null!=this.gainNode&&(this.gainNode.disconnect(),this.gainNode=null),null!=this.oscillator&&(this.oscillator.disconnect(),this.oscillator=null)}},{key:"create",value:function(e,t){if(this.gainNode=e.createGain(),this.gainNode.gain.value=0,this.oscillator=e.createOscillator(),"noise"!==t)this.oscillator.type=t;else{for(var r=1024,n=new Float32Array(r),i=new Float32Array(r),s=0;s<r;++s)n[s]=2*Math.random()-1,i[s]=0;var a=e.createPeriodicWave(n,i);this.oscillator.setPeriodicWave(a)}this.oscillator.connect(this.gainNode),this.gainNode.connect(e.destination)}},{key:"start",value:function(){this.oscillator.start()}},{key:"setFrequency",value:function(e){var t=this.gainNode.context.currentTime;this.oscillator.frequency.setValueAtTime(e,t)}},{key:"setVolume",value:function(e){this.gainNode.gain.value=e}}]),e}(),a=function(){function e(){r(this,e),this.masterVolume=0,e.setUp(),null!=e.context&&(this.masterVolume=1,this.channels=i.map(function(t){var r=new s;return r.create(e.context,t),r.start(),r}))}return n(e,[{key:"destroy",value:function(){if(null!=this.channels){var e=!0,t=!1,r=void 0;try{for(var n,i=this.channels[Symbol.iterator]();!(e=(n=i.next()).done);e=!0){var s=n.value;s.destroy()}}catch(e){t=!0,r=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw r}}this.channels=null}}},{key:"setChannelFrequency",value:function(t,r){null!=e.context&&this.channels[t].setFrequency(r)}},{key:"setChannelVolume",value:function(t,r){null!=e.context&&this.channels[t].setVolume(r*this.masterVolume)}},{key:"setMasterVolume",value:function(t){null!=e.context&&(this.masterVolume=t,t<=0&&this.channels.forEach(function(e){e.setVolume(0)}))}}],[{key:"setUp",value:function(){if(!e.initialized){e.initialized=!0;var t=window.AudioContext||window.webkitAudioContext;null!=t&&(e.context=new t)}}}]),e}();a.CHANNEL=4,a.initialized=!1,a.context=null,t.AudioManager=a},472:function(e,t,r){"use strict";function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},s=document.createElement("div");return s.className="gamepad-btn",s.style.left=t+"px",s.style.top=r+"px",s.style.width=(i.width||30)+"px",s.style.height=(i.height||30)+"px",s.innerHTML=n,"round"===i.type&&(s.style.borderRadius="15px"),e.appendChild(s),s}var o,u=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var s=Object.getPrototypeOf(t);return null===s?void 0:e(s,r,n)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(n)},c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),h=r(445),p=r(473),f=r(474);!function(e){e[e.AXIS=0]="AXIS",e[e.BUTTON=1]="BUTTON"}(o||(o={}));var d=[{type:o.BUTTON,index:0,direction:1},{type:o.BUTTON,index:1,direction:1},{type:o.BUTTON,index:2,direction:1},{type:o.BUTTON,index:3,direction:1},{type:o.AXIS,index:1,direction:-1},{type:o.AXIS,index:1,direction:1},{type:o.AXIS,index:0,direction:-1},{type:o.AXIS,index:0,direction:1}],y=["A","B","SELECT","START","U","D","L","R"],v=function(){function e(){s(this,e)}return l(e,null,[{key:"setUp",value:function(){e.loadSetting()}},{key:"isSupported",value:function(){return"Gamepad"in window}},{key:"getState",value:function(t){if(!window.Gamepad)return 0;var r=navigator.getGamepads();if(t>=r.length)return 0;var n=r[t];if(!n)return 0;var i=e.AXIS_THRESHOLD,s=0;return d.forEach(function(e,t){if(e.type===o.AXIS){var r=n.axes[e.index]||0;r*e.direction>=i&&(s|=1<<t)}else{var a=n.buttons[e.index];a&&a.pressed&&(s|=1<<t)}}),s}},{key:"setButton",value:function(t,r){d[t].type=o.BUTTON,d[t].index=r,d[t].direction=1,e.saveSetting()}},{key:"setAxis",value:function(t,r,n){d[t].type=o.AXIS,d[t].index=r,d[t].direction=n,e.saveSetting()}},{key:"saveSetting",value:function(){var e={};d.forEach(function(t,r){var n=y[r];switch(t.type){default:return null;case o.BUTTON:e[n]={button:t.index};break;case o.AXIS:e[n]={axis:t.index,direction:t.direction}}}),f.default.putObject("pad0",e)}},{key:"loadSetting",value:function(){var t=f.default.getObject("pad0",{});"object"===("undefined"==typeof t?"undefined":c(t))&&Object.keys(t).forEach(function(r){var n=y.indexOf(r.toUpperCase());if(!(n<0)){var i=t[r];"button"in i?e.setButton(n,i.button):"axis"in i&&"direction"in i&&e.setAxis(n,i.axis,parseInt(i.direction,10))}})}}]),e}();v.AXIS_THRESHOLD=.5,t.GamepadManager=v;var b=[{x:40,y:10,name:"&uarr;",padbit:h.PadBit.U},{x:10,y:40,name:"&larr;",padbit:h.PadBit.L},{x:70,y:40,name:"&rarr;",padbit:h.PadBit.R},{x:40,y:70,name:"&darr;",padbit:h.PadBit.D},{x:130,y:40,name:"B",opt:{type:"round"},padbit:h.PadBit.B},{x:175,y:40,name:"A",opt:{type:"round"},padbit:h.PadBit.A},{x:50,y:110,name:"Select",opt:{width:60,height:20},padbit:h.PadBit.SELECT},{x:120,y:110,name:"Start",opt:{width:60,height:20},padbit:h.PadBit.START}],g=function(e){function t(e){s(this,t);var r=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,230,150,"Gamepad config"));r.destroying=!1;var i=document.createElement("div");i.className="gamepad-content",i.style.width="230px",i.style.height="150px",r.setContent(i),i.addEventListener("click",function(){r.setSelectedButton(null)}),r.buttons=b.map(function(e){var t=a(i,e.x,e.y,e.name,e.opt);return t.addEventListener("click",function(e){e.stopPropagation(),r.setSelectedButton(t)}),t}),r.selectedButton=null;var o=function e(){r.destroying||(r.checkGamepad(),requestAnimationFrame(e))};return requestAnimationFrame(o),r}return i(t,e),l(t,[{key:"close",value:function(){this.destroying=!0,u(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"close",this).call(this)}},{key:"checkGamepad",value:function(){var e=0;if(window.Gamepad){var t=navigator.getGamepads();if(!(e>=t.length)){var r=t[e];if(r){if(null!=this.selectedButton&&this.isTop()){var n=this.buttons.indexOf(this.selectedButton);this.replaceGamepadButton(e,r,n)&&this.setSelectedButton(null)}this.checkGamepadPressed(e)}}}}},{key:"replaceGamepadButton",value:function(e,t,r){for(var n=0;n<t.buttons.length;++n)if(t.buttons[n].pressed)return v.setButton(b[r].padbit,n),!0;for(var i=v.AXIS_THRESHOLD,s=0;s<t.axes.length;++s){var a=t.axes[s];if(a<-i)return v.setAxis(b[r].padbit,s,-1),!0;if(a>i)return v.setAxis(b[r].padbit,s,1),!0}return!1}},{key:"checkGamepadPressed",value:function(e){for(var t=v.getState(e),r=0;r<b.length;++r){var n=this.buttons[r];0===(t&1<<b[r].padbit)?n.classList.remove("pressed"):n.classList.add("pressed")}}},{key:"setSelectedButton",value:function(e){return null!=this.selectedButton&&this.selectedButton.classList.remove("selected"),this.selectedButton===e?void(this.selectedButton=null):(this.selectedButton=e,void(null!=this.selectedButton&&this.selectedButton.classList.add("selected")))}}]),t}(p.default);t.GamepadWnd=g},473:function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){var r=e.getBoundingClientRect(),n=t.getBoundingClientRect();return{left:n.left-r.left,top:n.top-r.top,right:n.right-r.left,bottom:n.bottom-r.top}}function i(e,t){var r=document.createElement("div");r.className="upper",r.style.position="absolute",r.style.overflow="hidden",r.style.left=r.style.top=r.style.right="0",r.style.height=t+"px";var n=document.createElement("div");return n.className="lower",n.style.position="absolute",n.style.overflow="hidden",n.style.left=n.style.bottom=n.style.right="0",n.style.top=t+"px",e.appendChild(r),e.appendChild(n),[r,n]}var s=function(){function e(e,t){var r=[],n=!0,i=!1,s=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,s=e}finally{try{!n&&o.return&&o.return()}finally{if(i)throw s}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=1e3,u=o+1,c=function(){function e(t,n,a,o){r(this,e),this.wndMgr=t,this.clientMarginWidth=0,this.clientMarginHeight=0,this.callback=function(){},this.root=this.createRoot(),this.root.className="wnd",this.root.style.position="absolute";var u=i(this.root,e.TITLEBAR_HEIGHT),c=s(u,2),l=c[0],h=c[1];this.clientMarginHeight+=e.TITLEBAR_HEIGHT,this.createTitleBar(o),l.appendChild(this.titleBar),this.contentHolder=h,this.setClientSize(n,a)}return a(e,[{key:"setContent",value:function(e){return this.contentHolder.appendChild(e),this}},{key:"setPos",value:function(e,t){return this.root.style.left=e+"px",this.root.style.top=t+"px",this}},{key:"setTitle",value:function(e){return this.titleElem.innerText=e,this}},{key:"setClientSize",value:function(e,t){return this.root.style.width=e+this.clientMarginWidth+"px",this.root.style.height=t+this.clientMarginHeight+"px",this}},{key:"getWindowSize",value:function(){var e=parseInt(this.root.style.width,10),t=parseInt(this.root.style.height,10);return{width:e,height:t}}},{key:"setCallback",value:function(e){return this.callback=e,this}},{key:"setFocus",value:function(){return this.root.focus(),this}},{key:"isTop",value:function(){return this.wndMgr.isTop(this)}},{key:"addMenuBar",value:function(t){var r=this,n=i(this.root,e.MENUBAR_HEIGHT),a=s(n,2),u=a[0],c=a[1];return this.clientMarginHeight+=e.TITLEBAR_HEIGHT,this.contentHolder.appendChild(u),this.contentHolder.appendChild(c),this.menuBar=document.createElement("div"),this.menuBar.className="menu-bar",this.menuBar.style.zIndex=String(o),t.forEach(function(e){var t=document.createElement("div");t.className="menu-item pull-left",t.innerText=e.label,t.addEventListener("click",function(n){"submenu"in e&&r.addSubmenu(e,t)}),r.menuBar.appendChild(t)}),u.appendChild(this.menuBar),this.contentHolder=c,this}},{key:"getRootNode",value:function(){return this.root}},{key:"close",value:function(){this.callback("close")!==!1&&(this.wndMgr.remove(this),this.root=null)}},{key:"addResizeBox",value:function(){var t=this;this.root.classList.add("resizable");var r=8,n=[{styleParams:{right:"-1px",bottom:"-1px",cursor:"nwse-resize"},horz:"right",vert:"bottom"},{styleParams:{left:"-1px",bottom:"-1px",cursor:"nesw-resize"},horz:"left",vert:"bottom"},{styleParams:{right:"-1px",top:"-1px",cursor:"nesw-resize"},horz:"right",vert:"top"},{styleParams:{left:"-1px",top:"-1px",cursor:"nwse-resize"},horz:"left",vert:"top"}],i=64,a=24+e.TITLEBAR_HEIGHT;n.forEach(function(n){var o=document.createElement("div");o.style.position="absolute",Object.keys(n.styleParams).forEach(function(e){o.style[e]=n.styleParams[e]}),o.style.width=o.style.height=r+"px",o.style.zIndex="100";var u=void 0,c=void 0,l=function(r){var o=t.getMousePosIn(r,t.root.parentNode),l=s(o,2),h=l[0],p=l[1],f=t.root.getBoundingClientRect(),d=t.root.parentNode.getBoundingClientRect(),y={left:f.left-d.left,top:f.top-d.top,right:f.right-d.left,bottom:f.bottom-d.top};y[n.horz]=h+u,y[n.vert]=p+c;var v=y.right-y.left-2,b=y.bottom-y.top-2;v<i&&(y[n.horz]-=(i-v)*("left"===n.horz?1:-1)),b<a&&(y[n.vert]-=(a-b)*("top"===n.vert?1:-1)),t.root.style.width=y.right-y.left-2+"px",t.root.style.height=y.bottom-y.top-2+"px",t.root.style.left=y.left+"px",t.root.style.top=y.top+"px",t.callback("resize",v,b-e.TITLEBAR_HEIGHT)},h=function e(t){document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",e)};o.addEventListener("mousedown",function(e){e.stopPropagation(),e.preventDefault();var i=t.getMousePosIn(e,o),a=s(i,2),p=a[0],f=a[1];u="left"===n.horz?-p:r-p,c="top"===n.vert?-f:r-f,document.addEventListener("mousemove",l),document.addEventListener("mouseup",h),t.wndMgr.moveToTop(t)}),t.root.appendChild(o)})}},{key:"createRoot",value:function(){var e=this,t=document.createElement("div");return t.addEventListener("mousedown",function(t){return t.stopPropagation(),e.wndMgr.moveToTop(e),!1}),t}},{key:"createTitleBar",value:function(e){var t=this;this.titleBar=document.createElement("div"),this.titleBar.className="title-bar clearfix",this.addTitleButton(this.titleBar,"close",function(){t.close()}),this.titleElem=this.addTitle(this.titleBar,e);var r=void 0,n=void 0,i=function(e){var i=t.getMousePosIn(e,t.root.parentNode),a=s(i,2),o=a[0],u=a[1];t.root.style.left=o+r+"px",t.root.style.top=u+n+"px"},a=function e(t){document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",e)};this.titleBar.addEventListener("mousedown",function(e){if(r=n=null,0===e.button){e.preventDefault();var o=t.getMousePosIn(e,t.root),u=s(o,2),c=u[0],l=u[1];return r=-c,n=-l,document.addEventListener("mousemove",i),document.addEventListener("mouseup",a),!0}})}},{key:"addTitleButton",value:function(e,t,r){var n=document.createElement("div");return n.className=t+" btn",n.addEventListener("click",r),n.addEventListener("mousedown",function(e){e.preventDefault(),e.stopPropagation()}),e.appendChild(n),n}},{key:"addTitle",value:function(e,t){var r=document.createElement("div");return r.className="title",r.appendChild(document.createTextNode(t)),e.appendChild(r),r}},{key:"addSubmenu",value:function(e,t){var r=document.createElement("div");r.className="menu-subitem-holder",r.style.zIndex=String(u),e.submenu.forEach(function(e){var t=document.createElement("div");t.className="menu-item",t.innerText=e.label,t.addEventListener("click",function(t){t.stopPropagation(),"click"in e&&e.click()}),r.appendChild(t)}),this.root.appendChild(r);var i=n(this.root,t);r.style.left=i.left-1+"px",r.style.top=i.bottom-1+"px";var s=function e(t){r.parentNode.removeChild(r),document.removeEventListener("click",e,!0)};document.addEventListener("click",s,!0)}},{key:"getMousePosIn",value:function(e,t){var r=t.getBoundingClientRect(),n=document.body.scrollLeft,i=document.body.scrollTop;return[e.pageX-r.left-n,e.pageY-r.top-i];
}}]),e}();c.TITLEBAR_HEIGHT=12,c.MENUBAR_HEIGHT=12,Object.defineProperty(t,"__esModule",{value:!0}),t.default=c},474:function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e){return""+u+e}var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=r(475),o=null,u="";if(null==o){try{"localStorage"in window&&null!=window.localStorage&&(o=window.localStorage)}catch(e){}null==o&&(o=new a.default)}var c=function(){function e(){n(this,e)}return s(e,null,[{key:"setKeyPrefix",value:function(e){u=e}},{key:"get",value:function(e,t){var r=i(e);return null!=o.getItem(r)?o.getItem(r):t}},{key:"getInt",value:function(e,t){var r=i(e),n=parseInt(o.getItem(r),10);return isNaN(n)?t:n}},{key:"getFloat",value:function(e,t){var r=i(e),n=parseFloat(o.getItem(r));return isNaN(n)?t:n}},{key:"getBool",value:function(e,t){var r=i(e),n=o.getItem(r);return"true"===n||"false"!==n&&t}},{key:"getObject",value:function(e,t){var r=i(e),n=o.getItem(r);try{if(null!=n)return JSON.parse(n)}catch(e){console.error(e)}return t}},{key:"put",value:function(e,t){var r=i(e);return o.setItem(r,t),!0}},{key:"putObject",value:function(e,t){var r=i(e);return o.setItem(r,JSON.stringify(t)),!0}}]),e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=c},475:function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(){function e(){r(this,e),this.storage={}}return n(e,[{key:"setItem",value:function(e,t){this.storage[e]=String(t)}},{key:"getItem",value:function(e){var t=this.storage[e];return"undefined"==typeof t?null:t}},{key:"removeItem",value:function(e){delete this.storage[e]}},{key:"key",value:function(e){var t=Object.keys(this.storage);return t[e]||null}},{key:"length",get:function(){return Object.keys(this.storage).length}}]),e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=i},476:function(e,t){"use strict";!function(e){e[e.SPACE=32]="SPACE",e[e.RETURN=13]="RETURN",e[e.LEFT=37]="LEFT",e[e.UP=38]="UP",e[e.RIGHT=39]="RIGHT",e[e.DOWN=40]="DOWN",e[e.Z=90]="Z",e[e.X=88]="X",e[e.I=73]="I",e[e.J=74]="J",e[e.K=75]="K",e[e.L=76]="L",e[e.Q=81]="Q",e[e.W=87]="W",e[e.O=79]="O",e[e.P=80]="P"}(t.KeyCode||(t.KeyCode={}));t.KeyCode},477:function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=r(445),a=r(476),o=function(){var e={};return e[a.KeyCode.LEFT]={no:0,bit:s.PadValue.L},e[a.KeyCode.RIGHT]={no:0,bit:s.PadValue.R},e[a.KeyCode.UP]={no:0,bit:s.PadValue.U},e[a.KeyCode.DOWN]={no:0,bit:s.PadValue.D},e[a.KeyCode.Z]={no:0,bit:s.PadValue.B},e[a.KeyCode.X]={no:0,bit:s.PadValue.A},e[a.KeyCode.SPACE]={no:0,bit:s.PadValue.SELECT},e[a.KeyCode.RETURN]={no:0,bit:s.PadValue.START},e[a.KeyCode.J]={no:1,bit:s.PadValue.L},e[a.KeyCode.L]={no:1,bit:s.PadValue.R},e[a.KeyCode.I]={no:1,bit:s.PadValue.U},e[a.KeyCode.K]={no:1,bit:s.PadValue.D},e[a.KeyCode.Q]={no:1,bit:s.PadValue.B},e[a.KeyCode.W]={no:1,bit:s.PadValue.A},e[a.KeyCode.O]={no:1,bit:s.PadValue.SELECT},e[a.KeyCode.P]={no:1,bit:s.PadValue.START},e}(),u=function(){function e(){n(this,e),this.controller=[0,0]}return i(e,[{key:"onKeyDown",value:function(e){var t=o[e];t&&(this.controller[t.no]|=t.bit)}},{key:"onKeyUp",value:function(e){var t=o[e];t&&(this.controller[t.no]&=~t.bit)}},{key:"getStatus",value:function(e){return this.controller[e]}}]),e}();t.PadKeyHandler=u},478:function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e){var t=e.getContext("2d");t.strokeStyle="",t.fillStyle="rgb(64,64,64)",t.fillRect(0,0,e.width,e.height)}function o(e,t){var r=document.createElement("img"),n=String(Date.now());r.src=t.capture(),r.className="pixelated",r.style.width=r.style.height="100%",r.title=r.alt=n;var i=new f.default(e,m,k,n);return i.setContent(r),i.addResizeBox(),e.add(i),i}function u(e,t){for(var r=[{fullscreen:"requestFullscreen",change:"fullscreenchange"},{fullscreen:"webkitRequestFullScreen",change:"webkitfullscreenchange"},{fullscreen:"mozRequestFullScreen",change:"mozfullscreenchange"},{fullscreen:"msRequestFullscreen",change:"MSFullscreenChange"}],n=0;n<r.length;++n)if(e[r[n].fullscreen]){var i=function(){e[r[n].fullscreen]();var i=r[n].change,s=function e(){var r=document.fullScreen||document.mozFullScreen||document.webkitIsFullScreen;t&&t(r),r||document.removeEventListener(i,e,!1)};return document.addEventListener(i,s,!1),{v:!0}}();if("object"===("undefined"==typeof i?"undefined":p(i)))return i.v}return!1}var c=function(){function e(e,t){var r=[],n=!0,i=!1,s=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,s=e}finally{try{!n&&o.return&&o.return()}finally{if(i)throw s}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),l=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),h=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var s=Object.getPrototypeOf(t);return null===s?void 0:e(s,r,n)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(n)},p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f=r(473),d=r(444),y=r(448),v=r(450),b=r(449),g=r(470),E=r(442),m=256,k=240,O=function(e){function t(e,r,s,u){n(this,t);var c=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,2*m,2*k+f.default.MENUBAR_HEIGHT,"NES"));c.app=r,c.nes=s,c.stream=u,c.addMenuBar([{label:"File",submenu:[{label:"Pause",click:function(){c.nes.cpu.paused?c.stream.triggerRun():c.stream.triggerPause()}},{label:"Reset",click:function(){c.stream.triggerReset(),c.stream.triggerRun()}},{label:"Screenshot",click:function(){o(c.wndMgr,c)}},{label:"Quit",click:function(){c.close()}}]},{label:"View",submenu:[{label:"1x1",click:function(){c.setClientSize(m,k)}},{label:"2x2",click:function(){c.setClientSize(2*m,2*k)}},{label:"Adjust aspect ratio",click:function(){var e=c.canvas.getBoundingClientRect(),t=Math.round(e.width*(k/m));c.setClientSize(e.width,t)}},{label:"Max",click:function(){c.setPos(0,0);var e=window.innerWidth-2,t=window.innerHeight-f.default.TITLEBAR_HEIGHT-f.default.MENUBAR_HEIGHT-2;c.setClientSize(e,t)}},{label:"Fullscreen",click:function(){c.setFullscreen()}}]},{label:"Debug",submenu:[{label:"Palette",click:function(){c.app.createPaletWnd()}},{label:"NameTable",click:function(){c.app.createNameTableWnd()}},{label:"PatternTable",click:function(){c.app.createPatternTableWnd()}},{label:"Trace",click:function(){c.app.createTraceWnd()}},{label:"Registers",click:function(){c.app.createRegisterWnd()}},{label:"Control",click:function(){c.app.createControlWnd()}},{label:"FPS",click:function(){c.createFpsWnd()}}]}]);var l=document.createElement("canvas");return l.width=m,l.height=k,l.style.display="block",l.style.width="100%",l.style.height="100%",l.className="pixelated",a(l),c.setContent(l),c.canvas=l,c.context=c.canvas.getContext("2d"),c.imageData=c.context.getImageData(0,0,c.canvas.width,c.canvas.height),c.addResizeBox(),c.subscription=c.stream.subscribe(function(e){switch(e){case g.AppEvent.Type.RENDER:c.nes.render(c.imageData.data),c.context.putImageData(c.imageData,0,0);break;case g.AppEvent.Type.SCREEN_SHOT:o(c.wndMgr,c);break;case g.AppEvent.Type.RESET:a(c.canvas)}}),c}return s(t,e),l(t,[{key:"capture",value:function(){return this.canvas.toDataURL()}},{key:"getCanvas",value:function(){return this.canvas}},{key:"setFullscreen",value:function(e){var t=this;return u(this.contentHolder,function(r){var n=t.contentHolder.style;if(r){var i=window.parent.screen.width,s=window.parent.screen.height;i/s>=m/k?i=s*(m/k)|0:s=i*(k/m)|0,n.width=i+"px",n.height=s+"px",n.margin="auto",n.backgroundColor="black"}else n.width=n.height=n.margin=n.backgroundColor="";e&&e(r)})}},{key:"close",value:function(){this.subscription.unsubscribe(),this.stream.triggerDestroy(),h(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"close",this).call(this)}},{key:"setFocus",value:function(){return this.canvas.focus(),this}},{key:"createFpsWnd",value:function(){var e=new I(this.wndMgr,this.stream);this.wndMgr.add(e)}}]),t}(f.default);t.ScreenWnd=O;var T=function(e){function t(e,r,s){n(this,t);var a=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,128,16,"Palette"));a.nes=r,a.stream=s,a.palet=new Uint8Array(t.W*t.H),a.tmp=new Uint8Array(t.W*t.H);var o=t.createDom(),u=c(o,2),l=u[0],h=u[1];return a.setContent(l),a.boxes=h,a.subscription=a.stream.subscribe(function(e){switch(e){case g.AppEvent.Type.DESTROY:a.close();break;case g.AppEvent.Type.RENDER:a.render()}}),a.render(),a}return s(t,e),l(t,[{key:"close",value:function(){this.subscription.unsubscribe(),h(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"close",this).call(this)}},{key:"render",value:function(){var e=this.tmp;t.getPalet(this.nes,e);for(var r=t.W*t.H,n=0;n<r;++n){var i=e[n];i!==this.palet[n]&&(this.palet[n]=i,this.boxes[n].style.backgroundColor=d.Nes.getPaletColorString(i))}}}],[{key:"createDom",value:function(){var e=t.UNIT,r=t.W,n=t.H,i=document.createElement("div");i.className="clearfix",i.style.width=e*r+"px",i.style.height=e*n+"px";for(var s=new Array(r*n),a=0;a<n;++a)for(var o=0;o<r;++o){var u=document.createElement("div");u.className="pull-left",u.style.width=e-1+"px",u.style.height=e-1+"px",u.style.borderRight=u.style.borderBottom="1px solid black",s[o+a*r]=u,i.appendChild(u)}return[i,s]}},{key:"getPalet",value:function(e,r){for(var n=t.W*t.H,i=0;i<n;++i)r[i]=e.getPalet(i)}}]),t}(f.default);T.UNIT=8,T.W=16,T.H=2,t.PaletWnd=T;var C=function(e){function t(e,r,s,o){n(this,t);var u=256*(o?1:2),c=240*(o?2:1),l=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u,c,"NameTable"));l.nes=r,l.stream=s,l.vert=o;var h=document.createElement("canvas");return h.width=u,h.height=c,h.style.width=u+"px",h.style.height=c+"px",h.className="pixelated",a(h),l.setContent(h),l.canvas=h,l.context=l.canvas.getContext("2d"),l.imageData=l.context.getImageData(0,0,l.canvas.width,l.canvas.height),l.subscription=l.stream.subscribe(function(e){switch(e){case g.AppEvent.Type.DESTROY:l.close();break;case g.AppEvent.Type.RENDER:l.render()}}),l.render(),l}return s(t,e),l(t,[{key:"close",value:function(){this.subscription.unsubscribe(),h(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"close",this).call(this)}},{key:"render",value:function(){var e=this.vert?0:256,t=this.vert?240:0;this.nes.renderNameTable1(this.imageData.data,this.imageData.width,0,0,0),this.nes.renderNameTable1(this.imageData.data,this.imageData.width,e,t,1),this.context.putImageData(this.imageData,0,0)}}]),t}(f.default);t.NameTableWnd=C;var w=[0,0,0,255,0,0,0,255,0,0,0,255],A=function(e){function t(e,r,s){n(this,t);var a=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,256,128,"PatternTable"));a.nes=r,a.stream=s;var o=t.createCanvas();return a.setContent(o),a.canvas=o,a.context=a.canvas.getContext("2d"),a.imageData=a.context.getImageData(0,0,a.canvas.width,a.canvas.height),a.subscription=a.stream.subscribe(function(e){switch(e){case g.AppEvent.Type.DESTROY:a.close();break;case g.AppEvent.Type.RENDER:a.render()}}),a.render(),a}return s(t,e),l(t,[{key:"close",value:function(){this.subscription.unsubscribe(),h(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"close",this).call(this)}},{key:"render",value:function(){this.nes.renderPatternTable(this.imageData.data,this.imageData.width,w),this.context.putImageData(this.imageData,0,0)}}],[{key:"createCanvas",value:function(){var e=document.createElement("canvas");return e.width=256,e.height=128,e.style.width="256px",e.style.height="128px",e.className="pixelated",a(e),e}}]),t}(f.default);t.PatternTableWnd=A;var P=function(e){function t(e,r,s){n(this,t);var a=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,100,160,"Regs"));a.nes=r,a.stream=s;var o=a.createContent();return a.setContent(o),a.subscription=a.stream.subscribe(function(e){switch(e){case g.AppEvent.Type.DESTROY:a.close();break;case g.AppEvent.Type.RESET:case g.AppEvent.Type.STEP:case g.AppEvent.Type.PAUSE:case g.AppEvent.Type.BREAK_POINT:a.updateStatus()}}),a}return s(t,e),l(t,[{key:"updateStatus",value:function(){var e=this.nes.cpu;this.valueElems[0].value=b.Util.hex(e.pc,4),this.valueElems[1].value=b.Util.hex(e.a,2),this.valueElems[2].value=b.Util.hex(e.x,2),this.valueElems[3].value=b.Util.hex(e.y,2),this.valueElems[4].value=b.Util.hex(e.s,2),this.valueElems[5].value=b.Util.hex(e.p,2),this.valueElems[6].value=String(this.nes.cycleCount)}},{key:"close",value:function(){this.subscription.unsubscribe(),h(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"close",this).call(this)}},{key:"createContent",value:function(){var e=document.createElement("div");e.className="fixed-font";var t=[{name:"PC"},{name:"A"},{name:"X"},{name:"Y"},{name:"S"},{name:"P"},{name:"cycle"}],r=document.createElement("table");r.style.fontSize="10px",r.style.width="100%",this.valueElems=[];for(var n=0;n<t.length;++n){var i=document.createElement("tr");r.appendChild(i);var s=document.createElement("td");s.innerText=t[n].name,i.appendChild(s);var a=document.createElement("td");i.appendChild(a);var o=document.createElement("input");o.className="fixed-font",o.type="text",o.style.width="100%",a.appendChild(o),this.valueElems.push(o)}return e.appendChild(r),e}}]),t}(f.default);t.RegisterWnd=P;var M=3,R=100,B={opType:y.OpType.UNKNOWN,addressing:y.Addressing.UNKNOWN,bytes:1,cycle:0},_=function(e){function t(e,r,s){n(this,t);var a=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,400,160,"Trace"));a.nes=r,a.stream=s,a.mem=new Uint8Array(M),a.bins=new Array(M);var o=a.createContent();return a.setContent(o),a.reset(),a.subscription=a.stream.subscribe(function(e){switch(e){case g.AppEvent.Type.DESTROY:a.close();break;case g.AppEvent.Type.RESET:a.reset();case g.AppEvent.Type.STEP:case g.AppEvent.Type.PAUSE:case g.AppEvent.Type.BREAK_POINT:a.updateStatus()}}),a}return s(t,e),l(t,[{key:"reset",value:function(){this.lines=[]}},{key:"updateStatus",value:function(){for(var e=this.nes.cpu,t=e.read8Raw(e.pc),r=y.kInstTable[t]||B,n=0;n<r.bytes;++n){var i=e.read8Raw(e.pc+n);this.mem[n]=i,this.bins[n]=b.Util.hex(i,2)}for(var s=r.bytes;s<M;++s)this.bins[s]="  ";var a=b.Util.hex(e.pc,4),o=this.bins.join(" "),u=v.disassemble(r,this.mem,1,e.pc);this.putConsole(a+": "+o+"   "+u)}},{key:"close",value:function(){this.subscription.unsubscribe(),h(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"close",this).call(this)}},{key:"createContent",value:function(){var e=document.createElement("div"),t=document.createElement("textarea");return t.className="fixed-font",t.style.fontSize="14px",t.style.width="100%",t.style.height="160px",t.style.resize="none",t.style.margin="0",t.style.padding="2px",t.style.border="none",t.style.boxSizing="border-box",e.appendChild(t),this.textarea=t,e}},{key:"putConsole",value:function(e){this.lines.push(e),this.lines.length>R&&this.lines.shift(),this.textarea.value=this.lines.join("\n"),this.textarea.scrollTop=this.textarea.scrollHeight}}]),t}(f.default);t.TraceWnd=_;var S=function(e){function t(e,r){n(this,t);var s=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,256,32,"Control"));s.stream=r;var a=s.createElement();return s.setContent(a),s.updateState(!0),s.subscription=s.stream.subscribe(function(e){switch(e){case g.AppEvent.Type.DESTROY:s.close();break;case g.AppEvent.Type.RUN:s.updateState(!1);break;case g.AppEvent.Type.PAUSE:case g.AppEvent.Type.BREAK_POINT:s.updateState(!0)}}),s}return s(t,e),l(t,[{key:"updateState",value:function(e){this.stepBtn.disabled=!e,this.runBtn.disabled=!e,this.pauseBtn.disabled=e}},{key:"close",value:function(){this.subscription.unsubscribe(),h(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"close",this).call(this)}},{key:"createElement",value:function(){var e=this,t=document.createElement("div");t.style.width="256px",t.style.height="32px",this.stepBtn=document.createElement("button"),this.stepBtn.innerText="Step",this.stepBtn.addEventListener("click",function(){e.stream.triggerStep()}),t.appendChild(this.stepBtn),this.runBtn=document.createElement("button"),this.runBtn.innerText="Run",this.runBtn.addEventListener("click",function(){e.stream.triggerRun()}),t.appendChild(this.runBtn),this.pauseBtn=document.createElement("button"),this.pauseBtn.innerText="Pause",this.pauseBtn.addEventListener("click",function(){e.stream.triggerPause()}),t.appendChild(this.pauseBtn);var r=document.createElement("button");r.innerText="Reset",r.addEventListener("click",function(){e.stream.triggerReset()}),t.appendChild(r);var n=document.createElement("button");return n.innerText="Capture",n.addEventListener("click",function(){e.stream.triggerScreenShot()}),t.appendChild(n),t}}]),t}(f.default);t.ControlWnd=S;var I=function(e){function t(e,r){n(this,t);var s=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,80,48,"Fps"));s.stream=r;var a=document.createElement("div");return a.style.width="80px",a.style.height="48px",s.setContent(a),s.stats=new E,a.appendChild(s.stats.domElement),s.subscription=s.stream.subscribe(function(e){switch(e){case g.AppEvent.Type.DESTROY:s.close();break;case g.AppEvent.Type.START_CALC:s.stats.begin();break;case g.AppEvent.Type.END_CALC:s.stats.end()}}),s}return s(t,e),l(t,[{key:"close",value:function(){this.subscription.unsubscribe(),h(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"close",this).call(this)}}]),t}(f.default);t.FpsWnd=I},479:function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t,r){e.getRootNode().style.zIndex=String(s+(r-1-t))}var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=100,a=function(){function e(t){r(this,e),this.root=t,this.windows=[]}return i(e,[{key:"add",value:function(e){this.windows.unshift(e),this.root.appendChild(e.getRootNode()),n(e,0,this.windows.length)}},{key:"remove",value:function(e){this.removeWnd(e);var t=e.getRootNode();null!=t&&t.parentNode.removeChild(t)}},{key:"moveToTop",value:function(e){var t=this.windows.length;if(!(t>0&&this.windows[0]===e))for(var r=e,i=0;i<t;++i){var s=this.windows[i];if(this.windows[i]=r,n(r,i,t),s===e)break;r=s}}},{key:"isTop",value:function(e){return this.windows.length>0&&this.windows[0]===e}},{key:"removeWnd",value:function(e){var t=this.windows.indexOf(e);if(!(t<0)){this.windows.splice(t,1);for(var r=0;r<t;++r)n(this.windows[r],r,this.windows.length)}}}]),e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=a},480:function(e,t){"use strict";"fill"in Array.prototype||(Array.prototype.fill=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.length,n=t;n<r;++n)this[n]=e;return this}),"fill"in Uint8Array.prototype||(Uint8Array.prototype.fill=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.length,n=t;n<r;++n)this[n]=e;return this}),Uint8Array.prototype.slice||(Uint8Array.prototype.slice=function(e,t){void 0==t&&(t=this.length);for(var r=new Uint8Array(t-e),n=0;n<r.length;++n)r[n]=this[n+e];return r})}});